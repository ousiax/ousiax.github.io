<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bing WebMaster -->
  <meta name="msvalidate.01" content="AB2FFF876C37F59D9121882CC8395DE5" />

  <title>Tcpdump Examples</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://blog.codefarm.me/2018/12/29/tcpdump-examples/">
  <link rel="alternate" type="application/rss+xml" title="CODE FARM" href="https://blog.codefarm.me/feed.xml">

  <!-- https://cdn.jsdelivr.net/gh/lurongkai/anti-baidu/js/anti-baidu-latest.min.js -->
<script type="text/javascript" src="/js/anti-baidu.min.js" charset="UTF-8"></script>

  
<!-- Google Analytics Website tracking -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83971182-1', 'auto');
  ga('send', 'pageview');

</script>


  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SN88FJ18E5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SN88FJ18E5');
</script>



</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <h2 class="site-title">
      <a class="site-title" href="/">CODE FARM</a>
    </h2>

     <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
        <div class="trigger">
            <ul>
                <li><a href="/">home</a>
                <li><a href="/category">category</a>
                <li><a href="/tag">tag</a>
                <li><a href="/archive">archive</a>
                <li><a href="/about">about</a>
                <li><a href="https://resume.github.io/?qqbuby" target="_blank">R&eacute;sum&eacute;</a>
            </ul>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Tcpdump Examples</h1>
    
    
    <p class="post-meta"><time datetime="2018-12-29T10:22:30+08:00" itemprop="datePublished">Dec 29, 2018</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <ul id="markdown-toc">
  <li><a href="#basics" id="markdown-toc-basics">Basics</a>    <ul>
      <li><a href="#11-basic-communication" id="markdown-toc-11-basic-communication">1.1 BASIC COMMUNICATION</a></li>
      <li><a href="#12-specific-interface" id="markdown-toc-12-specific-interface">1.2 SPECIFIC INTERFACE</a></li>
      <li><a href="#13-raw-output-view" id="markdown-toc-13-raw-output-view">1.3 RAW OUTPUT VIEW</a></li>
      <li><a href="#14-find-traffic-by-ip" id="markdown-toc-14-find-traffic-by-ip">1.4 FIND TRAFFIC BY IP</a></li>
      <li><a href="#15-seeing-more-of-the-packet-with-hex-output" id="markdown-toc-15-seeing-more-of-the-packet-with-hex-output">1.5 SEEING MORE OF THE PACKET WITH HEX OUTPUT</a></li>
      <li><a href="#16-filtering-by-source-and-destination" id="markdown-toc-16-filtering-by-source-and-destination">1.6 FILTERING BY SOURCE AND DESTINATION</a></li>
      <li><a href="#17-finding-packets-by-network" id="markdown-toc-17-finding-packets-by-network">1.7 FINDING PACKETS BY NETWORK</a></li>
      <li><a href="#18-show-traffic-related-to-a-specific-port" id="markdown-toc-18-show-traffic-related-to-a-specific-port">1.8 SHOW TRAFFIC RELATED TO A SPECIFIC PORT</a></li>
      <li><a href="#19-show-traffic-of-one-protocol" id="markdown-toc-19-show-traffic-of-one-protocol">1.9 SHOW TRAFFIC OF ONE PROTOCOL</a></li>
      <li><a href="#110-show-only-ip6-traffic" id="markdown-toc-110-show-only-ip6-traffic">1.10 SHOW ONLY IP6 TRAFFIC</a></li>
      <li><a href="#111-find-traffic-using-port-ranges" id="markdown-toc-111-find-traffic-using-port-ranges">1.11 FIND TRAFFIC USING PORT RANGES</a></li>
      <li><a href="#112-find-traffic-based-on-packet-size" id="markdown-toc-112-find-traffic-based-on-packet-size">1.12 FIND TRAFFIC BASED ON PACKET SIZE</a></li>
      <li><a href="#113-reading--writing-captures-to-a-file" id="markdown-toc-113-reading--writing-captures-to-a-file">1.13 READING / WRITING CAPTURES TO A FILE</a></li>
    </ul>
  </li>
  <li><a href="#advanced" id="markdown-toc-advanced">Advanced</a>    <ul>
      <li><a href="#21-from-specific-ip-and-destined-for-a-specific-port" id="markdown-toc-21-from-specific-ip-and-destined-for-a-specific-port">2.1 FROM SPECIFIC IP AND DESTINED FOR A SPECIFIC PORT</a></li>
      <li><a href="#22-find-one-network-to-another" id="markdown-toc-22-find-one-network-to-another">2.2 FIND ONE NETWORK TO ANOTHER</a></li>
      <li><a href="#23-non-icmp-traffic-going-to-a-specific-ip" id="markdown-toc-23-non-icmp-traffic-going-to-a-specific-ip">2.3 NON ICMP TRAFFIC GOING TO A SPECIFIC IP</a></li>
      <li><a href="#24-traffic-from-a-host-that-isnt-on-a-specific-port" id="markdown-toc-24-traffic-from-a-host-that-isnt-on-a-specific-port">2.4 TRAFFIC FROM A HOST THAT ISN’T ON A SPECIFIC PORT</a></li>
      <li><a href="#25-isolate-tcp-flags" id="markdown-toc-25-isolate-tcp-flags">2.5 ISOLATE TCP FLAGS</a>        <ul>
          <li><a href="#251-isolate-tcp-rst-flags" id="markdown-toc-251-isolate-tcp-rst-flags">2.5.1 Isolate TCP RST flags.</a></li>
          <li><a href="#252-isolate-tcp-sync-flags" id="markdown-toc-252-isolate-tcp-sync-flags">2.5.2 Isolate TCP SYNC flags.</a></li>
          <li><a href="#253-isolate-packets-that-have-both-syn-and-ack-flags-set" id="markdown-toc-253-isolate-packets-that-have-both-syn-and-ack-flags-set">2.5.3 Isolate packets that have both SYN and ACK flags set.</a></li>
          <li><a href="#254-isolate-tcp-urg-flags" id="markdown-toc-254-isolate-tcp-urg-flags">2.5.4 Isolate TCP URG flags.</a></li>
          <li><a href="#255-isolate-tcp-ack-flags" id="markdown-toc-255-isolate-tcp-ack-flags">2.5.5 Isolate TCP ACK flags.</a></li>
          <li><a href="#256-isolate-tcp-psh-flags" id="markdown-toc-256-isolate-tcp-psh-flags">2.5.6 Isolate TCP PSH flags.</a></li>
          <li><a href="#257-isolate-tcp-fin-flags" id="markdown-toc-257-isolate-tcp-fin-flags">2.5.7 Isolate TCP FIN flags.</a></li>
          <li><a href="#258-isolate-packets-that-have-both-syn-and-rst-flags-set" id="markdown-toc-258-isolate-packets-that-have-both-syn-and-rst-flags-set">2.5.8 Isolate packets that have both SYN and RST flags set.</a></li>
        </ul>
      </li>
      <li><a href="#26-find-http-user-agents" id="markdown-toc-26-find-http-user-agents">2.6 FIND HTTP USER AGENTS</a></li>
      <li><a href="#27-cleartext-get-requests" id="markdown-toc-27-cleartext-get-requests">2.7 CLEARTEXT GET REQUESTS</a></li>
      <li><a href="#28-find-http-host-headers" id="markdown-toc-28-find-http-host-headers">2.8 FIND HTTP HOST HEADERS</a></li>
      <li><a href="#29-find-http-cookies" id="markdown-toc-29-find-http-cookies">2.9 FIND HTTP COOKIES</a></li>
      <li><a href="#210-find-dns-traffic" id="markdown-toc-210-find-dns-traffic">2.10 FIND DNS TRAFFIC</a></li>
      <li><a href="#211-find-ftp-traffic" id="markdown-toc-211-find-ftp-traffic">2.11 FIND FTP TRAFFIC</a></li>
      <li><a href="#212-find-ntp-traffic" id="markdown-toc-212-find-ntp-traffic">2.12 FIND NTP TRAFFIC</a></li>
      <li><a href="#213-find-cleartext-passwords" id="markdown-toc-213-find-cleartext-passwords">2.13 FIND CLEARTEXT PASSWORDS</a></li>
    </ul>
  </li>
  <li><a href="#3-troubleshooting" id="markdown-toc-3-troubleshooting">3. Troubleshooting</a>    <ul>
      <li><a href="#31-bad-udp-cksum-issue-with-hardware-offloading-offloading-tx-checksumming" id="markdown-toc-31-bad-udp-cksum-issue-with-hardware-offloading-offloading-tx-checksumming">3.1 bad udp cksum: issue with hardware offloading (offloading tx-checksumming)</a></li>
    </ul>
  </li>
  <li><a href="#4-references" id="markdown-toc-4-references">4. References</a></li>
</ul>

<hr />

<h2 id="basics">Basics</h2>

<h4 id="11-basic-communication">1.1 BASIC COMMUNICATION</h4>

<p>Just see what’s going on, by looking at all interfaces.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-i</span> any
</code></pre></div></div>

<h4 id="12-specific-interface">1.2 SPECIFIC INTERFACE</h4>

<p>Basic view of what’s happening on a particular interface.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-i</span> eth0
</code></pre></div></div>

<h4 id="13-raw-output-view">1.3 RAW OUTPUT VIEW</h4>

<p>Verbose output (<code class="language-plaintext highlighter-rouge">-vv</code>), with no resolution of hostnames or port numbers (<code class="language-plaintext highlighter-rouge">-nn</code>), absolute sequence numbers (<code class="language-plaintext highlighter-rouge">-S</code>), and human-readable timestamps (<code class="language-plaintext highlighter-rouge">-tttt</code>).</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-ttttnnvvS</span>
</code></pre></div></div>

<h4 id="14-find-traffic-by-ip">1.4 FIND TRAFFIC BY IP</h4>

<p>One of the most common queries, this will show you traffic from 1.2.3.4, whether it’s the source or the destination.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump host 1.2.3.4
</code></pre></div></div>

<h4 id="15-seeing-more-of-the-packet-with-hex-output">1.5 SEEING MORE OF THE PACKET WITH HEX OUTPUT</h4>

<p>Hex output is useful when you want to see the content of the packets in question, and it’s often best used when you’re isolating a few candiates for closer scrutiny.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-nnvXSs0</span> icmp
</code></pre></div></div>

<h4 id="16-filtering-by-source-and-destination">1.6 FILTERING BY SOURCE AND DESTINATION</h4>

<p>It’s quite easy to isolate traffic based on either source or destination using <code class="language-plaintext highlighter-rouge">src</code> and <code class="language-plaintext highlighter-rouge">dst</code>.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump src 2.3.4.5
tcpdump dst 3.4.5.6
</code></pre></div></div>

<h4 id="17-finding-packets-by-network">1.7 FINDING PACKETS BY NETWORK</h4>

<p>To find packets going to or from a particular network, use the <code class="language-plaintext highlighter-rouge">net</code> option. You can combine this with the <code class="language-plaintext highlighter-rouge">src</code> or <code class="language-plaintext highlighter-rouge">dst</code> options as well.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump net 1.2.3.0/24
</code></pre></div></div>

<h4 id="18-show-traffic-related-to-a-specific-port">1.8 SHOW TRAFFIC RELATED TO A SPECIFIC PORT</h4>

<p>You can find specific port traffic by using the <code class="language-plaintext highlighter-rouge">port</code> option followed by the port number.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump port 3389
tcpdump src port 3389
</code></pre></div></div>

<h4 id="19-show-traffic-of-one-protocol">1.9 SHOW TRAFFIC OF ONE PROTOCOL</h4>

<p>If you’re looking one particular kind of traffic, you can use tcp (or proto 6), udp (or proto 17) and many others as well.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump tcp <span class="c"># same as tcpdump proto 6</span>
</code></pre></div></div>

<h4 id="110-show-only-ip6-traffic">1.10 SHOW ONLY IP6 TRAFFIC</h4>

<p>You can also find all IPv6 traffic using the protocol option.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump ip6
</code></pre></div></div>

<h4 id="111-find-traffic-using-port-ranges">1.11 FIND TRAFFIC USING PORT RANGES</h4>

<p>You can also use a range of ports to find traffic.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump portrange 21-23
</code></pre></div></div>

<h4 id="112-find-traffic-based-on-packet-size">1.12 FIND TRAFFIC BASED ON PACKET SIZE</h4>

<p>If you’re looking for packets of a particular size you can use these options. You can use less, greater, or their associated symbols that you would expect from mathmatics.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump less 32
tcpdump greater 64
tcpdump &lt;<span class="o">=</span>128
</code></pre></div></div>

<h4 id="113-reading--writing-captures-to-a-file">1.13 READING / WRITING CAPTURES TO A FILE</h4>

<p>It’s often useful to save packet captures into a file for analysis in the future. These files are known as PACAP (PEE-cap) files, and they can be processed by hundreds of different applications (e.g. Wireshark), including network analyzers, intrusion detection systems, and of course by <code class="language-plaintext highlighter-rouge">tcpdump</code> itself.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump port 80 <span class="nt">-w</span> capture_file.pcap
</code></pre></div></div>

<p>You can read PACAP files by using the <code class="language-plaintext highlighter-rouge">-r</code> switch. Note that you can use all the regular commands within tcpdump while reading in a file; you’re only limited by the fact that you can’t capture and process what doesn’t exist in the file already.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-r</span> capture_file.pcap
</code></pre></div></div>

<h2 id="advanced">Advanced</h2>

<h4 id="21-from-specific-ip-and-destined-for-a-specific-port">2.1 FROM SPECIFIC IP AND DESTINED FOR A SPECIFIC PORT</h4>

<p>Let’s find all traffic form 10.5.2.3 going to any host on port 3389.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-nnvvS</span> src 10.5.2.3 and dst port 3389
</code></pre></div></div>

<h4 id="22-find-one-network-to-another">2.2 FIND ONE NETWORK TO ANOTHER</h4>

<p>Let’s look for all traffic comming from 192.168.x.x and goning to the 10.x or 172.16.x.x networks, and we’re showing hex output with no hostname resolution and one level of extra verbosity.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-nvX</span> src net 192.168.0.0/16 and dst net 10.0.0.0/8 or 172.16.0.0/16
</code></pre></div></div>

<h4 id="23-non-icmp-traffic-going-to-a-specific-ip">2.3 NON ICMP TRAFFIC GOING TO A SPECIFIC IP</h4>

<p>This will show us all traffic goning to 192.168.0.2 that is <em>not</em> ICMP.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump dst 192.168.0.2 and not icmp
</code></pre></div></div>

<h4 id="24-traffic-from-a-host-that-isnt-on-a-specific-port">2.4 TRAFFIC FROM A HOST THAT ISN’T ON A SPECIFIC PORT</h4>

<p>This will show us all traffic from a host and isn’t SSH traffic (assuming default port usage).</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-vv</span> src mars and not dst port 22
</code></pre></div></div>

<p>Keep in mind that when you’re building complex queries you might have to group your options using single quotes. Single quotes are used in order to tell <code class="language-plaintext highlighter-rouge">tcpdump</code> to ignore certain special characters—in this case below the “()” brackets. The same technique can be used to group using other expressions such as <code class="language-plaintext highlighter-rouge">host</code>, <code class="language-plaintext highlighter-rouge">port</code>, <code class="language-plaintext highlighter-rouge">net</code>, etc.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="s1">'src 10.0.2.4 and (dst port 3389 or 22)'</span>
</code></pre></div></div>

<h4 id="25-isolate-tcp-flags">2.5 ISOLATE TCP FLAGS</h4>

<p>You can also use filters to isolate packets with specific TCP flags set.</p>

<h5 id="251-isolate-tcp-rst-flags">2.5.1 Isolate TCP RST flags.</h5>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="s1">'tcp[13] &amp; 4 != 0'</span>
tcpdump <span class="s1">'tcp[tcpflags] == tcp-rst'</span>
</code></pre></div></div>

<h5 id="252-isolate-tcp-sync-flags">2.5.2 Isolate TCP SYNC flags.</h5>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="s1">'tcp[13] &amp; 2 != 0'</span>
tcpdump <span class="s1">'tcp[tcpflags] == tcp-syn'</span>
</code></pre></div></div>

<h5 id="253-isolate-packets-that-have-both-syn-and-ack-flags-set">2.5.3 Isolate packets that have both SYN and ACK flags set.</h5>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="s1">'tcp[13] = 18'</span>
</code></pre></div></div>

<h5 id="254-isolate-tcp-urg-flags">2.5.4 Isolate TCP URG flags.</h5>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="s1">'tcp[13] &amp; 32 != 0'</span>
tcpdump <span class="s1">'tcp[tcpflags] == tcp-urg'</span>
</code></pre></div></div>

<h5 id="255-isolate-tcp-ack-flags">2.5.5 Isolate TCP ACK flags.</h5>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="s1">'tcp[13] &amp; 16!=0'</span>
tcpdump <span class="s1">'tcp[tcpflags] == tcp-ack'</span>
</code></pre></div></div>

<h5 id="256-isolate-tcp-psh-flags">2.5.6 Isolate TCP PSH flags.</h5>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="s1">'tcp[13] &amp; 8!=0'</span>
tcpdump <span class="s1">'tcp[tcpflags] == tcp-psh'</span>
</code></pre></div></div>

<h5 id="257-isolate-tcp-fin-flags">2.5.7 Isolate TCP FIN flags.</h5>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="s1">'tcp[13] &amp; 1!=0'</span>
tcpdump <span class="s1">'tcp[tcpflags] == tcp-fin'</span>
</code></pre></div></div>

<h5 id="258-isolate-packets-that-have-both-syn-and-rst-flags-set">2.5.8 Isolate packets that have both SYN and RST flags set.</h5>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="s1">'tcp[13] = 6'</span>
</code></pre></div></div>

<h4 id="26-find-http-user-agents">2.6 FIND HTTP USER AGENTS</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-vvAls0</span> | <span class="nb">grep</span> <span class="s1">'User-Agent:'</span>
</code></pre></div></div>

<h4 id="27-cleartext-get-requests">2.7 CLEARTEXT GET REQUESTS</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-vvAls0</span> | <span class="nb">grep</span> <span class="s1">'GET'</span>
</code></pre></div></div>

<h4 id="28-find-http-host-headers">2.8 FIND HTTP HOST HEADERS</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-vvAls0</span> | <span class="nb">grep</span> <span class="s1">'Host:'</span>
</code></pre></div></div>

<h4 id="29-find-http-cookies">2.9 FIND HTTP COOKIES</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-vvAls0</span> | egrep <span class="s1">'Set-Cookie:|Cookie:'</span>
</code></pre></div></div>

<h4 id="210-find-dns-traffic">2.10 FIND DNS TRAFFIC</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-vvAs0</span> port 53
</code></pre></div></div>

<h4 id="211-find-ftp-traffic">2.11 FIND FTP TRAFFIC</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-vvAs0</span> port ftp or ftp-data
</code></pre></div></div>

<h4 id="212-find-ntp-traffic">2.12 FIND NTP TRAFFIC</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump <span class="nt">-vvAs0</span> port 123
</code></pre></div></div>

<h4 id="213-find-cleartext-passwords">2.13 FIND CLEARTEXT PASSWORDS</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tcpdump port http or port ftp or port smtp or port imap or port pop3 or port telnet <span class="nt">-lA</span> | egrep <span class="nt">-i</span> <span class="nt">-B5</span> <span class="s1">'pass=|pwd=|log=|login=|user=|username=|pw=|passw=|passwd=|password=|pass:|user:|username:|password:|login:|pass |user '</span> 
</code></pre></div></div>

<h2 id="3-troubleshooting">3. Troubleshooting</h2>

<h4 id="31-bad-udp-cksum-issue-with-hardware-offloading-offloading-tx-checksumming">3.1 bad udp cksum: issue with hardware offloading (offloading tx-checksumming)</h4>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>tcpdump <span class="nt">-s</span> 1500 <span class="nt">-i</span> ens32 <span class="nt">-nvv</span> icmp or port tftp
<span class="go">tcpdump: listening on ens32, link-type EN10MB (Ethernet), snapshot length 1500 bytes
09:51:31.613595 IP (tos 0x0, ttl 64, id 16236, offset 0, flags [DF], proto UDP (17), length 44)
</span><span class="gp">    192.168.91.128.49586 &gt;</span><span class="w"> </span>10.170.108.237.69: <span class="o">[</span>bad udp <span class="nb">cksum </span>0x93e9 -&gt; 0x7770!] TFTP, length 16, RRQ <span class="s2">"/foo"</span> netascii
<span class="go">09:51:36.614757 IP (tos 0x0, ttl 64, id 16561, offset 0, flags [DF], proto UDP (17), length 44)
</span><span class="gp">    192.168.91.128.49586 &gt;</span><span class="w"> </span>10.170.108.237.69: <span class="o">[</span>bad udp <span class="nb">cksum </span>0x93e9 -&gt; 0x7770!] TFTP, length 16, RRQ <span class="s2">"/foo"</span> netascii
<span class="go">09:51:41.615174 IP (tos 0x0, ttl 64, id 17473, offset 0, flags [DF], proto UDP (17), length 44)
</span><span class="gp">    192.168.91.128.49586 &gt;</span><span class="w"> </span>10.170.108.237.69: <span class="o">[</span>bad udp <span class="nb">cksum </span>0x93e9 -&gt; 0x7770!] TFTP, length 16, RRQ <span class="s2">"/foo"</span> netascii
<span class="go">09:51:46.616206 IP (tos 0x0, ttl 64, id 17689, offset 0, flags [DF], proto UDP (17), length 44)
</span><span class="gp">    192.168.91.128.49586 &gt;</span><span class="w"> </span>10.170.108.237.69: <span class="o">[</span>bad udp <span class="nb">cksum </span>0x93e9 -&gt; 0x7770!] TFTP, length 16, RRQ <span class="s2">"/foo"</span> netascii
<span class="go">09:51:51.617006 IP (tos 0x0, ttl 64, id 18773, offset 0, flags [DF], proto UDP (17), length 44)
</span><span class="gp">    192.168.91.128.49586 &gt;</span><span class="w"> </span>10.170.108.237.69: <span class="o">[</span>bad udp <span class="nb">cksum </span>0x93e9 -&gt; 0x7770!] TFTP, length 16, RRQ <span class="s2">"/foo"</span> netascii
</code></pre></div></div>

<p>After checking active NIC hardware offloading options you can see the obvious</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>ethtool <span class="nt">-k</span> eth0 | <span class="nb">grep </span>on
<span class="go">rx-checksumming: on
tx-checksumming: on
scatter-gather: on
generic-segmentation-offload: on
generic-receive-offload: on
rx-vlan-offload: on
tx-vlan-offload: on
</span></code></pre></div></div>

<p>After disabling TCO (tcp offloading) for TX/RX on the NIC the problem is gone</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>ethtool <span class="nt">-K</span> eth0 tx off rx off
</code></pre></div></div>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>tcpdump <span class="nt">-s</span> 1500 <span class="nt">-i</span> ens32 <span class="nt">-nvv</span> icmp or port tftp
<span class="go">tcpdump: listening on ens32, link-type EN10MB (Ethernet), snapshot length 1500 bytes
10:44:26.668116 IP (tos 0x0, ttl 64, id 10862, offset 0, flags [DF], proto UDP (17), length 44)
</span><span class="gp">    192.168.91.128.34984 &gt;</span><span class="w"> </span>10.170.108.237.69: <span class="o">[</span>udp <span class="nb">sum </span>ok] TFTP, length 16, RRQ <span class="s2">"/foo"</span> netascii
<span class="go">10:44:31.668327 IP (tos 0x0, ttl 64, id 11126, offset 0, flags [DF], proto UDP (17), length 44)
</span><span class="gp">    192.168.91.128.34984 &gt;</span><span class="w"> </span>10.170.108.237.69: <span class="o">[</span>udp <span class="nb">sum </span>ok] TFTP, length 16, RRQ <span class="s2">"/foo"</span> netascii
</code></pre></div></div>

<h2 id="4-references">4. References</h2>

<ul>
  <li><a href="https://hackertarget.com/tcpdump-examples/">https://hackertarget.com/tcpdump-examples/</a></li>
  <li><a href="https://danielmiessler.com/study/tcpdump/">https://danielmiessler.com/study/tcpdump/</a></li>
</ul>

  </div>

  <ul class="post-navigation">
    <li>
      
      <a href="/2018/12/27/intall-minikube-with-kubeadm-on-debian/">&laquo; Intall Minikube with kubeadm on Debian 9</a>
      
    </li>
    <li>
      
      <a href="/2019/01/28/bootstrapping-kubernetes-clusters-with-kubeadm/">Bootstrapping Kubernetes Clusters with kubeadm &raquo;</a>
      
    </li>
  </ul>
</article>

      </div>
    </div>

    <footer class="site-footer">
  <div class="license">
    <span>Article licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></span>
  </div>
  
  <details open>
    <summary>Extral Links</summary>
    <div>
      
      <a href="https://jekyllrb.com/">Jekyll</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://shopify.github.io/">Liquid</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://docs.asciidoctor.org/">Asciidoctor</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://github.com/qqbuby/">GitHub</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="/feed.xml">RSS</a>
      
      
    </div>
  </details>
  
</footer>


<!-- https://github.com/bryanbraun/anchorjs -->
<script src="/js/anchor.min.js"></script>
<script>
  anchors.add();
  anchors.remove(".site-title");
</script>




  </body>

</html>
