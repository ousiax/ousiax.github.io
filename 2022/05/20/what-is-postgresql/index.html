<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bing WebMaster -->
  <meta name="msvalidate.01" content="AB2FFF876C37F59D9121882CC8395DE5" />

  <title>What Is PostgreSQL</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://blog.codefarm.me/2022/05/20/what-is-postgresql/">
  <link rel="alternate" type="application/rss+xml" title="CODE FARM" href="https://blog.codefarm.me/feed.xml">

  <!-- https://cdn.jsdelivr.net/gh/lurongkai/anti-baidu/js/anti-baidu-latest.min.js -->
<script type="text/javascript" src="/js/anti-baidu.min.js" charset="UTF-8"></script>

  
<!-- Google Analytics Website tracking -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83971182-1', 'auto');
  ga('send', 'pageview');

</script>


  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SN88FJ18E5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SN88FJ18E5');
</script>



</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <h2 class="site-title">
      <a class="site-title" href="/">CODE FARM</a>
    </h2>

     <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
        <div class="trigger">
            <ul>
                <li><a href="/">home</a>
                <li><a href="/category">category</a>
                <li><a href="/tag">tag</a>
                <li><a href="/archive">archive</a>
                <li><a href="/about">about</a>
                <li><a href="https://resume.github.io/?qqbuby" target="_blank">R&eacute;sum&eacute;</a>
            </ul>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">What Is PostgreSQL</h1>
    
    
    <p class="post-meta"><time datetime="2022-05-20T09:36:40+08:00" itemprop="datePublished">May 20, 2022</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#what-is-postgresql">1. What Is PostgreSQL?</a></li>
<li><a href="#installation-from-docker">2. Installation from Docker</a>
<ul class="sectlevel2">
<li><a href="#start-a-postgres-instance">2.1. start a postgres instance</a></li>
<li><a href="#or-via-psql">2.2. &#8230;&#8203; or via psql</a></li>
<li><a href="#via-docker-compose">2.3. &#8230;&#8203; via docker-compose</a></li>
</ul>
</li>
<li><a href="#clusters-databases-tables-rows-columns">3. Clusters, Databases, Tables, Rows, Columns</a></li>
<li><a href="#schemas">4. Schemas</a>
<ul class="sectlevel2">
<li><a href="#creating-a-schema">4.1. Creating a Schema</a></li>
<li><a href="#the-public-schema">4.2. The Public Schema</a></li>
<li><a href="#the-schema-search-path">4.3. The Schema Search Path</a></li>
<li><a href="#schemas-and-privileges">4.4. Schemas and Privileges</a></li>
<li><a href="#the-system-catalog-schema">4.5. The System Catalog Schema</a></li>
<li><a href="#portability">4.6. Portability</a></li>
</ul>
</li>
<li><a href="#tablespaces">5. Tablespaces</a></li>
<li><a href="#database-roles">6. Database Roles</a>
<ul class="sectlevel2">
<li><a href="#database-roles-2">6.1. Database Roles</a></li>
<li><a href="#role-attributes">6.2. Role Attributes</a></li>
<li><a href="#role-membership">6.3. Role Membership</a></li>
<li><a href="#predefined-roles">6.4. Predefined Roles</a></li>
</ul>
</li>
<li><a href="#privileges">7. Privileges</a></li>
<li><a href="#references">8. References</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="what-is-postgresql">1. What Is PostgreSQL?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PostgreSQL is an object-relational database management system (ORDBMS) based on <a href="https://dsf.berkeley.edu/postgres.html">POSTGRES, Version 4.2</a>, developed at the University of California at Berkeley Computer Science Department. POSTGRES pioneered many concepts that only became available in some commercial database systems much later.</p>
</div>
<div class="paragraph">
<p>PostgreSQL is an open-source descendant of this original Berkeley code. It supports a large part of the SQL standard and offers many modern features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>complex queries</p>
</li>
<li>
<p>foreign keys</p>
</li>
<li>
<p>triggers</p>
</li>
<li>
<p>updatable views</p>
</li>
<li>
<p>transactional integrity</p>
</li>
<li>
<p>multiversion concurrency control</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, PostgreSQL can be extended by the user in many ways, for example by adding new</p>
</div>
<div class="ulist">
<ul>
<li>
<p>data types</p>
</li>
<li>
<p>functions</p>
</li>
<li>
<p>operators</p>
</li>
<li>
<p>aggregate functions</p>
</li>
<li>
<p>index methods</p>
</li>
<li>
<p>procedural languages</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation-from-docker">2. Installation from Docker</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="start-a-postgres-instance">2.1. start a postgres instance</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>docker run <span class="nt">--name</span> some-postgres <span class="nt">-e</span> <span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>mysecretpassword <span class="nt">-d</span> postgres</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="or-via-psql">2.2. &#8230;&#8203; or via psql</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">--network</span> some-network postgres psql <span class="nt">-h</span> some-postgres <span class="nt">-U</span> postgres
<span class="go">psql (9.5.0)
Type "help" for help.

</span><span class="gp">postgres=#</span><span class="w"> </span>SELECT 1<span class="p">;</span>
<span class="go"> ?column?
----------
        1
(1 row)</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="via-docker-compose">2.3. &#8230;&#8203; via <a href="https://github.com/docker/compose">docker-compose</a></h3>
<div class="listingblock">
<div class="title">compose.yaml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">services</span><span class="pi">:</span>
  <span class="na">database</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:14</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">on-failure</span>
      <span class="s"># The PostgreSQL image uses several environment variables which are easy to miss.</span>
      <span class="s"># The only variable required is POSTGRES_PASSWORD, the rest are optional.</span>
      <span class="s">#</span>
      <span class="s"># Warning</span><span class="err">:</span> <span class="s">the Docker specific variables will only have an effect if you start</span>
      <span class="s"># the container with a data directory that is empty; any pre-existing database</span>
      <span class="s"># will be left untouched on container startup.</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="c1"># This environment variable is required for you to use the PostgreSQL image.</span>
      <span class="c1"># It must not be empty or undefined. This environment variable sets the superuser</span>
      <span class="c1"># password for PostgreSQL.</span>
      <span class="c1"># The default superuser is defined by the POSTGRES_USER environment variable.</span>
      <span class="c1">#</span>
      <span class="c1"># Note 1: The PostgreSQL image sets up trust authentication locally so you may notice</span>
      <span class="c1"># a password is not required when connecting from localhost (inside the same container).</span>
      <span class="c1"># However, a password will be required if connecting from a different host/container.</span>
      <span class="c1">#</span>
      <span class="c1"># Note 2: This variable defines the superuser password in the PostgreSQL instance, as</span>
      <span class="c1"># set by the initdb script during initial container startup. It has no effect on the</span>
      <span class="c1"># PGPASSWORD environment variable that may be used by the psql client at runtime, as</span>
      <span class="c1"># described at https://www.postgresql.org/docs/current/libpq-envars.html.</span>
      <span class="c1"># PGPASSWORD, if used, will be specified as a separate environment variable.</span>
      <span class="c1">#</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">postgres</span>

      <span class="c1"># This optional environment variable is used in conjunction with POSTGRES_PASSWORD to</span>
      <span class="c1"># set a user and its password. This variable will create the specified user with</span>
      <span class="c1"># superuser power and a database with the same name. If it is not specified, then the</span>
      <span class="c1"># default user of `postgres` will be used.</span>
      <span class="c1">#</span>
      <span class="c1"># Be aware that if this parameter is specified, PostgreSQL will still show The files</span>
      <span class="c1"># belonging to this database system will be owned by user "postgres" during initialization.</span>
      <span class="c1"># This refers to the Linux system user (from /etc/passwd in the image) that the postgres</span>
      <span class="c1"># daemon runs as, and as such is unrelated to the POSTGRES_USER option.</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">postgres</span>

      <span class="c1"># This optional environment variable can be used to define a different name for the</span>
      <span class="c1"># default database that is created when the image is first started. If it is not</span>
      <span class="c1"># specified, then the value of `POSTGRES_USER` will be used.</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">postgres</span>

      <span class="c1"># This optional variable can be used to define another location - like a subdirectory - for</span>
      <span class="c1"># the database files. The default is /var/lib/postgresql/data. If the data volume you're</span>
      <span class="c1"># using is a filesystem mountpoint (like with GCE persistent disks) or remote folder that</span>
      <span class="c1"># cannot be chowned to the postgres user (like some NFS mounts), Postgres initdb recommends</span>
      <span class="c1"># a subdirectory be created to contain the data.</span>
      <span class="c1">#</span>
      <span class="c1"># For example:</span>
      <span class="c1">#</span>
      <span class="c1"># $ docker run -d \</span>
      <span class="c1"># 	--name some-postgres \</span>
      <span class="c1"># 	-e POSTGRES_PASSWORD=mysecretpassword \</span>
      <span class="c1"># 	-e PGDATA=/var/lib/postgresql/data/pgdata \</span>
      <span class="c1"># 	-v /custom/mount:/var/lib/postgresql/data \</span>
      <span class="c1"># 	postgres</span>
      <span class="c1">#</span>
      <span class="c1"># This is an environment variable that is not Docker specific. Because the variable is used by</span>
      <span class="c1"># the postgres server binary (see the PostgreSQL docs), the entrypoint script takes it into account.</span>
      <span class="na">PGDATA</span><span class="pi">:</span> <span class="s">/var/lib/postgresql/data/pgdata</span>

    <span class="na">volumes</span><span class="pi">:</span> <span class="pi">[]</span>
      <span class="c1"># If you would like to do additional initialization in an image derived from this one,</span>
      <span class="c1"># add one or more *.sql, *.sql.gz, or *.sh scripts</span>
      <span class="c1"># under /docker-entrypoint-initdb.d (creating the directory if necessary). After the</span>
      <span class="c1"># entrypoint calls initdb to create the default postgres user and database, it will run</span>
      <span class="c1"># any *.sql files, run any executable *.sh scripts, and source any non-executable *.sh</span>
      <span class="c1"># scripts found in that directory to do further initialization before starting the service.</span>
      <span class="c1">#</span>
      <span class="c1"># Warning: scripts in /docker-entrypoint-initdb.d are only run if you start the container</span>
      <span class="c1"># with a data directory that is empty; any pre-existing database will be left untouched on</span>
      <span class="c1"># container startup. One common problem is that if one of your /docker-entrypoint-initdb.d</span>
      <span class="c1"># scripts fails (which will cause the entrypoint script to exit) and your orchestrator</span>
      <span class="c1"># restarts the container with the already initialized data directory, it will not continue</span>
      <span class="c1"># on with your scripts.</span>
      <span class="c1">#</span>
      <span class="c1"># These initialization files will be executed in sorted name order as defined by the current</span>
      <span class="c1"># locale, which defaults to en_US.utf8. Any *.sql files will be executed by POSTGRES_USER,</span>
      <span class="c1"># which defaults to the postgres superuser. It is recommended that any psql commands that are</span>
      <span class="c1"># run inside of a *.sh script be executed as POSTGRES_USER by using</span>
      <span class="c1"># the --username "$POSTGRES_USER" flag. This user will be able to connect without a password</span>
      <span class="c1"># due to the presence of trust authentication for Unix socket connections made inside the container.</span>
      <span class="c1">#</span>
      <span class="c1"># - ./init.sql:/docker-entrypoint-initdb.d/1-init.sql</span>
      <span class="c1"># - ./data.sql:/docker-entrypoint-initdb.d/2-data.sql</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>docker-compose config
<span class="go">services:
  database:
    environment:
      PGDATA: /var/lib/postgresql/data/pgdata
      POSTGRES_DB: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_USER: postgres
    image: postgres:14
    restart: on-failure
    volumes: []
version: '3.9'

</span><span class="gp">$</span><span class="w"> </span>docker-compose up <span class="nt">-d</span>
<span class="go">Creating network "pg_default" with the default driver
Creating pg_database_1 ... done

</span><span class="gp">$</span><span class="w"> </span>docker-compose <span class="nb">exec </span>database psql <span class="nt">-U</span> postgres
<span class="go">psql (14.2 (Debian 14.2-1.pgdg110+1))
Type "help" for help.

</span><span class="gp">postgres=#</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="clusters-databases-tables-rows-columns">3. Clusters, Databases, Tables, Rows, Columns</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PostgreSQL is a <strong>relational database management system</strong> (RDBMS). That means it is a system for managing data stored in <strong>relations</strong>. Relation is essentially a mathematical term for <strong>table</strong>. The notion of storing data in tables is so commonplace today that it might seem inherently obvious, but there are a number of other ways of organizing databases. Files and directories on Unix-like operating systems form an example of a hierarchical database. A more modern development is the object-oriented database.</p>
</div>
<div class="paragraph">
<p>Each table is a named collection of <strong>rows</strong>. Each row of a given table has the same set of named <strong>columns</strong>, and each column is of a specific data type. Whereas columns have a fixed order in each row, it is important to remember that SQL does not guarantee the order of the rows within the table in any way (although they can be explicitly sorted for display).</p>
</div>
<div class="paragraph">
<p>Tables are grouped into <strong>databases</strong>, and a collection of databases managed by a single PostgreSQL server instance constitutes a <strong>database cluster</strong>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Databases are called “catalogs” in the SQL standard.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>see also: <a href="https://stackoverflow.com/questions/7022755/whats-the-difference-between-a-catalog-and-a-schema-in-a-relational-database" class="bare">https://stackoverflow.com/questions/7022755/whats-the-difference-between-a-catalog-and-a-schema-in-a-relational-database</a></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ceate a login user named 'test' with password 'test'</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">USER</span> <span class="n">test</span> <span class="k">OWNER</span> <span class="n">test</span> <span class="n">PASSWORD</span> <span class="s1">'test'</span><span class="p">;</span></code></pre>
</div>
</div>
</li>
<li>
<p>ceate a database/catalog as the user same name, i.e. 'test'</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">test</span><span class="p">;</span></code></pre>
</div>
</div>
</li>
<li>
<p>connect the <code>test</code> catalog with <strong>psql</strong></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>psql <span class="nt">--host</span> localhost <span class="nt">--user</span> <span class="nb">test</span>
<span class="go">Password for user test:
psql (13.9 (Debian 13.9-0+deb11u1), server 13.10 (Debian 13.10-1.pgdg110+1))
Type "help" for help.

</span><span class="gp">test=&gt;</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="schemas">4. Schemas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A PostgreSQL database cluster contains one or more named databases. Roles and a few other object types are shared across the entire cluster. A client connection to the server can only access data in a single database, the one specified in the connection request.</p>
</div>
<div class="paragraph">
<p>A database contains one or more named <strong>schemas</strong>, which in turn contain tables. Schemas also contain other kinds of named objects, including data types, functions, and operators. The same object name can be used in different schemas without conflict; for example, both schema1 and myschema can contain tables named mytable. Unlike databases, schemas are not rigidly separated: a user can access objects in any of the schemas in the database they are connected to, if they have privileges to do so.</p>
</div>
<div class="paragraph">
<p>There are several reasons why one might want to use schemas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To allow many users to use one database without interfering with each other.</p>
</li>
<li>
<p>To organize database objects into logical groups to make them more manageable.</p>
</li>
<li>
<p>Third-party applications can be put into separate schemas so they do not collide with the names of other objects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Schemas are analogous to directories at the operating system level, except that schemas cannot be nested.</p>
</div>
<div class="sect2">
<h3 id="creating-a-schema">4.1. Creating a Schema</h3>
<div class="paragraph">
<p>To create a schema, use the CREATE SCHEMA command. Give the schema a name of your choice. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">myschema</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To create or access objects in a schema, write a <strong>qualified name</strong> consisting of the schema name and table name separated by a dot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">schema</span><span class="p">.</span><span class="k">table</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Actually, the even more general syntax</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">database</span><span class="p">.</span><span class="k">schema</span><span class="p">.</span><span class="k">table</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>can be used too, but at present this is just for pro forma compliance with the SQL standard. If you write a database name, it must be the same as the database you are connected to.</p>
</div>
<div class="paragraph">
<p>To drop a schema if it&#8217;s empty (all objects in it have been dropped), use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">SCHEMA</span> <span class="n">myschema</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To drop a schema including all contained objects, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">SCHEMA</span> <span class="n">myschema</span> <span class="k">CASCADE</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Schema names beginning with <strong>pg_</strong> are reserved for system purposes and cannot be created by users.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-public-schema">4.2. The Public Schema</h3>
<div class="paragraph">
<p>By default tables (and other objects) are automatically put into a schema named “public”. Every new database contains such a schema. Thus, the following are equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="p">(</span> <span class="p">...</span> <span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">public</span><span class="p">.</span><span class="n">products</span> <span class="p">(</span> <span class="p">...</span> <span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-schema-search-path">4.3. The Schema Search Path</h3>
<div class="paragraph">
<p>Qualified names are tedious to write, and it&#8217;s often best not to wire a particular schema name into applications anyway. Therefore tables are often referred to by <strong>unqualified names</strong>, which consist of just the table name. The system determines which table is meant by following a <strong>search path</strong>, which is a list of schemas to look in. The first matching table in the search path is taken to be the one wanted. If there is no match in the search path, an error is reported, even if matching table names exist in other schemas in the database.</p>
</div>
<div class="paragraph">
<p>The first schema named in the search path is called the <strong>current schema</strong>. Aside from being the first schema searched, it is also the schema in which new tables will be created if the CREATE TABLE command does not specify a schema name.</p>
</div>
<div class="paragraph">
<p>To show the current search path, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SHOW</span> <span class="n">search_path</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the default setup this returns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text"> search_path
--------------
 "$user", public</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first element specifies that a schema with the same name as the current user is to be searched. If no such schema exists, the entry is ignored. The second element refers to the public schema that we have seen already.</p>
</div>
<div class="paragraph">
<p><strong>The first schema in the search path that exists is the default location for creating new objects.</strong> That is the reason that by default objects are created in the public schema. When objects are referenced in any other context without schema qualification (table modification, data modification, or query commands) the search path is traversed until a matching object is found. Therefore, in the default configuration, any unqualified access again can only refer to the public schema.</p>
</div>
<div class="paragraph">
<p>To put our new schema in the path, we use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SET</span> <span class="n">search_path</span> <span class="k">TO</span> <span class="n">myschema</span><span class="p">,</span><span class="k">public</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="schemas-and-privileges">4.4. Schemas and Privileges</h3>
<div class="paragraph">
<p>By default, users cannot access any objects in schemas they do not own. To allow that, the owner of the schema must grant the <strong>USAGE</strong> privilege on the schema. To allow users to make use of the objects in the schema, additional privileges might need to be granted, as appropriate for the object.</p>
</div>
<div class="paragraph">
<p>A user can also be allowed to create objects in someone else&#8217;s schema. To allow that, the <strong>CREATE</strong> privilege on the schema needs to be granted. Note that by default, everyone has <strong>CREATE</strong> and <strong>USAGE</strong> privileges on the schema <strong>public</strong>. This allows all users that are able to connect to a given database to create objects in its <strong>public</strong> schema.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-system-catalog-schema">4.5. The System Catalog Schema</h3>
<div class="paragraph">
<p>In addition to <em>public</em> and <em>user-created</em> schemas, <em>each database contains a <strong>pg_catalog</strong> schema</em>, which contains the system tables and all the built-in data types, functions, and operators. <em>pg_catalog</em> is always effectively part of the search path.</p>
</div>
<div class="paragraph">
<p>If it is not named explicitly in the path then it is implicitly searched before searching the path&#8217;s schemas. This ensures that built-in names will always be findable. However, you can explicitly place <em>pg_catalog</em> at the end of your search path if you prefer to have user-defined names override built-in names.</p>
</div>
<div class="paragraph">
<p>Since system table names begin with <strong>pg_</strong>, it is best to avoid such names to ensure that you won&#8217;t suffer a conflict if some future version defines a system table named the same as your table. (With the default search path, an unqualified reference to your table name would then be resolved as the system table instead.) System tables will continue to follow the convention of having names beginning with <strong>pg_</strong>, so that they will not conflict with unqualified user-table names so long as users avoid the <strong>pg_</strong> prefix.</p>
</div>
</div>
<div class="sect2">
<h3 id="portability">4.6. Portability</h3>
<div class="paragraph">
<p>In the SQL standard, the notion of objects in the same schema being owned by different users does not exist. Moreover, some implementations do not allow you to create schemas that have a different name than their owner. In fact, the concepts of schema and user are nearly equivalent in a database system that implements only the basic schema support specified in the standard. Therefore, many users consider qualified names to really consist of <strong>user_name.table_name</strong>. This is how PostgreSQL will effectively behave if you create a per-user schema for every user.</p>
</div>
<div class="paragraph">
<p>Also, there is no concept of a <strong>public</strong> schema in the SQL standard. For maximum conformance to the standard, you should not use the public schema.</p>
</div>
<div class="paragraph">
<p>Of course, some SQL database systems might not implement schemas at all, or provide namespace support by allowing (possibly limited) cross-database access. If you need to work with those systems, then maximum portability would be achieved by not using schemas at all.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tablespaces">5. Tablespaces</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tablespaces in PostgreSQL allow database administrators to define locations in the file system where the files representing database objects can be stored. Once created, a tablespace can be referred to by name when creating database objects.</p>
</div>
<div class="paragraph">
<p>By using tablespaces, an administrator can control the <strong>disk layout</strong> of a PostgreSQL installation. This is useful in at least two ways.</p>
</div>
<div class="paragraph">
<p>First, if the partition or volume on which the cluster was initialized runs out of space and cannot be extended, a tablespace can be created on a different partition and used until the system can be reconfigured.</p>
</div>
<div class="paragraph">
<p>Second, tablespaces allow an administrator to use knowledge of the usage pattern of database objects to optimize performance. For example, an index which is very heavily used can be placed on a very fast, highly available disk, such as an expensive solid state device. At the same time a table storing archived data which is rarely used or not performance critical could be stored on a less expensive, slower disk system.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="database-roles">6. Database Roles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PostgreSQL manages database access permissions using the concept of <strong>roles</strong>.</p>
</div>
<div class="paragraph">
<p><em>A role can be thought of as either a database user, or a group of database users, depending on how the role is set up</em>.</p>
</div>
<div class="paragraph">
<p>Roles can own database objects (for example, tables and functions) and can assign privileges on those objects to other roles to control who has access to which objects.</p>
</div>
<div class="paragraph">
<p>Furthermore, it is possible to grant membership in a role to another role, thus allowing the member role to use privileges assigned to another role.</p>
</div>
<div class="paragraph">
<p>The concept of roles subsumes the concepts of “users” and “groups”. In PostgreSQL versions before 8.1, users and groups were distinct kinds of entities, but now there are only roles. <em>Any role can act as a user, a group, or both.</em></p>
</div>
<div class="sect2">
<h3 id="database-roles-2">6.1. Database Roles</h3>
<div class="paragraph">
<p>Database roles are conceptually completely separate from operating system users. In practice it might be convenient to maintain a correspondence, but this is not required.</p>
</div>
<div class="paragraph">
<p><em>Database roles are global across a database cluster installation (and not per individual database).</em></p>
</div>
<div class="paragraph">
<p>To create a role use the <strong>CREATE ROLE</strong> SQL command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">ROLE</span> <span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To remove an existing role, use the analogous <strong>DROP ROLE</strong> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">ROLE</span> <span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To determine the set of existing roles, examine the <em>pg_roles</em> system catalog, for example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">rolname</span> <span class="k">FROM</span> <span class="n">pg_roles</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>psql</strong> program&#8217;s <strong>\du</strong> meta-command is also useful for listing the existing roles.</p>
</div>
<div class="paragraph">
<p>In order to bootstrap the database system, a freshly initialized system always contains one predefined role. This role is always a “superuser”, and by default (unless altered when running <em>initdb</em>) it will have the same name as the operating system user that initialized the database cluster. Customarily, this role will be named <strong>postgres</strong>. In order to create more roles you first have to connect as this initial role.</p>
</div>
<div class="paragraph">
<p>Every connection to the database server is made using the name of some particular role, and this role determines the initial access privileges for commands issued in that connection. The role name to use for a particular database connection is indicated by the client that is initiating the connection request in an application-specific fashion.</p>
</div>
<div class="paragraph">
<p>For example, the <strong>psql</strong> program uses the <strong>-U</strong> command line option to indicate the role to connect as.</p>
</div>
<div class="paragraph">
<p>Many applications assume the name of the current operating system user by default (including <strong>createuser</strong> and <strong>psql</strong>).</p>
</div>
<div class="paragraph">
<p>Therefore it is often convenient to maintain a naming correspondence between roles and operating system users.</p>
</div>
</div>
<div class="sect2">
<h3 id="role-attributes">6.2. Role Attributes</h3>
<div class="paragraph">
<p>A database role can have a number of attributes that define its privileges and interact with the client authentication system.</p>
</div>
<div class="sect3">
<h4 id="login-privilege">6.2.1. login privilege</h4>
<div class="paragraph">
<p>Only roles that have the <strong>LOGIN</strong> attribute can be used as the initial role name for a database connection. A role with the <strong>LOGIN</strong> attribute can be considered the same as a “<strong>database user</strong>”.</p>
</div>
<div class="paragraph">
<p>To create a role with login privilege, use either:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">ROLE</span> <span class="n">name</span> <span class="n">LOGIN</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">USER</span> <span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>CREATE USER</strong> is equivalent to <strong>CREATE ROLE</strong> except that <strong>CREATE USER</strong> includes <strong>LOGIN</strong> by default, while <strong>CREATE ROLE</strong> does not.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="superuser-status">6.2.2. superuser status</h4>
<div class="paragraph">
<p>A database superuser bypasses all permission checks, except the right to log in. This is a dangerous privilege and should not be used carelessly; it is best to do most of your work as a role that is not a superuser.</p>
</div>
<div class="paragraph">
<p>To create a new database superuser, use <strong>CREATE ROLE name SUPERUSER</strong>. You must do this as a role that is already a superuser.</p>
</div>
</div>
<div class="sect3">
<h4 id="database-creation">6.2.3. database creation</h4>
<div class="paragraph">
<p>A role must be explicitly given permission to create databases (except for superusers, since those bypass all permission checks).</p>
</div>
<div class="paragraph">
<p>To create such a role, use <strong>CREATE ROLE name CREATEDB</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="role-creation">6.2.4. role creation</h4>
<div class="paragraph">
<p>A role must be explicitly given permission to create more roles (except for superusers, since those bypass all permission checks).</p>
</div>
<div class="paragraph">
<p>To create such a role, use <strong>CREATE ROLE name CREATEROLE</strong>.</p>
</div>
<div class="paragraph">
<p>A role with <strong>CREATEROLE</strong> privilege can alter and drop other roles, too, as well as grant or revoke membership in them.</p>
</div>
<div class="paragraph">
<p>However, to create, alter, drop, or change membership of a superuser role, <em>superuser status</em> is required; <strong>CREATEROLE</strong> is insufficient for that.</p>
</div>
</div>
<div class="sect3">
<h4 id="initiating-replication">6.2.5. initiating replication</h4>
<div class="paragraph">
<p>A role must explicitly be given permission to initiate streaming replication (except for superusers, since those bypass all permission checks). A role used for streaming replication must have <strong>LOGIN</strong> permission as well.</p>
</div>
<div class="paragraph">
<p>To create such a role, use <strong>CREATE ROLE name REPLICATION LOGIN</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="password">6.2.6. password</h4>
<div class="paragraph">
<p>A password is only significant if the client authentication method requires the user to supply a password when connecting to the database. The password and md5 authentication methods make use of passwords. Database passwords are separate from operating system passwords.</p>
</div>
<div class="paragraph">
<p>Specify a password upon role creation with <strong>CREATE ROLE name PASSWORD 'string'</strong>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A role&#8217;s attributes can be modified after creation with <strong>ALTER ROLE</strong>. See the reference pages for the <em>CREATE ROLE</em> and <em>ALTER ROLE</em> commands for details.</p>
</div>
<div class="paragraph">
<p>It is good practice to create a role that has the <strong>CREATEDB</strong> and <strong>CREATEROLE</strong> privileges, but is not a superuser, and then use this role for all routine management of databases and roles. This approach avoids the dangers of operating as a superuser for tasks that do not really require it.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="role-membership">6.3. Role Membership</h3>
<div class="paragraph">
<p>It is frequently convenient to group users together to ease management of privileges: that way, privileges can be granted to, or revoked from, a group as a whole. In PostgreSQL this is done by creating a role that represents the group, and then granting membership in the group role to individual user roles.</p>
</div>
<div class="paragraph">
<p>To set up a group role, first create the role:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">ROLE</span> <span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Typically a role being used as a group would not have the <strong>LOGIN</strong> attribute, though you can set it if you wish.</p>
</div>
<div class="paragraph">
<p>Once the group role exists, you can add and remove members using the <strong>GRANT</strong> and <strong>REVOKE</strong> commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">GRANT</span> <span class="n">group_role</span> <span class="k">TO</span> <span class="n">role1</span><span class="p">,</span> <span class="p">...</span> <span class="p">;</span>
<span class="k">REVOKE</span> <span class="n">group_role</span> <span class="k">FROM</span> <span class="n">role1</span><span class="p">,</span> <span class="p">...</span> <span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can grant membership to other group roles, too (since there isn&#8217;t really any distinction between group roles and non-group roles). The database will not let you set up circular membership loops. Also, it is not permitted to grant membership in a role to <strong>PUBLIC</strong>.</p>
</div>
<div class="paragraph">
<p>The members of a group role can use the privileges of the role in two ways. First, every member of a group can explicitly do <strong>SET ROLE</strong> to temporarily “become” the group role. In this state, the database session has access to the privileges of the group role rather than the original login role, and any database objects created are considered owned by the group role not the login role. Second, member roles that have the <strong>INHERIT</strong> attribute automatically have use of the privileges of roles of which they are members, including any privileges inherited by those roles. As an example, suppose we have done:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">ROLE</span> <span class="n">joe</span> <span class="n">LOGIN</span> <span class="n">INHERIT</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">ROLE</span> <span class="k">admin</span> <span class="n">NOINHERIT</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">ROLE</span> <span class="n">wheel</span> <span class="n">NOINHERIT</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">admin</span> <span class="k">TO</span> <span class="n">joe</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="n">wheel</span> <span class="k">TO</span> <span class="k">admin</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="predefined-roles">6.4. Predefined Roles</h3>
<div class="paragraph">
<p>PostgreSQL provides a set of predefined roles that provide access to certain, commonly needed, privileged capabilities and information.</p>
</div>
<div class="paragraph">
<p>Administrators (including roles that have the <code>CREATEROLE</code> privilege) can <code>GRANT</code> these roles to users and/or other roles in their environment, providing those users with access to the specified capabilities and information.</p>
</div>
<div class="paragraph">
<p>see also: <a href="https://www.postgresql.org/docs/14/predefined-roles.html" class="bare">https://www.postgresql.org/docs/14/predefined-roles.html</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="privileges">7. Privileges</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When an object is created, it is assigned an owner. The owner is normally the role that executed the creation statement. For most kinds of objects, the initial state is that only the owner (or a superuser) can do anything with the object. To allow other roles to use it, privileges must be granted.</p>
</div>
<div class="paragraph">
<p>There are different kinds of privileges: <strong>SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER, CREATE, CONNECT, TEMPORARY, EXECUTE</strong>, and <strong>USAGE</strong>. The privileges applicable to a particular object vary depending on the object&#8217;s type (table, function, etc).</p>
</div>
<div class="paragraph">
<p>An object can be assigned to a new owner with an <strong>ALTER</strong> command of the appropriate kind for the object, for example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">table_name</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">new_owner</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Superusers can always do this; ordinary roles can only do it if they are both the current owner of the object (or a member of the owning role) and a member of the new owning role.</p>
</div>
<div class="paragraph">
<p>To assign privileges, the <strong>GRANT</strong> command is used. For example, if joe is an existing role, and accounts is an existing table, the privilege to update the table can be granted with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">GRANT</span> <span class="k">UPDATE</span> <span class="k">ON</span> <span class="n">accounts</span> <span class="k">TO</span> <span class="n">joe</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Writing <strong>ALL</strong> in place of a specific privilege grants all privileges that are relevant for the object type.</p>
</div>
<div class="paragraph">
<p>The special “role” name <strong>PUBLIC</strong> can be used to grant a privilege to every role on the system.</p>
</div>
<div class="paragraph">
<p>To revoke a previously-granted privilege, use the fittingly named <strong>REVOKE</strong> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">REVOKE</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="n">accounts</span> <span class="k">FROM</span> <span class="k">PUBLIC</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references">8. References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://hub.docker.com/_/postgres/" class="bare">https://hub.docker.com/_/postgres/</a></p>
</li>
</ul>
</div>
</div>
</div>
  </div>

  <ul class="post-navigation">
    <li>
      
      <a href="/2022/05/01/scala-in-action/">&laquo; Scala in Action</a>
      
    </li>
    <li>
      
      <a href="/2022/05/21/what-is-oauth2/">What is OAuth2 &raquo;</a>
      
    </li>
  </ul>
</article>

      </div>
    </div>

    <footer class="site-footer">
  <div class="license">
    <span>Article licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></span>
  </div>
  
  <details open>
    <summary>Extral Links</summary>
    <div>
      
      <a href="https://jekyllrb.com/">Jekyll</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://shopify.github.io/">Liquid</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://docs.asciidoctor.org/">Asciidoctor</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://github.com/qqbuby/">GitHub</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="/feed.xml">RSS</a>
      
      
    </div>
  </details>
  
</footer>


<!-- https://github.com/bryanbraun/anchorjs -->
<script src="/js/anchor.min.js"></script>
<script>
  anchors.add();
  anchors.remove(".site-title");
</script>




  </body>

</html>
