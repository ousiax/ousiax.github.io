<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bing WebMaster -->
  <meta name="msvalidate.01" content="AB2FFF876C37F59D9121882CC8395DE5" />

  <title>TCP/IP: Link Layer</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://blog.codefarm.me/2022/11/17/tcp-ip-link-layer/">
  <link rel="alternate" type="application/rss+xml" title="CODE FARM" href="https://blog.codefarm.me/feed.xml">

  <!-- https://cdn.jsdelivr.net/gh/lurongkai/anti-baidu/js/anti-baidu-latest.min.js -->
<script type="text/javascript" src="/js/anti-baidu.min.js" charset="UTF-8"></script>

  
<!-- Google Analytics Website tracking -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83971182-1', 'auto');
  ga('send', 'pageview');

</script>


  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SN88FJ18E5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SN88FJ18E5');
</script>



</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <h2 class="site-title">
      <a class="site-title" href="/">CODE FARM</a>
    </h2>

     <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
        <div class="trigger">
            <ul>
                <li><a href="/">home</a>
                <li><a href="/category">category</a>
                <li><a href="/tag">tag</a>
                <li><a href="/archive">archive</a>
                <li><a href="/about">about</a>
                <li><a href="https://resume.github.io/?qqbuby" target="_blank">R&eacute;sum&eacute;</a>
            </ul>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">TCP/IP: Link Layer</h1>
    
    
    <p class="post-meta"><time datetime="2022-11-17T08:48:20+08:00" itemprop="datePublished">Nov 17, 2022</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>TCP/IP supports many different link layers, depending on the type of networking hardware being used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>wired LANs such as Ethernet,</p>
</li>
<li>
<p>metropolitan area networks (MANs) such as cable TV and DSL connections available through service providers,</p>
</li>
<li>
<p>and wired voice networks such as telephone lines with modems,</p>
</li>
<li>
<p>as well as the more recent wireless networks such as Wi-Fi (wireless LAN)</p>
</li>
<li>
<p>and various wireless data services based on cellular technlology such as HSPA, EV-DO, LTE, and WiMAX.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Most link-layer technologies have an associated protocol format that describes how the corresponding PDUs must be constructed in order to be carried by the network hardware.</p>
</div>
<div class="paragraph">
<p>When referring to link-layer PDUs, we usually use the term <strong>frame</strong>, so as to distinguish the PDU format from those at higher layers such as <strong>packets</strong> or <strong>segments</strong>, terms used to describe network- and transport-layer PDUs, respectively.</p>
</div>
<div class="paragraph">
<p>Frame formats usually support a variable-length frame size ranging from a few bytes to a few kilobytes. The upper bound of the range is called the <strong>maximum transmission unit</strong> (<strong>MTU</strong>).</p>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#ethernet-and-the-ieee-802-lanman-standards">1. Ethernet and the IEEE 802 LAN/MAN Standards</a>
<ul class="sectlevel2">
<li><a href="#the-ieee-802-lanman-standards">1.1. The IEEE 802 LAN/MAN Standards</a></li>
<li><a href="#the-ethernet-frame-format">1.2. The Ethernet Frame Format</a></li>
<li><a href="#802-1pq-virtual-lans-and-qos-tagging">1.3. 802.1p/q: Virtual LANs and QoS Tagging</a></li>
<li><a href="#802-1ax-link-aggregation-formerly-802-3ad">1.4. 802.1AX: Link Aggregation (Formerly 802.3ad)</a></li>
<li><a href="#full-duplex-power-save-autonegotiation-and-802-1x-flow-control">1.5. Full Duplex, Power Save, Autonegotiation, and 802.1X Flow Control</a></li>
<li><a href="#link-layer-flow-control">1.6. Link-Layer Flow Control</a></li>
</ul>
</li>
<li><a href="#bridges-and-switches">2. Bridges and Switches</a></li>
<li><a href="#wireless-lansieee-802-11wi-fi">3. Wireless LANs—IEEE 802.11(Wi-Fi)</a>
<ul class="sectlevel2">
<li><a href="#802-11-frames">3.1. 802.11 Frames</a></li>
<li><a href="#wi-fi-security">3.2. Wi-Fi Security</a></li>
<li><a href="#wi-fi-mesh-802-11s">3.3. Wi-Fi Mesh (802.11s)</a></li>
</ul>
</li>
<li><a href="#point-to-point-protocol-ppp">4. Point-to-Point Protocol (PPP)</a>
<ul class="sectlevel2">
<li><a href="#link-control-protocol-lcp">4.1. Link Control Protocol (LCP)</a></li>
</ul>
</li>
<li><a href="#loopback">5. Loopback</a></li>
<li><a href="#mtu-and-path-mtu">6. MTU and Path MTU</a></li>
<li><a href="#tunneling-basics">7. Tunneling Basics</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="ethernet-and-the-ieee-802-lanman-standards">1. Ethernet and the IEEE 802 LAN/MAN Standards</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The term <strong>Ethernet</strong> generally refers to a set of standards first published in 1980 and revised in 1982 by Digital Equipment Corp., Intel Corp., and Xerox Corp. The first common form of Ethernet is now sometimes called "10Mb/s Ethernet" or "shared Ethernet," and it was adopted (with minor changes) by the IEEE as standard number 802.3.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip-link-layer/shared-ethernet-network.png" alt="A basic shared Ethernet network" width="45%" height="45%">
</div>
<div class="title">Figure 1. A basic shared Ethernet network consists of one or more stations (e.g., workstations, supercomputers) attached to a shared cable segment. Link-layer PDUs (frames) can be sent from one station to one or more others when the medium is determined to be free. If multiple stations send at the same time, possibly because of signal propagation delays, a collision occurs. Collisions can be detected, and they cause sending stations to wait a random amount of time before retrying. This common scheme is called carrier sense, multiple access with collision detection.</div>
</div>
<div class="paragraph">
<p>Because multiple stations share the same network, this standard includes a distributed algorithm implemented in each Ethernet network interface that controls when a station gets to send data it has. The particular method, known as <strong>carrier sense, multiple access with collision detection</strong> (<strong>CSMA/CD</strong>), mediates which computers can access the shared medium (cable) without any other special agreement or synchronization. This relative simplicity helped to promote the low cost and resulting popularity of Ethernet technology.</p>
</div>
<div class="paragraph">
<p>With CSMA/CD, a station (e.g., computer) first looks for a signal currently being sent on the network and sends its own frame when the network is free. This is the "carrier sense" portion of the protocol. If some other station happens to send at the same time, the resulting overlapping electrical signal is detected as a collision. In this case, each station waits a random amount of time before trying again. The amount of time is selected by drawing from a uniform probability distribution that doubles in length each time a subsequent collision is detected.</p>
</div>
<div class="paragraph">
<p>Eventually, each station gets its chance to send or times out trying after some number of attempts (16 in the case of conventional Ethernet). With CSMA/CD,
only one frame is traveling on the network at any given time. Access methods such as CSMA/CD are more formally called <strong>Media Access Control</strong> (<strong>MAC</strong>) protocols. There are many types of MAC protocols; some are based on having each station try to use the network independently (contention-based protocols like CSMA/ CD), and others are based on prearranged coordination (e.g., by allocating time slots for each station to send).</p>
</div>
<div class="paragraph">
<p>By the early 1990s, the shared cable had largely been replaced by twisted-pair wiring (resembling telephone wires and often called "10BASE-T"). With the development of 100Mb/s (also called "fast Ethernet," the most popular version of which is known as "100BASE-TX"), contention-based MAC protocols have become less popular. Instead, the wiring between each LAN station is often not shared but instead provides a dedicated electrical path in a star topology. This can be accomplished with Ethernet <strong>switches</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip-link-layer/switched-ethernet-network.png" alt="A switched Ethernet network" width="35%" height="35%">
</div>
<div class="title">Figure 2. A switched Ethernet network consists of one or more stations, each of which is attached to a switch port using a dedicated wiring path. In most cases where switched Ethernet is used, the network operates in a full-duplex fashion and the CSMA/CD algorithm is not required. Switches may be cascaded to form larger Ethernet LANs by interconnecting switch ports, sometimes called "uplink" ports.</div>
</div>
<div class="paragraph">
<p>At present, switches are commonly used, providing each Ethernet station with the ability to send and receive data simultaneously (called "full-duplex Ethernet").</p>
</div>
<div class="paragraph">
<p>One of the most popular technologies used to access the Internet today is wireless networking, the most common for wireless local area networks (WLANs) being an IEEE standard known as Wireless Fidelity or <strong>Wi-Fi</strong>, and sometimes called "wireless Ethernet" or 802.11. Although this standard is distinct from the 802 wired Ethernet standards, the frame format and general interface are largely borrowed from 802.3, and all are part of the set of IEEE 802 LAN standards. Thus, most of the capabilities used by TCP/IP for Ethernet networks are also used for Wi-Fi networks.</p>
</div>
<div class="sect2">
<h3 id="the-ieee-802-lanman-standards">1.1. The IEEE 802 LAN/MAN Standards</h3>
<div class="paragraph">
<p>In the world of IEEE standards, standards with the prefix 802 define the operations of LANs and MANs. The most popular 802 standards today include 802.3 (essentially Ethernet) and 802.11 (WLAN/Wi-Fi).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. LAN and MAN IEEE 802 standards relevant to the TCP/IP protocols (2011)</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 70%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Official Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1ak</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiple Registration Protocol (MRP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.1AK-2007]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1AE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAC Security (MACSec)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.1AE-2006]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1AX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link Aggregation (formerly 802.3ad)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.1AX-2008]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAC Bridges</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.1D-2004]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1p</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Traffic classes/priority/QoS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.1D-2004]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual Bridged LANs/Corrections to MRP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.1Q-2005/Cor1-2008]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiple Spanning Tree Protocol (MSTP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.1Q-2005]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rapid Spanning Tree Protocol (RSTP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.1D-2004]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.1X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port-Based Network Access Control (PNAC)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.1X-2010]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Logical Link Control (LLC)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.2-1998]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Baseline Ethernet and 10Mb/s Ethernet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.3-2008]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3u</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100Mb/s Ethernet ("Fast Ethernet")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.3-2008]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full-duplex operation and flow control</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.3-2008]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3z/802.3ab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000Mb/s Ethernet ("Gigabit Ethernet")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.3-2008]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3ae</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10Gb/s Ethernet ("Ten-Gigabit Ethernet")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.3-2008]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3ad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link Aggregation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.1AX-2008]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3af</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Power over Ethernet (PoE) (to 15.4W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.3-2008]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3ah</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access Ethernet ("Ethernet in the First Mile (EFM)")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.3-2008]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3as</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Frame format extensions (to 2000 bytes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.3-2008]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3at</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Power over Ethernet enhancements ("PoE+", to 30W)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.3at-2009]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.3ba</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40/100Gb/s Ethernet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.3ba-2010]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.11a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">54Mb/s Wireless LAN at 5GHz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.11-2007]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.11b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11Mb/s Wireless LAN at 2.4GHz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.11-2007]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.11e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">QoS enhancement for 802.11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.11-2007]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.11g</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">54Mb/s Wireless LAN at 2.4GHz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.11-2007]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.11h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spectrum/power management extensions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.11-2007]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.11i</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security enhancements/replaces WEP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.11-2007]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.11j</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.9–5.0GHz operation in Japan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.11-2007]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.11n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.5–600Mb/s Wireless LAN at 2.4 and 5GHz using optional MIMO and 40MHz channels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.11n-2009]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.11s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(draft) Mesh networking, congestion control</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Under development</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.11y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">54Mb/s wireless LAN at 3.7GHz (licensed)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.11y-2008]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Broadband Wireless Access Systems (WiMAX)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.16-2009]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.16d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixed Wireless MAN Standard (WiMAX)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.16-2009]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.16e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixed/Mobile Wireless MAN Standard (WiMAX)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.16-2009]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.16h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Improved Coexistence Mechanisms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.16h-2010]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.16j</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multihop Relays in 802.16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.16j-2009]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.16k</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bridging of 802.16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.16k-2007]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Media Independent Handovers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[802.21-2008]</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="the-ethernet-frame-format">1.2. The Ethernet Frame Format</h3>
<div class="paragraph">
<p>The Ethernet frame begins with a <strong><em>Preamble</em></strong> area used by the receiving interface&#8217;s circuitry to determine when a frame is arriving and to determine the amount of time between encoded bits (called <strong>clock recovery</strong>).</p>
</div>
<div class="paragraph">
<p>The preamble is a recognizable pattern (<em>0xAA</em> typically), which the receiver can use to <em>recover the clock</em> by the time the <strong>start frame delimiter</strong> (<em>SFD</em>) is found. The SFD has the fixed value <em>0xAB</em>.</p>
</div>
<div class="paragraph">
<p>All Ethernet (802.3) frames are based on a common format.</p>
</div>
<div class="paragraph">
<p>This basic frame format includes 48-bit (6-byte) <strong><em>Destination (DST)</em></strong> and <strong><em>Source (SRC)</em></strong> Address fields, known by other names such as <em>MAC address</em>, <em>link-layer address</em>, <em>802 address</em>, <em>hardware address</em>, or <em>physical address</em>. The destination address is also allowed to address more than one station, called <strong><em>broadcast</em></strong> or <strong><em>multicast</em></strong>.</p>
</div>
<div class="paragraph">
<p>Following the source address is a <strong><em>Type</em></strong> field that doubles as a <strong><em>Length</em></strong> field. Ordinarily, it identifies the type of data that follows the header. Popular values used with TCP/IP networks include IPv4 (<em>0x0800</em>), IPv6 (<em>0x86DD</em>), and ARP (<em>0x0806</em>).</p>
</div>
<div class="paragraph">
<p>The value 0x8100 indicates a <strong><em>Q-tagged</em></strong> frame (i.e., one that can carry a <em>virtual LAN</em> or <em>VLAN ID</em> according to the 802.1q standard).</p>
</div>
<div class="paragraph">
<p>The size of a basic Ethernet frame is 1518 bytes, but the more recent standard extended this size to 2000 bytes.</p>
</div>
<div class="paragraph">
<p>Following the Destination and Source Address fields, [802.3-2008] provides for a variable number of <strong><em>tags</em></strong> that contain various protocol fields defined by other IEEE standards. The most common of these are the tags used by 802.1p and 802.1q, which provide for virtual LANs and some <strong><em>quality-of-service (QoS)</em></strong> indicators.</p>
</div>
<div class="paragraph">
<p>Following the fields discussed so far is the <strong><em>data area</em></strong> or <strong><em>payload</em></strong> portion of the frame. This is the area where higher-layer PDUs such as IP datagrams are placed.</p>
</div>
<div class="paragraph">
<p>The payload sometimes is <strong><em>padded</em></strong> (appended) with 0 bytes to ensure that the overall frame meets the minimum length requirements.</p>
</div>
<div class="paragraph">
<p>The final <strong><em>Cyclic Redundancy Check (CRC)</em></strong> or <strong><em>Frame Check Sequence (FCS)</em></strong> field of the Ethernet frame format follows the payload area and provides an integrity check on the frame.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip-link-layer/ethernet-IEEE-802-3-frame-format.png" alt="Ethernet (IEEE 802.3) frame format" width="75%" height="75%">
</div>
<div class="title">Figure 3. The Ethernet (IEEE 802.3) frame format contains source and destination addresses, an overloaded <em>Length/Type</em> field, a field for data, and a frame check sequence (a CRC32). Additions to the basic frame format provide for a tag containing a VLAN ID and priority information (802.1p/q) and more recently for an extensible number of tags. The preamble and SFD are used for synchronizing receivers. When half-duplex operation is used with Ethernet running at 100Mb/s or more, additional bits may be appended to short frames as a carrier extension to ensure that the collision detection circuitry operates properly.</div>
</div>
<div class="sect3">
<h4 id="frame-sizes">1.2.1. Frame Sizes</h4>
<div class="paragraph">
<p>There is both a minimum and a maximum size of Ethernet frames.</p>
</div>
<div class="paragraph">
<p>The minimum is 64 bytes, requiring a minimum data area (payload) length of 48 bytes (no tags).</p>
</div>
<div class="paragraph">
<p>In cases where the payload is smaller, pad bytes (value 0) are appended to the end of the payload portion to ensure that the minimum length is enforced.</p>
</div>
<div class="paragraph">
<p>The maximum frame size of conventional Ethernet is 1518 bytes (including the 4-byte CRC and 14-byte header).</p>
</div>
<div class="paragraph">
<p>This value represents a sort of trade-off: if a frame contains an error (detected on receipt by an incorrect CRC), only 1.5KB need to be retransmitted to repair the problem. On the other hand, the size limits the MTU to not more than 1500 bytes.</p>
</div>
<div class="paragraph">
<p>In order to send a larger message, multiple frames are required (e.g., 64KB, a common larger size used with TCP/IP networks, would require at least 44 frames).</p>
</div>
<div class="paragraph">
<p>One way to improve efficiency when moving large amounts of data across an Ethernet would be to make the frame size larger accomplished using Ethernet <strong><em>jumbo frames</em></strong> [JF], a nonstandard extension to Ethernet that typically allows the frame size to be as large as 9000 bytes. Others make use of so-called <strong><em>super jumbo frames</em></strong>, which are usually understood to carry more than 9000 bytes.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="802-1pq-virtual-lans-and-qos-tagging">1.3. 802.1p/q: Virtual LANs and QoS Tagging</h3>
<div class="paragraph">
<p>With the growing use of switched Ethernet, it has become possible to interconnect every computer at a site on the same Ethernet LAN.</p>
</div>
<div class="paragraph">
<p>The advantage of doing this is that any host can directly communicate with any other host, using IP and other network-layer protocols, and requiring little or no administrator configuration.</p>
</div>
<div class="paragraph">
<p>In addition, broadcast and multicast traffic is distributed to all hosts that may wish to receive it without having to set up special multicast routing protocols.</p>
</div>
<div class="paragraph">
<p>While these represent some of the advantages of placing many stations on the same Ethernet, having broadcast traffic go to every computer can create an undesirable amount of network traffic when many hosts use broadcast, and there may be some security reasons to disallow complete any-to-any station communication.</p>
</div>
<div class="paragraph">
<p>To address some of these problems with running large, multiuse switched networks, IEEE extended the 802 LAN standards with a capability called <strong><em>virtual LANs (VLANs)</em></strong> in a standard known as 802.1q [802.1Q-2005]. Compliant Ethernet switches isolate traffic among hosts to common VLANs.</p>
</div>
<div class="paragraph">
<p>Note that because of this isolation, two hosts attached to the same switch but operating on different VLANs require a <em>router</em> between them for traffic to flow.</p>
</div>
<div class="paragraph">
<p>Combination <strong><em>switch/router</em></strong> devices have been created to address this need, and ultimately the performance of routers has been improved to match the performance of VLAN switching.</p>
</div>
<div class="paragraph">
<p>Thus, the appeal of VLANs has diminished somewhat, in favor of modern high-performance routers. Nonetheless, they are still used, remain popular in some environments, and are important to understand.</p>
</div>
<div class="paragraph">
<p>Several methods are used to specify the station-to-VLAN mapping.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Assigning VLANs by port is a simple and common method, whereby the switch port to which the station is attached is assigned a particular VLAN, so any station so attached becomes a member of the associated VLAN.</p>
</li>
<li>
<p>Other options include MAC address- based VLANs that use tables within Ethernet switches to map a station&#8217;s MAC address to a corresponding VLAN. This can become difficult to manage if stations change their MAC addresses (which they do sometimes, thanks to the behavior of some users).</p>
</li>
<li>
<p>IP addresses can also be used as a basis for assigning VLANs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When stations in different VLANs are attached to the same switch, the switch ensures that traffic does not leak from one VLAN to another, irrespective of the types of Ethernet interfaces being used by the stations.</p>
</div>
<div class="paragraph">
<p>When multiple VLANs must span multiple switches (<strong><em>trunking</em></strong>), it becomes necessary to label Ethernet frames with the VLAN to which they belong before they are sent to another switch.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for this capability uses a tag called the <strong><em>VLAN tag</em></strong> (or header), which holds 12 bits of VLAN identifier (providing for 4096 VLANs, although VLAN 0 and VLAN 4095 are reserved).</p>
</li>
<li>
<p>It also contains 3 bits of priority for supporting <strong><em>QoS</em></strong>, defined in the 802.1p standard.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In many cases, the administrator must configure the ports of the switch to be used to send 802.1p/q frames by enabling trunking on the appropriate ports. To make this job somewhat easier, some switches support a native VLAN option on trunked ports, meaning that untagged frames are by default associated with the native VLAN. Trunking ports are used to interconnect VLAN-capable switches, and other ports are typically used to attach stations. Some switches also support proprietary methods for VLAN trunking (e.g., the Cisco Inter-Switch Link (ISL) protocol).</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://www.cyberciti.biz/tips/howto-configure-linux-virtual-local-area-network-vlan.html" class="bare">https://www.cyberciti.biz/tips/howto-configure-linux-virtual-local-area-network-vlan.html</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>ip <span class="nb">link </span>show ens32
<span class="gp">2: ens32: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span><span class="w"> </span>mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000
<span class="go">    link/ether 00:0c:29:8c:df:3f brd ff:ff:ff:ff:ff:ff
    altname enp2s0

</span><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>ip <span class="nb">link </span>add <span class="nb">link </span>ens32 name ens32.5 <span class="nb">type </span>vlan <span class="nb">id </span>5
<span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>ip <span class="nt">-d</span> <span class="nb">link </span>show ens32.5
<span class="gp">4: ens32.5@ens32: &lt;BROADCAST,MULTICAST&gt;</span><span class="w"> </span>mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000
<span class="go">    link/ether 00:0c:29:8c:df:3f brd ff:ff:ff:ff:ff:ff promiscuity 0 minmtu 0 maxmtu 65535
</span><span class="gp">    vlan protocol 802.1Q id 5 &lt;REORDER_HDR&gt;</span><span class="w"> </span>addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535
<span class="go">
</span><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>ip addr add 192.168.91.200/24 brd 192.168.91.255 dev ens32.5
<span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>ip <span class="nb">link set </span>dev ens32.5 up
<span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>ip a s ens32.5
<span class="gp">4: ens32.5@ens32: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span><span class="w"> </span>mtu 1500 qdisc noqueue state UP group default qlen 1000
<span class="go">    link/ether 00:0c:29:8c:df:3f brd ff:ff:ff:ff:ff:ff
    inet 192.168.91.200/24 brd 192.168.91.255 scope global ens32.5
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fe8c:df3f/64 scope link
       valid_lft forever preferred_lft forever

</span><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>ip <span class="nb">link </span>delete ens32.5
<span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>ip l
<span class="gp">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt;</span><span class="w"> </span>mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
<span class="go">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span><span class="gp">2: ens32: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span><span class="w"> </span>mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000
<span class="go">    link/ether 00:0c:29:8c:df:3f brd ff:ff:ff:ff:ff:ff
    altname enp2s0</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="802-1ax-link-aggregation-formerly-802-3ad">1.4. 802.1AX: Link Aggregation (Formerly 802.3ad)</h3>
<div class="paragraph">
<p>Some systems equipped with multiple network interfaces are capable of <strong><em>bonding</em></strong> or <strong><em>link aggregation</em></strong>.</p>
</div>
<div class="paragraph">
<p>With link aggregation, two or more interfaces are treated as one in order to achieve greater reliability through redundancy or greater performance by splitting (striping) data across multiple interfaces.</p>
</div>
<div class="paragraph">
<p>The IEEE Amendment 802.1AX [802.1AX-2008] defines the most common method for performing link aggregation and the <strong><em>Link Aggregation Control Protocol (LACP)</em></strong> to manage such links. LACP uses IEEE 802 frames of a particular format (called LACPDUs).</p>
</div>
<div class="paragraph">
<p>Using link aggregation on Ethernet switches that support it can be a costeffective alternative to investing in switches with high-speed network ports. If more than one port can be aggregated to provide adequate bandwidth, higherspeed ports may not be required.</p>
</div>
<div class="paragraph">
<p>Link aggregation may be supported not only on network switches but across multiple <strong><em>network interface cards</em></strong> (NICs) on a host computer.</p>
</div>
<div class="paragraph">
<p>Often, aggregated ports must be of the same type, operating in the same mode (i.e., half- or full-duplex).</p>
</div>
<div class="paragraph">
<p>Linux has the capability to implement link aggregation (bonding) across different types of devices using the following commands:</p>
</div>
</div>
<div class="sect2">
<h3 id="full-duplex-power-save-autonegotiation-and-802-1x-flow-control">1.5. Full Duplex, Power Save, Autonegotiation, and 802.1X Flow Control</h3>
<div class="paragraph">
<p>When Ethernet was first developed, it operated only in half-duplex mode using a <strong><em>shared cable</em></strong>. That is, data could be sent only one way at one time, so only one station was sending a frame at any given point in time. With the development of <strong><em>switched Ethernet</em></strong>, the network was no longer a single piece of shared wire, but instead many sets of links. As a result, multiple pairs of stations could exchange data simultaneously.</p>
</div>
<div class="paragraph">
<p>In Linux, the <em>ethtool</em> program can be used to query whether full duplex is supported and whether it is being used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="nv">$ </span><span class="nb">sudo </span>ethtool ens32
Settings <span class="k">for </span>ens32:
	Supported ports: <span class="o">[</span> TP <span class="o">]</span>
	Supported <span class="nb">link </span>modes:   10baseT/Half 10baseT/Full
	                        100baseT/Half 100baseT/Full
	                        1000baseT/Full
	Supported pause frame use: No
	Supports auto-negotiation: Yes
	Supported FEC modes: Not reported
	Advertised <span class="nb">link </span>modes:  10baseT/Half 10baseT/Full
	                        100baseT/Half 100baseT/Full
	                        1000baseT/Full
	Advertised pause frame use: No
	Advertised auto-negotiation: Yes
	Advertised FEC modes: Not reported
	Speed: 1000Mb/s
<span class="hll">	Duplex: Full
</span>	Auto-negotiation: on
	Port: Twisted Pair
	PHYAD: 0
	Transceiver: internal
	MDI-X: off <span class="o">(</span>auto<span class="o">)</span>
	Supports Wake-on: d
	Wake-on: d
        Current message level: 0x00000007 <span class="o">(</span>7<span class="o">)</span>
                               drv probe <span class="nb">link</span>
<span class="nb">	</span>Link detected: <span class="nb">yes</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="link-layer-flow-control">1.6. Link-Layer Flow Control</h3>
<div class="paragraph">
<p>Operating an extended Ethernet LAN in full-duplex mode and across segments of different speeds may require the switches to buffer (store) frames for some period of time.</p>
</div>
<div class="paragraph">
<p>For example, when multiple stations send to the same destination (called output port contention).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the aggregate traffic rate headed for a station exceeds the station&#8217;s link rate, frames start to be stored in the intermediate switches.</p>
</li>
<li>
<p>If this situation persists for a long time, frames may be dropped.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One way to mitigate this situation is to apply <strong><em>flow control</em></strong> to senders (i.e., slow them down).</p>
</div>
<div class="paragraph">
<p>Some Ethernet switches (and interfaces) implement flow control by sending special signal frames between switches and NICs.</p>
</div>
<div class="paragraph">
<p>Flow control signals to the sender that it must slow down its transmission rate, although the specification leaves the details of this to the implementation. Ethernet uses an implementation of flow control called <em>PAUSE messages</em> (also called <em>PAUSE frames</em>), specified by 802.3x [802.3-2008].</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bridges-and-switches">2. Bridges and Switches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The IEEE 802.1d standard specifies the operation of bridges, and thus switches, which are essentially high-performance bridges.</p>
</div>
<div class="paragraph">
<p>A bridge or switch is used to join multiple physical link-layer networks (e.g., a pair of physical Ethernet segments) or groups of stations.</p>
</div>
<div class="paragraph">
<p>The most basic setup involves connecting two switches to form an extended LAN.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip-link-layer/switch-extend-lan.png" alt="A simple extended Ethernet LAN with two switches" width="55%" height="55%">
</div>
<div class="title">Figure 4. A simple extended Ethernet LAN with two switches. Each switch port has a number for reference, and each station (including each switch) has its own MAC address.</div>
</div>
<div class="paragraph">
<p>Switches A and B in the figure have been interconnected to form an extended LAN.</p>
</div>
<div class="paragraph">
<p>Note that every network element, including each switch, has its own MAC address.</p>
</div>
<div class="paragraph">
<p>Nonlocal MAC addresses are <strong><em>learned</em></strong> by each bridge over time so that eventually every switch knows the port upon which every station can be reached, which are stored in tables (called <strong><em>filtering databases</em></strong>) within each switch on a per-port (and possibly per-VLAN) basis.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Filtering databases on switches A and B are created over time (<em>learned</em>) by observing the source address on frames seen on switch ports.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="2">Switch A&#8217;s Database</th>
<th class="tableblock halign-left valign-top" colspan="2">Switch B&#8217;s Database</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Station</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Station</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">00:17:f2:a2:10:3d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00:17:f2:a2:10:3d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">00:c0:19:33:0a:2e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00:c0:19:33:0a:2e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">00:0d:66:4f:02:03</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00:0d:66:4f:02:03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">00:0d:66:4f:02:04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00:0d:66:4f:02:04</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">00:30:48:2b:19:82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00:30:48:2b:19:82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">00:30:48:2b:19:86</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">00:30:48:2b:19:86</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When a switch (bridge) is first turned on, its database is empty, so it does not know the location of any stations except itself.</p>
</div>
<div class="paragraph">
<p>Whenever it receives a frame destined for a station other than itself, it makes a copy for each of the ports other than the one on which the frame arrived and sends a copy of the frame out of each one.</p>
</div>
<div class="paragraph">
<p>If switches (bridges) never learned the location of stations, every frame would be delivered across every network segment, leading to unwanted overhead.</p>
</div>
<div class="paragraph">
<p>The learning capability reduces overhead significantly and is a standard feature of switches and bridges.</p>
</div>
<div class="paragraph">
<p>Today, most operating systems support the capability to bridge between network interfaces, meaning that a standard computer with multiple interfaces can be used as a bridge.</p>
</div>
<div class="paragraph">
<p>In Windows, for example, interfaces may be bridged together by navigating to the Network Connections menu from the Control Panel, highlighting the interfaces to bridge, right-clicking the mouse, and selecting Bridge Connections.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip-link-layer/pc-based-bridge.png" alt="Linux-based PC Bridge" width="75%" height="75%">
</div>
<div class="title">Figure 5. In this simple topology, a Linux-based PC is configured to operate as a bridge between the two Ethernet segments it interconnects. As a learning bridge, it accumulates tables of which port should be used to reach the various other systems on the extended LAN.</div>
</div>
<div class="paragraph">
<p>The simple network uses a Linux-based PC with two Ethernet ports as a bridge. Attached to port 2 is a single station, and the rest of the network is attached to port 1. The following commands enable the bridge:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@node-1:~#</span><span class="w"> </span>ip <span class="nb">link</span>
<span class="gp">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt;</span><span class="w"> </span>mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
<span class="go">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span><span class="gp">2: ens32: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span><span class="w"> </span>mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000
<span class="go">    link/ether 00:0c:29:85:26:07 brd ff:ff:ff:ff:ff:ff
</span><span class="gp">3: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span><span class="w"> </span>mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000
<span class="go">    link/ether 00:0c:29:85:26:1b brd ff:ff:ff:ff:ff:ff
</span><span class="gp">4: ens34: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span><span class="w"> </span>mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000
<span class="go">    link/ether 00:0c:29:85:26:11 brd ff:ff:ff:ff:ff:ff
</span><span class="gp">5: ens35: &lt;BROADCAST,MULTICAST&gt;</span><span class="w"> </span>mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000
<span class="go">    link/ether 00:0c:29:85:26:25 brd ff:ff:ff:ff:ff:ff
</span><span class="gp">6: ens36: &lt;BROADCAST,MULTICAST&gt;</span><span class="w"> </span>mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000
<span class="go">    link/ether 00:0c:29:85:26:2f brd ff:ff:ff:ff:ff:ff

</span><span class="gp">root@node-1:~#</span><span class="w"> </span>brctl addbr br0
<span class="gp">root@node-1:~#</span><span class="w"> </span>brctl addif br0 ens33
<span class="gp">root@node-1:~#</span><span class="w"> </span>brctl addif br0 ens34
<span class="gp">root@node-1:~#</span><span class="w"> </span>brctl addif br0 ens35
<span class="go">
</span><span class="gp">root@node-1:~#</span><span class="w"> </span>brctl show
<span class="go">bridge name	bridge id		STP enabled	interfaces
br0		8000.000c29852611	no		ens33
							ens34
							ens35
</span><span class="gp">root@node-1:~#</span><span class="w"> </span>ip <span class="nb">link set </span>br0 up
<span class="gp">root@node-1:~#</span><span class="w"> </span>brctl showmacs br0
<span class="go">port no	mac addr		is local?	ageing timer
  1	00:0c:29:85:26:07	no		   0.06
  2	00:0c:29:85:26:11	yes		   0.00
  2	00:0c:29:85:26:11	yes		   0.00
  1	00:0c:29:85:26:1b	yes		   0.00
  1	00:0c:29:85:26:1b	yes		   0.00
  3	00:0c:29:85:26:25	yes		   0.00
  3	00:0c:29:85:26:25	yes		   0.00
  1	00:0c:29:8c:df:49	no		   0.01
  2	00:50:56:c0:00:08	no		   0.03</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="wireless-lansieee-802-11wi-fi">3. Wireless LANs—IEEE 802.11(Wi-Fi)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the most popular technologies being used to access the Internet today is <strong><em>wireless fidelity</em></strong> (<strong>Wi-Fi</strong>), also known by its IEEE standard name 802.11, effectively a wireless version of Ethernet.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip-link-layer/ieee-802-11-wlan.png" alt="Architecture of an IEEE 802.11 network" width="45%" height="45%">
</div>
<div class="title">Figure 6. The IEEE 802.11 terminology for a wireless LAN. Access points (APs) can be connected using a distribution service (DS, a wireless or wired backbone) to form an extended WLAN (called an ESS). Stations include both APs and mobile devices communicating together that form a basic service set (BSS). Typically, an ESS has an assigned ESSID that functions as a name for the network.</div>
</div>
<div class="paragraph">
<p>The network includes a number of <strong><em>stations (STAs)</em></strong>. Typically stations are organized with a subset operating also as <strong><em>access points (APs)</em></strong>.</p>
</div>
<div class="paragraph">
<p>An AP and its associated stations are called a <strong><em>basic service set (BSS)</em></strong>. The APs are generally connected to each other using a wired <strong><em>distribution service</em></strong> (called a <strong><em>DS</em></strong>, basically a "backbone"), forming an <strong><em>extended service set (ESS)</em></strong>. This setup is commonly termed <strong><em>infrastructure mode</em></strong>.</p>
</div>
<div class="paragraph">
<p>The 802.11 standard also provides for an <strong><em>ad hoc mode</em></strong>. In this configuration there is no AP or DS; instead, direct station-to-station (peer-to-peer) communication takes place. In IEEE terminology, the STAs participating in an ad hoc network form an <strong><em>independent basic service set (IBSS)</em></strong>.</p>
</div>
<div class="paragraph">
<p>A WLAN formed from a collection of BSSs and/or IBSSs is called a <strong><em>service set</em></strong>, identified by a <strong><em>service set identifier (SSID)</em></strong>.</p>
</div>
<div class="paragraph">
<p>An <strong><em>extended service set identifier (ESSID)</em></strong> is an SSID that names a collection of connected BSSs and is essentially a name for the LAN that can be up to 32 characters long.</p>
</div>
<div class="sect2">
<h3 id="802-11-frames">3.1. 802.11 Frames</h3>
<div class="paragraph">
<p>There is one common overall frame format for 802.11 networks but multiple types of frames. Not all the fields are present in every type of frame.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip-link-layer/802.11-data-frame-format.png" alt="802.11 basic data frame format" width="75%" height="75%">
</div>
<div class="title">Figure 7. The 802.11 basic data frame format (as of [802.11n-2009]). The MPDU format resembles that of Ethernet but has additional fields depending on the type of DS being used among access points, whether the frame is headed to the DS or from it, and if frames are being aggregated. The QoS Control field is used for special performance features, and the HT Control field is used for control of 802.11n’s “high-throughput” features.</div>
</div>
<div class="paragraph">
<p>The frame shown includes a <em>preamble</em> for synchronization, which depends on the particular variant of 802.11 being used.</p>
</div>
<div class="paragraph">
<p>Next, the <em>Physical Layer Convergence Procedure (PLCP)</em> header provides information about the specific physical layer in a somewhat PHY-independent way.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The PLCP portion of the frame is generally transmitted at a lower data rate than the rest of the frame.</p>
</li>
<li>
<p>This serves two purposes:</p>
<div class="ulist">
<ul>
<li>
<p>to improve the probability of correct delivery (lower speeds tend to have better error resistance)</p>
</li>
<li>
<p>and to provide compatibility with and protection from interference from legacy equipment that may operate in the same area at slower rates.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>MAC PDU (MPDU)</em> corresponds to a frame similar to Ethernet, but with some additional fields.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At the head of the MPDU is the <em>Frame Control Word</em>, which includes a 2-bit <em>Type</em> field identifying the frame type.</p>
</li>
<li>
<p>There are three types of frames: <em>management frames</em>, <em>control frames</em>, and <em>data frames</em>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="management-frames">3.1.1. Management Frames</h4>
<div class="paragraph">
<p>Management frames are used for creating, maintaining, and ending associations between stations and access points. They are also used to determine whether encryption is being used, what the name (SSID or ESSID) of the network is, what transmission rates are supported, and a common time base. These frames are used to provide the information necessary when a Wi-Fi interface "scans" for nearby access points.</p>
</div>
<div class="paragraph">
<p>Scanning is the procedure by which a station discovers available networks and related configuration information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">Linux#</span><span class="w"> </span>iwlist wlan0 scan
<span class="go">wlan0 Scan completed :
    Cell 01 - Address: 00:02:6F:20:B5:84
        ESSID:"Grizzly-5354-Aries-802.11b/g"
        Mode:Master
        Channel:4
            Frequency:2.427 GHz (Channel 4)
        Quality=5/100 Signal level=47/100
        Encryption key:on
        IE: WPA Version 1
            Group Cipher : TKIP
            Pairwise Ciphers (2) : CCMP TKIP
            Authentication Suites (1) : PSK
</span><span class="gp">        Bit Rates:1 Mb/s;</span><span class="w"> </span>2 Mb/s<span class="p">;</span> 5.5 Mb/s<span class="p">;</span> 11 Mb/s<span class="p">;</span>
<span class="gp">            6 Mb/s;</span><span class="w"> </span>12 Mb/s<span class="p">;</span> 24 Mb/s<span class="p">;</span> 36 Mb/s<span class="p">;</span> 9 Mb/s<span class="p">;</span>
<span class="gp">            18 Mb/s;</span><span class="w"> </span>48 Mb/s<span class="p">;</span> 54 Mb/s
<span class="go">        Extra:tsf=0000009d832ff037</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we see the result of a hand-initiated scan using wireless interface <em>wlan0</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An AP with MAC address <em>00:02:6F:20:B5:84</em> is acting as a master (i.e., is acting as an AP in infrastructure mode).</p>
</li>
<li>
<p>It is broadcasting the <em>ESSID</em> "Grizzly- 5354-Aries-802.11b/g" on channel 4 (2.427GHz).</p>
</li>
<li>
<p>The <em>quality</em> and <em>signal</em> level give indications of how well the scanning station is receiving a signal from the AP, although the meaning of these values varies among manufacturers.</p>
</li>
<li>
<p>WPA encryption is being used on this link,</p>
</li>
<li>
<p>and bit rates from 1Mb/s to 54Mb/s are available.</p>
</li>
<li>
<p>The <em>tsf</em> (time sync function) value indicates the AP&#8217;s notion of time, which is used for synchronizing various features such as power saving mode.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">PS C:\&gt;</span><span class="w"> </span>netsh wlan show networks <span class="nv">mode</span><span class="o">=</span>bssid
<span class="go">Interface name : Wi-Fi
There are 1 networks currently visible.
SSID 1 : BAOLAND
    Network type            : Infrastructure
    Authentication          : WPA2-Personal
    Encryption              : CCMP
    BSSID 1                 : 9c:a6:15:6e:93:dd
         Signal             : 60%
         Radio type         : 802.11n
         Channel            : 11
         Basic rates (Mbps) : 1 2 5.5 11
         Other rates (Mbps) : 6 9 12 18 24 36 48 54</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="control-frames-rtscts-and-acks">3.1.2. Control Frames: RTS/CTS and ACKs</h4>
<div class="paragraph">
<p>Control frames are used to handle a form of <em>flow control</em> as well as <em>acknowledgments</em> for frames.</p>
</div>
<div class="paragraph">
<p>Flow control helps ensure that a receiver can slow down a sender that is too fast.</p>
</div>
<div class="paragraph">
<p>Acknowledgments help a sender know what frames have been received correctly.</p>
</div>
<div class="paragraph">
<p>These concepts also apply to TCP at the transport layer.</p>
</div>
<div class="paragraph">
<p>802.11 networks support optional <em>request-to-send</em> (<strong>RTS</strong>)/<em>clear-to-send</em> (<strong>CTS</strong>) moderation of transmission for flow control.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When these are enabled, prior to sending a data frame a station transmits an RTS frame, and when the recipient is willing to receive additional traffic, it responds with a CTS.</p>
</li>
<li>
<p>After the RTS/CTS exchange, the station has a window of time (identified in the CTS frame) to transmit data frames that are acknowledged when successfully received.</p>
</li>
<li>
<p>Such transmission coordination schemes are common in wireless networks and mimic the flow control signaling that has been used on wired serial lines for years (sometimes called <em>hardware flow control</em>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In wired Ethernet networks, the absence of a collision indicates that a frame has been received correctly with high probability.</p>
</div>
<div class="paragraph">
<p>In wireless networks, there is a wider range of reasons a frame may not be delivered correctly, such as insufficient signal or interference.</p>
</div>
<div class="paragraph">
<p>To help address this potential problem, 802.11 extends the 802.3 retransmission scheme with a <em>retransmission/acknowledgment</em> (<strong>ACK</strong>) scheme.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An acknowledgment is expected to be received within a certain amount of time for each unicast frame sent (802.11a/b/g) or each group of frames sent (802.11n or 802.11e with "block ACKs").</p>
</li>
<li>
<p>Multicast and broadcast frames do not have associated ACKs to avoid "ACK implosion".</p>
</li>
<li>
<p>Failure to receive an ACK within the specified time results in retransmission of the frame(s).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="data-frames-fragmentation-and-aggregation">3.1.3. Data Frames, Fragmentation, and Aggregation</h4>
<div class="paragraph">
<p>Most frames seen on a busy network are data frames, which do what one would expect—carry data.</p>
</div>
<div class="paragraph">
<p>Typically, there is a one-to-one relationship between 802.11 frames and the link-layer (LLC) frames made available to higher-layer protocols such as IP.</p>
</div>
<div class="paragraph">
<p>However, 802.11 supports <em>frame fragmentation</em>, which can divideframes into multiple fragments. With the 802.11n specification, it also supports <em>frame aggregation</em>, which can be used to send multiple frames together with less overhead.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="wi-fi-security">3.2. Wi-Fi Security</h3>
<div class="paragraph">
<p>There has been considerable evolution in the security model for 802.11 networks.</p>
</div>
<div class="paragraph">
<p>In its early days, 802.11 used an encryption method known as <em>wired equivalent privacy</em> (<strong>WEP</strong>).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WEP was later shown to be so weak that some replacement was required.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Industry responded with <em>Wi-Fi protected access</em> (<strong>WPA</strong>), which replaced the way keys are used with encrypted blocks.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In WPA, a scheme called the <em>Temporal Key Integrity Protocol</em> (TKIP) ensures, among other things, that each frame is encrypted with a different encryption key.</p>
</li>
<li>
<p>It also includes a message integrity check, called <em>Michael</em>, that fixed one of the major weaknesses in WEP.</p>
</li>
<li>
<p>WPA was created as a placeholder that could be used on fielded WEP-capable equipment by way of a firmware upgrade while the IEEE 802.11i standards group worked on a stronger standard that was ultimately absorbed into Clause 8 of [802.11-2007] and dubbed "<strong>WPA2</strong>" by industry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both WEP and WPA use the <em>RC4</em> encryption algorithm. WPA2 uses the <em>Advanced Encryption Standard</em> (AES) algorithm.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Wi-Fi security has evolved from WEP, which was found to be insecure, to WPA, to the now-standard WPA2 collection of algorithms.</caption>
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 28.5714%;">
<col style="width: 28.5715%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name/Standard</th>
<th class="tableblock halign-left valign-top">Cipher</th>
<th class="tableblock halign-left valign-top">Key Stream Management</th>
<th class="tableblock halign-left valign-top">Authentication</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WEP (pre-RSNA)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RC4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(WEP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PSK, (802.1X/EAP)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WPA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RC4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TKIP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PSK, 802.1X/EAP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WPA2/802.11(i)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CCMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CCMP, (TKIP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PSK, 802.1X/EAP</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="wi-fi-mesh-802-11s">3.3. Wi-Fi Mesh (802.11s)</h3>
<div class="paragraph">
<p>The IEEE is working on the 802.11s standard, which covers Wi-Fi <em>mesh</em> operation. With mesh operation, wireless stations can act as data-forwarding agents (like APs).</p>
</div>
<div class="paragraph">
<p>The standard is not yet complete as of writing (mid-2011). The draft version of 802.11s defines the <em>Hybrid Wireless Routing Protocol</em> (<strong>HWRP</strong>), based in part on the IETF standards for <em>Ad-Hoc On-Demand Distance Vector</em> (<strong>AODV</strong>) routing [RFC3561] and the <em>Optimized Link State Routing</em> (<strong>OLSR</strong>) protocol [RFC3626].</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="point-to-point-protocol-ppp">4. Point-to-Point Protocol (PPP)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>PPP stands for the <strong><em>Point-to-Point Protocol</em></strong> [RFC1661][RFC1662][RFC2153]. It is a popular method for carrying IP datagrams over serial links—from low-speed dial-up modems to high-speed optical links [RFC2615]. It is widely deployed by some DSL service providers, which also use it for assigning Internet system parameters (e.g., initial IP address and domain name server).</p>
</div>
<div class="paragraph">
<p>PPP should be considered more of a collection of protocols than a single protocol.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It supports a basic method to establish a link, called the <strong><em>Link Control Protocol (LCP)</em></strong>,</p>
</li>
<li>
<p>as well as a family of NCPs, used to establish network-layer links for various kinds of protocols,</p>
<div class="paragraph">
<p>including IPv4 and IPv6 and possibly non-IP protocols, after LCP has established the basic link.</p>
</div>
</li>
<li>
<p>A number of related standards cover control of compression and encryption for PPP,</p>
<div class="paragraph">
<p>and a number of authentication methods can be employed when a link is brought up.</p>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="link-control-protocol-lcp">4.1. Link Control Protocol (LCP)</h3>
<div class="paragraph">
<p>The LCP portion of PPP is used to establish and maintain a low-level two-party communication path over a point-to-point link. PPP&#8217;s operation therefore need be concerned only with two ends of a single link; it does not need to handle the problem of mediating access to a shared resource like the MAC-layer protocols of Ethernet and Wi-Fi.</p>
</div>
<div class="paragraph">
<p>PPP generally, and LCP more specifically, imposes minimal requirements on the underlying point-to-point link. The link must support bidirectional operation (LCP uses acknowledgments) and operate either asynchronously or synchronously.</p>
</div>
<div class="paragraph">
<p>Typically, LCP establishes a link using a simple bit-level framing format based on the <em>High-Level Data Link Control</em> (<strong>HDLC</strong>) protocol.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HDLC was already a well-established framing format by the time PPP was designed [ISO3309] [ISO4335].</p>
</li>
<li>
<p>IBM modified it to form <em>Synchronous Data Link Control</em> (<strong>SDLC</strong>), a protocol used as the link layer in its proprietary <em>System Network Architecture</em> (<strong>SNA</strong>) protocol suite.</p>
</li>
<li>
<p>HDLC was also used as the basis for the <em>LLC</em> standard in 802.2 and ultimately for PPP as well.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip-link-layer/ppp-hdlc-frame-format.png" alt="PPP frame format" width="75%" height="75%">
</div>
<div class="title">Figure 8. The PPP basic frame format was borrowed from HDLC. It provides a protocol identifier, payload area, and 2- or 4-byte FCS. Other fields may or may not be present, depending on compression options.</div>
</div>
<div class="paragraph">
<p>The PPP frame format, in the common case when HDLC-like framing is used, is surrounded by two 1-byte <em>Flag</em> fields containing the fixed value <em>0x7E</em>. These fields are used by the two stations on the ends of the point-to-point link for finding the beginning and end of the frame.</p>
</div>
<div class="paragraph">
<p>A small problem arises if the value <em>0x7E</em> itself occurs inside the frame. This is handled in one of two ways, depending on whether PPP is operating over an asynchronous or a synchronous link.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For asynchronous links, PPP uses character stuffing (also called <em>byte stuffing</em>).</p>
<div class="paragraph">
<p>If the flag character appears elsewhere in the frame, it is replaced with the 2-byte sequence <em>0x7D5E</em> (<em>0x7D</em> is known as the "PPP escape character").</p>
</div>
<div class="paragraph">
<p>If the escape character itself appears in the frame, it is replaced with the 2-byte sequence <em>0x7D5D</em>.</p>
</div>
<div class="paragraph">
<p>Thus, the receiver replaces <em>0x7D5E</em> with <em>0x7E</em> and <em>0x7D5D</em> with <em>0x7D</em> upon receipt.</p>
</div>
</li>
<li>
<p>On synchronous links (e.g., T1 lines, T3 lines), PPP uses <em>bit stuffing</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After the first <em>Flag</em> field, PPP adopts the HDLC Address (<em>Addr</em>) and <em>Control</em> fields.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In HDLC, the <em>Address</em> field would specify which station is being addressed, but because PPP is concerned only with a single destination, this field is always defined to have the value <em>0xFF</em> (all stations).</p>
</li>
<li>
<p>The <em>Control</em> field in HDLC is used to indicate frame sequencing and retransmission behavior.</p>
<div class="paragraph">
<p>As these link-layer reliability functions are not ordinarily implemented by PPP, the <em>Control</em> field is set to the fixed value <em>0x03</em>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because both the <em>Address</em> and <em>Control</em> fields are fixed constants in PPP, they are often omitted during transmission with an option called <em>Address and Control Field Compression (<strong>ACFC</strong>)</em>, which essentially eliminates the two fields.</p>
</div>
<div class="paragraph">
<p>The <em>Protocol</em> field of the PPP frame indicates the type of data being carried.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Many different types of protocols can be carried in a PPP frame.</p>
</li>
<li>
<p>The official list and the assigned number used in the <em>Protocol</em> field are given by the "Point-to-Point Protocol Field Assignments" document.</p>
</li>
<li>
<p>In some circumstances the <em>Protocol</em> field can be compressed to a single byte, if the <em>Protocol Field Compression (<strong>PFC</strong>)</em> option is negotiated successfully during link establishment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The final portion of the PPP frame contains a 16-bit <em>FCS</em> (a CRC16, with generator polynomial 10001000000100001) covering the entire frame except the FCS field itself and Flag bytes.</p>
</div>
<div class="sect3">
<h4 id="lcp-operation">4.1.1. LCP Operation</h4>
<div class="paragraph">
<p>LCP has a simple encapsulation beyond the basic PPP packet.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip-link-layer/lcp-packet.png" alt="LCP packet" width="75%" height="75%">
</div>
<div class="title">Figure 9. The LCP packet is a fairly general format capable of identifying the type of encapsulated data and its length. LCP frames are used primarily in establishing a PPP link, but this basic format also forms the basis of many of the various network control protocols.</div>
</div>
<div class="paragraph">
<p>The PPP Protocol field value for LCP is always <em>0xC021</em>, which is not eliminated using PFC, so as to minimize ambiguity.</p>
</div>
<div class="paragraph">
<p>The <em>Ident</em> field is a sequence number provided by the sender of LCP request frames and is incremented for each subsequent message.</p>
</div>
<div class="paragraph">
<p>When forming a reply (<em>ACK</em>, <em>NACK</em>, or <em>REJECT</em> response), this field is constructed by copying the value included in the request to the response packet. In this fashion, the requesting side can identify replies to the appropriate request by matching identifiers.</p>
</div>
<div class="paragraph">
<p>The <em>Code</em> field gives the type of operation being either requested or responded to: <em>configure-request (0x01)</em>, <em>configure-ACK (0x02)</em>, <em>configure-NACK (0x03)</em>, <em>configure-REJECT (0x04)</em>, <em>terminate-request (0x05)</em>, <em>terminate-ACK (0x06)</em>, <em>code-REJECT (0x07)</em>, <em>protocol-REJECT (0x08)</em>, <em>echo-request (0x09)</em>, <em>echo-reply (0x0A)</em>, <em>discard-request (0x0B)</em>, <em>identification (0x0C)</em>, and <em>time-remaining (0x0D)</em>.</p>
</div>
<div class="paragraph">
<p>Generally, <em>ACK</em> messages indicate acceptance of a set of options, and <em>NACK</em> messages indicate a partial rejection with suggested alternatives. A <em>REJECT</em> message rejects one or more options entirely. A rejected code indicates that one of the field values contained in a previous packet is unknown.</p>
</div>
<div class="paragraph">
<p>The <em>Length</em> field gives the length of the LCP packet in bytes and is not permitted to exceed the link&#8217;s <em>maximum received unit (<strong>MRU</strong>)</em>, a form of maximum advised frame limit. Note that the Length field is part of the LCP protocol; the PPP protocol in general does not provide such a field.</p>
</div>
<div class="paragraph">
<p>The main job of LCP is to bring up a point-to-point link to a minimal level.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure messages cause each end of the link to start the basic configuration procedure and establish agreed-upon options.</p>
</li>
<li>
<p>Termination messages are used to clear a link when complete.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>LCP also provides some additional features mentioned previously.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Echo Request/Reply messages may be exchanged anytime a link is active by LCP in order to verify operation of the peer.</p>
</li>
<li>
<p>The Discard Request message can be used for performance measurement; it instructs the peer to discard the packet without responding.</p>
</li>
<li>
<p>The Identification and Time-Remaining messages are used for administrative purposes: to know the type of the peer system and to indicate the amount of time allowed for the link to remain established (e.g., for administrative or security reasons).</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip-link-layer/ppp-lcp-link-exchange.png" alt="LCP is used to establish a PPP link and agree upon options by each peer" width="55%" height="55%">
</div>
<div class="title">Figure 10. LCP is used to establish a PPP link and agree upon options by each peer. The typical exchange involves a pair of configure requests and ACKs that contain the option list, an authentication exchange, data exchange (not pictured), and a termination exchange. Because PPP is such a general-purpose protocol with many parts, many other types of operations may occur between the establishment of a link and its termination.</div>
</div>
</div>
<div class="sect3">
<h4 id="network-control-protocols-ncps">4.1.2. Network Control Protocols (NCPs)</h4>
<div class="ulist">
<ul>
<li>
<p>For IPv4, the NCP is called the <em>IP Control Protocol (<strong>IPCP</strong>)</em> [RFC1332].</p>
</li>
<li>
<p>For IPv6, the NCP is <strong><em>IPV6CP</em></strong> [RFC5072].</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once LCP has completed its link establishment and authentication, each end of the link is in the Network state and may proceed to negotiate a network-layer association using zero or more NCPs (one, such as IPCP, is typical).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IPCP, the standard NCP for IPv4, can be used to establish IPv4 connectivity over a link and configure <em>Van Jacobson header compression (VJ compression)</em> [RFC1144].</p>
</li>
<li>
<p>IPCP packets may be exchanged after the PPP state machine has reached the Network state.</p>
</li>
<li>
<p>IPCP packets use the same packet exchange mechanism and packet format as LCP, except the <em>Protocol</em> field is set to <em>0x8021</em>, and the <em>Code</em> field is limited to the range <em>0–7</em>.</p>
<div class="paragraph">
<p>These values of the Code field correspond to the message types: <em>vendor-specific</em> (see [RFC2153]), <em>configure-request</em>, <em>configure-ACK</em>, <em>configure-REJECT</em>, <em>terminate-request</em>, <em>terminate-ACK</em>, and <em>code-REJECT</em>.</p>
</div>
</li>
<li>
<p>IPCP can negotiate a number of options, including an <em>IP compression protocol (2)</em>, the <em>IPv4 address (3)</em>, and <em>Mobile IPv4 [RFC2290] (4)</em>.</p>
<div class="paragraph">
<p>Other options are available for learning the location of primary and secondary domain name servers.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>IPV6CP uses the same packet exchange and format as LCP, except it has two different options: <em>interface-identifier</em> and <em>IPv6-compression-protocol</em>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="loopback">5. Loopback</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although it may seem surprising, in many cases clients may wish to communicate with servers on the same computer using Internet protocols such as TCP/IP.</p>
</div>
<div class="paragraph">
<p>To enable this, most implementations support a network-layer <strong>loopback</strong> capability that typically takes the form of a virtual loopback network interface. It acts like a real network interface but is really a special piece of software provided by the operating system to enable TCP/IP and other communications on the same host computer.</p>
</div>
<div class="paragraph">
<p>IPv4 addresses starting with <em>127</em> are reserved for this, as is the IPv6 address <em>::1</em>.</p>
</div>
<div class="paragraph">
<p>Traditionally, UNIX-like systems including Linux assign the IPv4 address of <em>127.0.0.1</em> (<em>::1</em> for IPv6) to the loopback interface and assign it the name <em>localhost</em>.</p>
</div>
<div class="paragraph">
<p>An IP datagram sent to the loopback interface must not appear on any network.</p>
</div>
<div class="paragraph">
<p>In Linux, the loopback interface is called <em>lo</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">root@node-1:~#</span><span class="w"> </span>ip a s lo
<span class="gp">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt;</span><span class="w"> </span>mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
<span class="go">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In Windows, the Microsoft Loopback Adapter is not installed by default, even though IP loopback is still supported. This adapter can be used for testing various network configurations even when a physical network interface is not available.</p>
</div>
<div class="paragraph">
<p>To install it  run the program <em>hdwwiz</em> from the command prompt and add the Microsoft KM-TEST Loopback Adapter manually.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Microsoft Loopback Adapter was renamed in Windows 8 and Windows Server 2012. The new name is "Microsoft KM-TEST Loopback Adapter".
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">PS C:\&gt;</span><span class="w"> </span>ipconfig /all
<span class="go">
Ethernet adapter Ethernet 2:

   Connection-specific DNS Suffix  . :
   Description . . . . . . . . . . . : Microsoft KM-TEST Loopback Adapter
   Physical Address. . . . . . . . . : 02-00-4C-4F-4F-50
   DHCP Enabled. . . . . . . . . . . : Yes
   Autoconfiguration Enabled . . . . : Yes
   Link-local IPv6 Address . . . . . : fe80::12ba:71be:e45b:1870%54(Preferred)
   Autoconfiguration IPv4 Address. . : 169.254.24.54(Preferred)
   Subnet Mask . . . . . . . . . . . : 255.255.0.0
   Default Gateway . . . . . . . . . :
   DHCPv6 IAID . . . . . . . . . . . : 906100812
   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-28-F5-57-C4-8C-C6-81-FE-82-C4
   DNS Servers . . . . . . . . . . . : fec0:0:0:ffff::1%1
                                       fec0:0:0:ffff::2%1
                                       fec0:0:0:ffff::3%1
   NetBIOS over Tcpip. . . . . . . . : Enabled</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mtu-and-path-mtu">6. MTU and Path MTU</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When two hosts on the same network are communicating with each other, it is the <em>maximum transmission unit</em> (<strong>MTU</strong>) of the local link interconnecting them that has a direct effect on the size of datagrams.</p>
</div>
<div class="paragraph">
<p>When two hosts communicate across multiple networks, each link can have a different MTU. The minimum MTU across the network path comprising all of the links is called the <em>path</em> MTU.</p>
</div>
<div class="paragraph">
<p>The path MTU between any two hosts need not be constant over time.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It depends on the path being used at any time, which can change if the routers or links in the network fail.</p>
</li>
<li>
<p>Also, paths are often not symmetric (i.e., the path from host A to B may not be the reverse of the path from B to A); hence the path MTU need not be the same in the two directions.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tunneling-basics">7. Tunneling Basics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some cases it is useful to establish a <strong>virtual link</strong> between one computer and another across the Internet or other network. VPNs, for example, offer this type of service. The method most commonly used to implement these types of services is called <strong>tunneling</strong>.</p>
</div>
<div class="paragraph">
<p>Tunneling, generally speaking, is the idea of carrying lower-layer traffic in higher-layer (or equal-layer) packets.</p>
</div>
<div class="paragraph">
<p>For example, IPv4 can be carried in an IPv4 or IPv6 packet; Ethernet can be carried in a UDP or IPv4 or IPv6 packet, and so on.</p>
</div>
<div class="paragraph">
<p>Tunneling turns the idea of strict layering of protocols on its head and allows for the formation of <strong>overlay networks</strong> (i.e., networks where the "links" are really virtual links implemented in some other protocol instead of physical connections).</p>
</div>
<div class="paragraph">
<p>There is a great variety of methods for tunneling packets of one protocol and/or layer over another. Three of the more common protocols used to establish tunnels include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Generic Routing Encapsulation</em> (<strong>GRE</strong>) [RFC2784],</p>
</li>
<li>
<p>the Microsoft proprietary <em>Point-to-Point Tunneling Protocol</em> (<strong>PPTP</strong>) [RFC2637],</p>
</li>
<li>
<p>and the <em>Layer 2 Tunneling Protocol</em> (<strong>L2TP</strong>) [RFC3931].</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip-link-layer/tunneling-gre-header.png" alt="GRE header" width="55%" height="55%">
</div>
<div class="title">Figure 11. The basic GRE header is only 4 bytes but includes the option of a 16-bit checksum (of a type common to many Internet protocols). The header was later extended to include an identifier (Key field) common to multiple packets in a flow, and a Sequence Number, to help in resequencing packets that get out of order.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/tcp-ip-link-layer/tunneling-pptp-header.png" alt="PPTP header" width="55%" height="55%">
</div>
<div class="title">Figure 12. The PPTP header is based on an older, nonstandard GRE header. It includes a sequence number, a cumulative packet acknowledgment number, and some identification information. Most of the fields in the first word are set to 0.</div>
</div>
<div class="paragraph">
<p>Although GRE forms the basis for and is used by PPTP, the two protocols serve somewhat different purposes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GRE tunnels are typically used within the network infrastructure to carry traffic between ISPs</p>
<div class="paragraph">
<p>or within an enterprise intranet to serve branch offices</p>
</div>
<div class="paragraph">
<p>and are not necessarily encrypted, although GRE tunnels can be combined with IPsec.</p>
</div>
</li>
<li>
<p>PPTP, conversely, is most often used between users and their ISPs or corporate intranets and is encrypted (e.g., using MPPE).</p>
</li>
<li>
<p>PPTP essentially combines GRE with PPP, so GRE can provide the virtual point-to-point link upon which PPP operates.</p>
</li>
<li>
<p>GRE carries its traffic using IPv4 or IPv6 and as such is a layer 3 tunneling technology.</p>
</li>
<li>
<p>PPTP is more often used to carry layer 2 frames (such as Ethernet) so as to emulate a direct LAN (link-layer) connection.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references">References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="tcp_ip_vol_1"></a>[1] Kevin Fall, W. Stevens <em>TCP/IP Illustrated: The Protocols, Volume 1</em>. 2nd edition, Addison-Wesley Professional, 2011</p>
</li>
<li>
<p><a id="linux-vlan"></a>[2] <a href="https://developers.redhat.com/blog/2018/10/22/introduction-to-linux-interfaces-for-virtual-networking" class="bare">https://developers.redhat.com/blog/2018/10/22/introduction-to-linux-interfaces-for-virtual-networking</a></p>
</li>
</ul>
</div>
</div>
</div>
  </div>

  <ul class="post-navigation">
    <li>
      
      <a href="/2022/11/11/internet-address-architecture/">&laquo; TCP/IP: Internet Address Architecture</a>
      
    </li>
    <li>
      
      <a href="/2022/11/22/tcp-ip-internet-protocol/">TCP/IP: Internet Protocol &raquo;</a>
      
    </li>
  </ul>
</article>

      </div>
    </div>

    <footer class="site-footer">
  <div class="license">
    <span>Article licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></span>
  </div>
  
  <details open>
    <summary>Extral Links</summary>
    <div>
      
      <a href="https://jekyllrb.com/">Jekyll</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://shopify.github.io/">Liquid</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://docs.asciidoctor.org/">Asciidoctor</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://github.com/qqbuby/">GitHub</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="/feed.xml">RSS</a>
      
      
    </div>
  </details>
  
</footer>


<!-- https://github.com/bryanbraun/anchorjs -->
<script src="/js/anchor.min.js"></script>
<script>
  anchors.add();
  anchors.remove(".site-title");
</script>




  </body>

</html>
