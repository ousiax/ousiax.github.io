<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bing WebMaster -->
  <meta name="msvalidate.01" content="AB2FFF876C37F59D9121882CC8395DE5" />

  <title>VPC and Cloud Computing</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://blog.codefarm.me/2021/09/18/vpc-and-cloud-computing/">
  <link rel="alternate" type="application/rss+xml" title="CODE FARM" href="https://blog.codefarm.me/feed.xml">

  <!-- https://cdn.jsdelivr.net/gh/lurongkai/anti-baidu/js/anti-baidu-latest.min.js -->
<script type="text/javascript" src="/js/anti-baidu.min.js" charset="UTF-8"></script>

  
<!-- Google Analytics Website tracking -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83971182-1', 'auto');
  ga('send', 'pageview');

</script>


  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SN88FJ18E5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SN88FJ18E5');
</script>



</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <h2 class="site-title">
      <a class="site-title" href="/">CODE FARM</a>
    </h2>

     <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
        <div class="trigger">
            <ul>
                <li><a href="/">home</a>
                <li><a href="/category">category</a>
                <li><a href="/tag">tag</a>
                <li><a href="/archive">archive</a>
                <li><a href="/about">about</a>
                <li><a href="https://resume.github.io/?qqbuby" target="_blank">R&eacute;sum&eacute;</a>
            </ul>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">VPC and Cloud Computing</h1>
    
    
    <p class="post-meta"><time datetime="2021-09-18T21:29:45+08:00" itemprop="datePublished">Sep 18, 2021</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#what-is-a-virtual-private-cloud-vpc">What is a virtual private cloud (VPC)?</a></li>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#three-tier-architecture-in-a-vpc">Three-tier architecture in a VPC</a></li>
<li><a href="#security">Security</a></li>
<li><a href="#vpcs-on-aws-cloud">VPCs on AWS Cloud</a>
<ul class="sectlevel2">
<li><a href="#vpc-and-subnet-basics">VPC and subnet basics</a></li>
<li><a href="#subnet-routing">Subnet routing</a></li>
<li><a href="#subnet-security">Subnet security</a></li>
<li><a href="#route-tables">Route tables</a></li>
<li><a href="#security-groups">Security groups</a></li>
<li><a href="#network-acls">Network ACLs</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="what-is-a-virtual-private-cloud-vpc">What is a virtual private cloud (VPC)?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <strong>VPC</strong> is a public cloud offering that lets an enterprise establish its own private cloud-like computing environment on shared public cloud infrastructure. A VPC gives an enterprise the ability to define and control a virtual network that is logically isolated from all other public cloud tenants, creating a private, secure place on the public cloud.</p>
</div>
<div class="paragraph">
<p>A VPC’s <strong>logical isolation</strong> is implemented using <strong>virtual network</strong> functions and security features that give an enterprise customer granular control over which IP addresses or applications can access particular resources.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture">Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In a VPC, you can deploy cloud resources into your own isolated virtual network. These cloud resources—also known as logical instances—fall into three categories.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Compute</strong>: Virtual server instances (VSIs, also known as virtual servers) are presented to the user as virtual CPUs (vCPUs) with a predetermined amount of computing power, memory, etc.</p>
</li>
<li>
<p><strong>Storage</strong>: VPC customers are typically allocated a certain <em>block storage</em> quota per account, with the ability to purchase more. It is akin to purchasing additional hard drive space. Recommendations for storage are based on the nature of your workload.</p>
</li>
<li>
<p><strong>Networking</strong>: You can deploy virtual versions of various networking functions into your virtual private cloud account to enable or restrict access to its resources. These include <em>public gateways</em>, which are deployed so that all or some areas of your VPC environment can be made available on the public-facing Internet; <em>load balancers</em>, which distribute traffic across multiple VSIs to optimize availability and performance;  and <em>routers</em>, which direct traffic and enable communication between network segments. <em>Direct or dedicated links</em> enable rapid and secure communications between your on-premises enterprise IT environment or your private cloud and your VPC resources on public cloud.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="three-tier-architecture-in-a-vpc">Three-tier architecture in a VPC</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The majority of today’s applications are designed with a <em>three-tier architecture</em> comprised of the following interconnected tiers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>web or presentation tier</strong>, which takes requests from web browsers and presents information created by, or stored within, the other layers to end users.</p>
</li>
<li>
<p>The <strong>application tier</strong>, which houses the business logic and is where most processing takes place.</p>
</li>
<li>
<p>The <strong>database tier</strong>, comprised of database servers that store the data processed in the application tier.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To create a three-tier application architecture on a VPC, you assign each tier its own <em>subnet</em>, which will give it its own IP address range. Each layer is automatically assigned its own unique <em>ACL</em>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security">Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>VPCs achieve high levels of security by creating <a href="https://www.ibm.com/cloud/learn/virtualization-a-complete-guide">virtualized</a> replicas of the security features used to control access to resources housed in traditional data centers. These security features enable customers to define virtual networks in logically isolated parts of the public cloud and control which IP addresses have access to which resources.</p>
</div>
<div class="paragraph">
<p>Two types of network access controls comprise the layers of VPC security:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Access control lists (ACLs)</strong>: An ACL is a list of rules that limit who can access a <em>particular subnet</em> within your VPC. A subnet is a portion or subdivision of your VPC; the ACL defines the set of IP addresses or applications granted access to it.</p>
</li>
<li>
<p><strong>Security group</strong>: With a security group, you can create <em>groups of resources</em> (which may be situated in more than one subnet) and assign uniform access rules to them. For example, if you have three applications in three different subnets, and you want them all to be public Internet-facing, you can place them in the same security group. <em>Security groups act like virtual firewalls, controlling the flow of traffic to your virtual servers, no matter which subnet they are in.</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vpcs-on-aws-cloud">VPCs on AWS Cloud</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="vpc-and-subnet-basics">VPC and subnet basics</h3>
<div class="paragraph">
<p>A virtual private cloud (VPC) is a virtual network dedicated to your AWS account. It is logically isolated from other virtual networks in the AWS Cloud. You can launch your AWS resources, such as Amazon EC2 instances, into your VPC.</p>
</div>
<div class="paragraph">
<p>When you create a VPC, you must specify a range of IPv4 addresses for the VPC in the form of a <a href="https://datatracker.ietf.org/doc/html/rfc4632">Classless Inter-Domain Routing (CIDR) block</a>; for example, <code>10.0.0.0/16</code>. This is the primary CIDR block for your VPC.</p>
</div>
<div class="paragraph">
<p>A VPC spans all of the Availability Zones in the Region. The following diagram shows a new VPC with an IPv4 CIDR block.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.aws.amazon.com/vpc/latest/userguide/images/vpc-diagram.png" alt="vpc diagram">
</div>
</div>
<div class="paragraph">
<p>After you create a VPC, you can add one or more subnets in each Availability Zone. A <em>subnet</em> is a range of IP addresses in your VPC. You can launch AWS resources, such as EC2 instances, into a specific subnet. When you create a subnet, you specify the IPv4 CIDR block for the subnet, which is a subset of the VPC CIDR block. <strong>Each subnet must reside entirely within one Availability Zone and cannot span zones.</strong> By launching instances in separate Availability Zones, you can protect your applications from the failure of a single zone.</p>
</div>
<div class="paragraph">
<p>You can also optionally assign an IPv6 CIDR block to your VPC, and assign IPv6 CIDR blocks to your subnets.</p>
</div>
<div class="paragraph">
<p>The following diagram shows a VPC that has been configured with subnets in multiple Availability Zones. 1A, 2A, and 3A are instances in your VPC. An IPv6 CIDR block is associated with the VPC, and an IPv6 CIDR block is associated with subnet 1. An <em>internet gateway</em> enables communication over the internet, and a <em>virtual private network</em> (VPN) connection enables communication with your corporate network.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://docs.aws.amazon.com/vpc/latest/userguide/images/subnets-diagram.png" alt="subnets diagram">
</div>
</div>
<div class="paragraph">
<p>If a subnet&#8217;s traffic is routed to an internet gateway, the subnet is known as a <em>public subnet</em>. In this diagram, subnet 1 is a public subnet. If you want your instance in a public subnet to communicate with the internet over IPv4, it must have a public IPv4 address or an Elastic IP address (IPv4). For more information about public IPv4 addresses, see Public IPv4 addresses. If you want your instance in the public subnet to communicate with the internet over IPv6, it must have an IPv6 address.</p>
</div>
<div class="paragraph">
<p>If a subnet doesn&#8217;t have a route to the internet gateway, the subnet is known as a <em>private subnet</em>. In this diagram, subnet 2 is a private subnet.</p>
</div>
<div class="paragraph">
<p>If a subnet doesn&#8217;t have a route to the internet gateway, but has its traffic routed to a virtual private gateway for a Site-to-Site VPN connection, the subnet is known as a <em>VPN-only subnet</em>. In this diagram, subnet 3 is a VPN-only subnet. Currently, we do not support IPv6 traffic over a Site-to-Site VPN connection.</p>
</div>
</div>
<div class="sect2">
<h3 id="subnet-routing">Subnet routing</h3>
<div class="paragraph">
<p>Each subnet must be associated with a <em>route table</em>, which specifies the allowed routes for outbound traffic leaving the subnet. Every subnet that you create is automatically associated with the main route table for the VPC. You can change the association, and you can change the contents of the main route table.</p>
</div>
<div class="paragraph">
<p>In the previous diagram, the route table associated with <code>subnet 1</code> routes all IPv4 traffic (<code>0.0.0.0/0</code>) and IPv6 traffic (<code>::/0</code>) to an internet gateway (for example, <code>igw-1a2b3c4d</code>). Because instance <code>1A</code> has an IPv4 Elastic IP address and an IPv6 address, it can be reached from the internet over both IPv4 and IPv6.
Note</p>
</div>
<div class="paragraph">
<p>The instance <code>2A</code> can&#8217;t reach the internet, but can reach other instances in the VPC. You can allow an instance in your VPC to initiate outbound connections to the internet over IPv4 but prevent unsolicited inbound connections from the internet using a <em>network address translation (NAT)</em> gateway or instance. Because you can allocate a limited number of Elastic IP addresses, we recommend that you use a NAT device if you have more instances that require a static public IP address. To initiate outbound-only communication to the internet over IPv6, you can use an egress-only internet gateway.</p>
</div>
<div class="paragraph">
<p>The route table associated with <code>subnet 3</code> routes all IPv4 traffic (<code>0.0.0.0/0</code>) to a <em>virtual private gateway</em> (for example, <code>vgw-1a2b3c4d</code>). Instance <code>3A</code> can reach computers in the corporate network over the <em>Site-to-Site VPN</em> connection.</p>
</div>
</div>
<div class="sect2">
<h3 id="subnet-security">Subnet security</h3>
<div class="paragraph">
<p>AWS provides two features that you can use to increase security in your VPC: <em>security groups</em> and <em>network ACLs</em>. Security groups control inbound and outbound traffic for your instances, and network ACLs control inbound and outbound traffic for your subnets. In most cases, security groups can meet your needs; however, you can also use network ACLs if you want an additional layer of security for your VPC.</p>
</div>
</div>
<div class="sect2">
<h3 id="route-tables">Route tables</h3>
<div class="paragraph">
<p>A <em>route table</em> contains a set of rules, called <em>routes</em>, that are used to determine where network traffic from your subnet or gateway is directed.</p>
</div>
<div class="sect3">
<h4 id="route-table-concepts">Route table concepts</h4>
<div class="paragraph">
<p>The following are the key concepts for route tables.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Main route table</strong>—The route table that automatically comes with your VPC. It controls the routing for all subnets that are not explicitly associated with any other route table.</p>
</li>
<li>
<p><strong>Custom route table</strong>—A route table that you create for your VPC.</p>
</li>
<li>
<p><strong>Edge association</strong>—A route table that you use to route inbound VPC traffic to an appliance. You associate a route table with the internet gateway or virtual private gateway, and specify the network interface of your appliance as the target for VPC traffic.</p>
</li>
<li>
<p><strong>Route table association</strong>—The association between a route table and a subnet, internet gateway, or virtual private gateway.</p>
</li>
<li>
<p><strong>Subnet route table</strong>—A route table that&#8217;s associated with a subnet.</p>
</li>
<li>
<p>Gateway route table*—A route table that&#8217;s associated with an internet gateway or virtual private gateway.</p>
</li>
<li>
<p><strong>Local gateway route table</strong>—A route table that&#8217;s associated with an Outposts local gateway.</p>
</li>
<li>
<p><strong>Destination</strong>—The range of IP addresses where you want traffic to go (destination CIDR). For example, an external corporate network with the CIDR 172.16.0.0/12.</p>
</li>
<li>
<p><strong>Propagation</strong>—Route propagation allows a virtual private gateway to automatically propagate routes to the route tables. This means that you don&#8217;t need to manually enter VPN routes to your route tables. For more information about VPN routing options, see Site-to-Site VPN routing options in the Site-to-Site VPN User Guide.</p>
</li>
<li>
<p><strong>Target</strong>—The gateway, network interface, or connection through which to send the destination traffic; for example, an internet gateway.</p>
</li>
<li>
<p><strong>Local route</strong>—A default route for communication within the VPC.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="how-route-tables-work">How route tables work</h4>
<div class="paragraph">
<p>Your VPC has an <em>implicit router</em>, and you use route tables to control where network traffic is directed. Each subnet in your VPC must be associated with a route table, which controls the routing for the subnet (<em>subnet route table</em>). You can explicitly associate a subnet with a particular route table. Otherwise, the subnet is implicitly associated with the <em>main route table</em>. A subnet can only be associated with one route table at a time, but you can associate multiple subnets with the same subnet route table.</p>
</div>
<div class="paragraph">
<p>You can optionally associate a route table with an internet gateway or a virtual private gateway (gateway route table). This enables you to specify routing rules for inbound traffic that enters your VPC through the gateway.</p>
</div>
</div>
<div class="sect3">
<h4 id="routes">Routes</h4>
<div class="paragraph">
<p>Each route in a table specifies a <em>destination</em> and a <em>target</em>. For example, to enable your subnet to access the internet through an internet gateway, add the following route to your subnet route table. The destination for the route is <code>0.0.0.0/0</code>, which represents all IPv4 addresses. The target is the internet gateway that&#8217;s attached to your VPC.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Destination</th>
<th class="tableblock halign-left valign-top">Target</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><mark>igw-id</mark></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>CIDR blocks for IPv4 and IPv6 are treated separately. For example, a route with a destination CIDR of 0.0.0.0/0 does not automatically include all IPv6 addresses. You must create a route with a destination CIDR of ::/0 for all IPv6 addresses.</p>
</div>
<div class="paragraph">
<p>Every route table contains a local route for communication within the VPC. This route is added by default to all route tables. If your VPC has more than one IPv4 CIDR block, your route tables contain a local route for each IPv4 CIDR block. If you&#8217;ve associated an IPv6 CIDR block with your VPC, your route tables contain a local route for the IPv6 CIDR block. You cannot modify or delete these routes in a subnet route table or in the main route table.</p>
</div>
<div class="paragraph">
<p>You can add a route to your route tables that is more specific than the local route. The destination must match the entire IPv4 or IPv6 CIDR block of a subnet in your VPC.</p>
</div>
<div class="paragraph">
<p>If your route table has multiple routes, we use the most specific route that matches the traffic (longest prefix match) to determine how to route the traffic.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p>In the following example, suppose that the VPC has both an IPv4 CIDR block and an IPv6 CIDR block. In the route table:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IPv6 traffic destined to remain within the VPC (<code>2001:db8:1234:1a00::/56</code>) is covered by the <em>Local route</em>, and is routed within the VPC.</p>
</li>
<li>
<p>IPv4 and IPv6 traffic are treated separately; therefore, all IPv6 traffic (except for traffic within the VPC) is routed to the egress-only internet gateway.</p>
</li>
<li>
<p>There is a route for <code>172.31.0.0/16</code> IPv4 traffic that points to a <em>peering connection</em>.</p>
</li>
<li>
<p>There is a route for all IPv4 traffic (<code>0.0.0.0/0</code>) that points to an <em>internet gateway</em>.</p>
</li>
<li>
<p>There is a route for all IPv6 traffic (<code>::/0</code>) that points to an <em>egress-only internet gateway</em>.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Destination</th>
<th class="tableblock halign-left valign-top">Target</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.0.0.0/16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2001:db8:1234:1a00::/56</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.31.0.0/16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pcx-11223344556677889</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">igw-12345678901234567</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">::/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eigw-aabbccddee1122334</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="route-priority">Route priority</h4>
<div class="paragraph">
<p>We use the most specific route in your route table that matches the traffic to determine how to route the traffic (longest prefix match).</p>
</div>
<div class="paragraph">
<p>Routes to IPv4 and IPv6 addresses or CIDR blocks are independent of each other. We use the most specific route that matches either IPv4 traffic or IPv6 traffic to determine how to route the traffic.</p>
</div>
<div class="paragraph">
<p>For example, the following subnet route table has a route for IPv4 internet traffic (<code>0.0.0.0/0</code>) that points to an internet gateway, and a route for <code>172.31.0.0/16</code> IPv4 traffic that points to a peering connection (<code>pcx-11223344556677889</code>). Any traffic from the subnet that&#8217;s destined for the <code>172.31.0.0/16</code> IP address range uses the peering connection, because this route is more specific than the route for internet gateway. Any traffic destined for a target within the VPC (<code>10.0.0.0/16</code>) is covered by the Local route, and therefore is routed within the VPC. All other traffic from the subnet uses the internet gateway.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Destination</th>
<th class="tableblock halign-left valign-top">Target</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.0.0.0/16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.31.0.0/16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pcx-11223344556677889</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">igw-12345678901234567</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you&#8217;ve attached a virtual private gateway to your VPC and enabled <em>route propagation</em> on your subnet route table, routes representing your Site-to-Site VPN connection automatically appear as propagated routes in your route table. <em>If the propagated routes overlap with static routes and longest prefix match cannot be applied, the static routes take priority over the propagated routes.</em> For more information, see Route tables and VPN route priority in the AWS Site-to-Site VPN User Guide.</p>
</div>
<div class="paragraph">
<p>In this example, your route table has a static route to an internet gateway (which you added manually), and a propagated route to a virtual private gateway. Both routes have a destination of <code>172.31.0.0/24</code>. In this case, all traffic destined for <code>172.31.0.0/24</code> is routed to the internet gateway — it is a static route and therefore takes priority over the propagated route.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Destination</th>
<th class="tableblock halign-left valign-top">Target</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.0.0.0/16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.31.0.0/24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">vgw-11223344556677889 (propagated)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">172.31.0.0/24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">igw-12345678901234567 (static)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The same rule applies if your route table contains a static route to any of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NAT gateway</p>
</li>
<li>
<p>Network interface</p>
</li>
<li>
<p>Instance ID</p>
</li>
<li>
<p>Gateway VPC endpoint</p>
</li>
<li>
<p>Transit gateway</p>
</li>
<li>
<p>VPC peering connection</p>
</li>
<li>
<p>Gateway Load Balancer endpoint</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the destinations for the static and propagated routes are the same, the static route takes priority.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security-groups">Security groups</h3>
<div class="paragraph">
<p><em>A security group acts as a virtual firewall for your instance to control inbound and outbound traffic.</em> When you launch an instance in a VPC, you can assign up to five security groups to the instance. Security groups act at the instance level, not the subnet level. Therefore, each instance in a subnet in your VPC can be assigned to a different set of security groups.</p>
</div>
<div class="paragraph">
<p>For each security group, you add rules that control the inbound traffic to instances, and a separate set of rules that control the outbound traffic. This section describes the basic things that you need to know about security groups for your VPC and their rules.</p>
</div>
<div class="paragraph">
<p>You might set up network ACLs with rules similar to your security groups in order to add an additional layer of security to your VPC.</p>
</div>
<div class="sect3">
<h4 id="security-group-basics">Security group basics</h4>
<div class="paragraph">
<p>The following are the characteristics of security groups:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can specify allow rules, but not deny rules.</p>
</li>
<li>
<p>You can specify separate rules for inbound and outbound traffic.</p>
</li>
<li>
<p>Security group rules enable you to filter traffic based on protocols and port numbers.</p>
</li>
<li>
<p><strong>Security groups are stateful</strong> — if you send a request from your instance, the response traffic for that request is allowed to flow in regardless of inbound security group rules. Responses to allowed inbound traffic are allowed to flow out, regardless of outbound rules.</p>
</li>
<li>
<p>When you first create a security group, it has no inbound rules. Therefore, no inbound traffic originating from another host to your instance is allowed until you add inbound rules to the security group.</p>
</li>
<li>
<p>By default, a security group includes an outbound rule that allows all outbound traffic. You can remove the rule and add outbound rules that allow specific outbound traffic only. If your security group has no outbound rules, no outbound traffic originating from your instance is allowed.</p>
</li>
<li>
<p>There are quotas on the number of security groups that you can create per VPC, the number of rules that you can add to each security group, and the number of security groups that you can associate with a network interface.</p>
</li>
<li>
<p>Instances associated with a security group can&#8217;t talk to each other unless you add rules allowing the traffic (exception: the default security group has these rules by default).</p>
</li>
<li>
<p><strong>Security groups are associated with network interfaces.</strong> After you launch an instance, you can change the security groups that are associated with the instance, which changes the security groups associated with the primary network interface (eth0). You can also specify or change the security groups associated with any other network interface. By default, when you create a network interface, it&#8217;s associated with the default security group for the VPC, unless you specify a different security group.</p>
</li>
<li>
<p>When you create a security group, you must provide it with a name and a description. The following rules apply:</p>
<div class="ulist">
<ul>
<li>
<p>Names and descriptions can be up to 255 characters in length.</p>
</li>
<li>
<p>Names and descriptions are limited to the following characters: a-z, A-Z, 0-9, spaces, and <code>._-:/()#,@[]+=&amp;;{}!$*</code>.</p>
</li>
<li>
<p>When the name contains trailing spaces, we trim the space at the end of the name. For example, if you enter "Test Security Group " for the name, we store it as "Test Security Group".</p>
</li>
<li>
<p>A security group name cannot start with <em>sg-</em> as these indicate a default security group.</p>
</li>
<li>
<p>A security group name must be unique within the VPC.</p>
</li>
</ul>
</div>
</li>
<li>
<p>security group can only be used in the VPC that you specify when you create the security group.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="default-security-group-for-your-vpc">Default security group for your VPC</h4>
<div class="paragraph">
<p>Your VPC automatically comes with a default security group. If you don&#8217;t specify a different security group when you launch the instance, we associate the default security group with your instance.
Note</p>
</div>
<div class="paragraph">
<p>The following table describes the default rules for a default security group.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 23.0769%;">
<col style="width: 7.6923%;">
<col style="width: 23.0769%;">
<col style="width: 46.1539%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock"><strong>Inbound</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The security group ID (sg-xxxxxxxx)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow inbound traffic from network interfaces (and their associated instances) that are assigned to the same security group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock"><strong>Outbound</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow all outbound IPv4 traffic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">::/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow all outbound IPv6 traffic. This rule is added by default if you create a VPC with an IPv6 CIDR block or if you associate an IPv6 CIDR block with your existing VPC.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="security-group-rules">Security group rules</h4>
<div class="paragraph">
<p>You can add or remove rules for a security group (also referred to as <em>authorizing</em> or <em>revoking</em> inbound or outbound access). A rule applies either to inbound traffic (ingress) or outbound traffic (egress). You can grant access to a specific CIDR range, or to another security group in your VPC or in a peer VPC (requires a VPC peering connection).</p>
</div>
<div class="paragraph">
<p>The rules of a security group control the inbound traffic that&#8217;s allowed to reach the instances that are associated with the security group. The rules also control the outbound traffic that&#8217;s allowed to leave them.</p>
</div>
<div class="paragraph">
<p>The following are the characteristics of security group rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By default, security groups allow all outbound traffic.</p>
</li>
<li>
<p>Security group rules are always permissive; you can&#8217;t create rules that deny access.</p>
</li>
<li>
<p>Security group rules enable you to filter traffic based on protocols and port numbers.</p>
</li>
<li>
<p><strong>Security groups are stateful</strong>—if you send a request from your instance, the response traffic for that request is allowed to flow in regardless of the inbound rules. This also means that responses to allowed inbound traffic are allowed to flow out, regardless of the outbound rules.</p>
</li>
<li>
<p>You can add and remove rules at any time. Your changes are automatically applied to the instances that are associated with the security group.</p>
</li>
<li>
<p>The effect of some rule changes can depend on how the traffic is tracked.</p>
</li>
<li>
<p>When you associate multiple security groups with an instance, the rules from each security group are effectively aggregated to create one set of rules. Amazon EC2 uses this set of rules to determine whether to allow access.</p>
</li>
<li>
<p>You can assign multiple security groups to an instance. Therefore, an instance can have hundreds of rules that apply. This might cause problems when you access the instance. We recommend that you condense your rules as much as possible.</p>
</li>
<li>
<p>For each rule, you specify the following:</p>
</li>
<li>
<p><strong>Name</strong>: The name for the security group (for example, my-security-group).</p>
<div class="paragraph">
<p>A name can be up to 255 characters in length. Allowed characters are a-z, A-Z, 0-9, spaces, and <code>._-:/()#,@[]+=;{}!$*</code>. When the name contains trailing spaces, we trim the spaces when we save the name. For example, if you enter "Test Security Group " for the name, we store it as "Test Security Group".</p>
</div>
</li>
<li>
<p><strong>Protocol</strong>: The protocol to allow. The most common protocols are 6 (TCP), 17 (UDP), and 1 (ICMP).</p>
</li>
<li>
<p><strong>Port range</strong>: For TCP, UDP, or a custom protocol, the range of ports to allow. You can specify a single port number (for example, 22), or range of port numbers (for example, 7000-8000).</p>
</li>
<li>
<p><strong>ICMP type and code</strong>: For ICMP, the ICMP type and code.</p>
</li>
<li>
<p><strong>Source or destination</strong>: The source (inbound rules) or destination (outbound rules) for the traffic. Specify one of these options:</p>
<div class="ulist">
<ul>
<li>
<p>A single IPv4 address. You must use the <code>/32</code> prefix length; for example, <code>203.0.113.1/32</code>.</p>
</li>
<li>
<p>A single IPv6 address. You must use the <code>/128</code> prefix length; for example, <code>2001:db8:1234:1a00::123/128</code>.</p>
</li>
<li>
<p>A range of IPv4 addresses, in CIDR block notation; for example, <code>203.0.113.0/24</code>.</p>
</li>
<li>
<p>A range of IPv6 addresses, in CIDR block notation; for example, <code>2001:db8:1234:1a00::/64</code>.</p>
</li>
<li>
<p>The ID of a prefix list; for example, <code>pl-1234abc1234abc123</code>.</p>
</li>
<li>
<p>Another security group. This allows instances that are associated with the specified security group to access instances associated with this security group. Choosing this option does not add rules from the source security group to this security group. You can specify one of the following security groups:</p>
<div class="ulist">
<ul>
<li>
<p>The current security group</p>
</li>
<li>
<p>A different security group for the same VPC</p>
</li>
<li>
<p>A different security group for a peer VPC in a VPC peering connection</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>(Optional) Description</strong>: You can add a description for the rule, which can help you identify it later. A description can be up to 255 characters in length. Allowed characters are a-z, A-Z, 0-9, spaces, and <code>._-:/()#,@[]+=;{}!$*</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="network-acls">Network ACLs</h3>
<div class="paragraph">
<p>A <em>network access control list (ACL)</em> is an optional layer of security for your VPC that acts as a firewall for controlling traffic in and out of one or more subnets. You might set up network ACLs with rules similar to your security groups in order to add an additional layer of security to your VPC.</p>
</div>
<div class="sect3">
<h4 id="network-acl-basics">Network ACL basics</h4>
<div class="paragraph">
<p>The following are the basic things that you need to know about network ACLs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Your VPC automatically comes with a modifiable default network ACL. By default, it allows all inbound and outbound IPv4 traffic and, if applicable, IPv6 traffic.</p>
</li>
<li>
<p>You can create a custom network ACL and associate it with a subnet. <strong>By default, each custom network ACL denies all inbound and outbound traffic until you add rules.</strong></p>
</li>
<li>
<p>Each subnet in your VPC must be associated with a network ACL. If you don&#8217;t explicitly associate a subnet with a network ACL, the subnet is automatically associated with the default network ACL.</p>
</li>
<li>
<p>You can associate a network ACL with multiple subnets. However, a subnet can be associated with only one network ACL at a time. When you associate a network ACL with a subnet, the previous association is removed.</p>
</li>
<li>
<p>A network ACL contains a numbered list of rules. We evaluate the rules in order, starting with the lowest numbered rule, to determine whether traffic is allowed in or out of any subnet associated with the network ACL. The highest number that you can use for a rule is 32766. We recommend that you start by creating rules in increments (for example, increments of 10 or 100) so that you can insert new rules where you need to later on.</p>
</li>
<li>
<p>A network ACL has separate inbound and outbound rules, and each rule can either allow or deny traffic.</p>
</li>
<li>
<p><strong>Network ACLs are stateless</strong>, which means that responses to allowed inbound traffic are subject to the rules for outbound traffic (and vice versa).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="network-acl-rules">Network ACL rules</h4>
<div class="paragraph">
<p>You can add or remove rules from the default network ACL, or create additional network ACLs for your VPC. When you add or remove rules from a network ACL, the changes are automatically applied to the subnets that it&#8217;s associated with.</p>
</div>
<div class="paragraph">
<p>The following are the parts of a network ACL rule:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Rule number</strong>. Rules are evaluated starting with the lowest numbered rule. As soon as a rule matches traffic, it&#8217;s applied regardless of any higher-numbered rule that might contradict it.</p>
</li>
<li>
<p><strong>Type</strong>. The type of traffic; for example, SSH. You can also specify all traffic or a custom range.</p>
</li>
<li>
<p><strong>Protocol</strong>. You can specify any protocol that has a standard protocol number.</p>
<div class="paragraph">
<p>If you specify ICMP as the protocol, you can specify any or all of the ICMP types and codes.</p>
</div>
</li>
<li>
<p><strong>Port range</strong>. The listening port or port range for the traffic. For example, 80 for HTTP traffic.</p>
</li>
<li>
<p><strong>Source</strong>. [Inbound rules only] The source of the traffic (CIDR range).</p>
</li>
<li>
<p><strong>Destination</strong>. [Outbound rules only] The destination for the traffic (CIDR range).</p>
</li>
<li>
<p><strong>Allow/Deny</strong>. Whether to allow or deny the specified traffic.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="default-network-acl">Default network ACL</h4>
<div class="paragraph">
<p>The default network ACL is configured to allow all traffic to flow in and out of the subnets with which it is associated. Each network ACL also includes a rule whose rule number is an asterisk. This rule ensures that if a packet doesn&#8217;t match any of the other numbered rules, it&#8217;s denied. You can&#8217;t modify or remove this rule.</p>
</div>
<div class="paragraph">
<p>The following is an example default network ACL for a VPC that supports IPv4 only.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">Inbound</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rule #</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow/Deny</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All IPv4 traffic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALLOW</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All IPv4 traffic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DENY</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">Outbound</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rule #</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow/Deny</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All IPv4 traffic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALLOW</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All IPv4 traffic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.0/0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DENY</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references">References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://www.ibm.com/cloud/learn/vpc" class="bare">https://www.ibm.com/cloud/learn/vpc</a></p>
</li>
<li>
<p><a href="https://www.ibm.com/cloud/blog/virtual-private-cloud-the-tech-and-the-test" class="bare">https://www.ibm.com/cloud/blog/virtual-private-cloud-the-tech-and-the-test</a></p>
</li>
<li>
<p><a href="https://www.ibm.com/cloud/learn/cloud-computing-gbl" class="bare">https://www.ibm.com/cloud/learn/cloud-computing-gbl</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/vpc/latest/userguide/what-is-amazon-vpc.html" class="bare">https://docs.aws.amazon.com/vpc/latest/userguide/what-is-amazon-vpc.html</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/vpc/latest/userguide/how-it-works.html" class="bare">https://docs.aws.amazon.com/vpc/latest/userguide/how-it-works.html</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Subnets.html" class="bare">https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Subnets.html</a></p>
</li>
</ul>
</div>
</div>
</div>
  </div>

  <ul class="post-navigation">
    <li>
      
      <a href="/2021/09/17/http-caching/">&laquo; HTTP Caching and Conditional Requests</a>
      
    </li>
    <li>
      
      <a href="/2021/09/24/http-redirect-3xx/">HTTP 3xx Redirect and NGINX Rewrite Directives &raquo;</a>
      
    </li>
  </ul>
</article>

      </div>
    </div>

    <footer class="site-footer">
  <div class="license">
    <span>Article licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></span>
  </div>
  
  <details open>
    <summary>Extral Links</summary>
    <div>
      
      <a href="https://jekyllrb.com/">Jekyll</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://shopify.github.io/">Liquid</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://docs.asciidoctor.org/">Asciidoctor</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://github.com/qqbuby/">GitHub</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="/feed.xml">RSS</a>
      
      
    </div>
  </details>
  
</footer>


<!-- https://github.com/bryanbraun/anchorjs -->
<script src="/js/anchor.min.js"></script>
<script>
  anchors.add();
  anchors.remove(".site-title");
</script>




  </body>

</html>
