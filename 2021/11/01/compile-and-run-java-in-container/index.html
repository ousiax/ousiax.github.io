<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bing WebMaster -->
  <meta name="msvalidate.01" content="AB2FFF876C37F59D9121882CC8395DE5" />

  <title>How to compile and run Java in Container</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://blog.codefarm.me/2021/11/01/compile-and-run-java-in-container/">
  <link rel="alternate" type="application/rss+xml" title="CODE FARM" href="https://blog.codefarm.me/feed.xml">

  <!-- https://cdn.jsdelivr.net/gh/lurongkai/anti-baidu/js/anti-baidu-latest.min.js -->
<script type="text/javascript" src="/js/anti-baidu.min.js" charset="UTF-8"></script>

  
<!-- Google Analytics Website tracking -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83971182-1', 'auto');
  ga('send', 'pageview');

</script>


  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SN88FJ18E5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SN88FJ18E5');
</script>



</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <h2 class="site-title">
      <a class="site-title" href="/">CODE FARM</a>
    </h2>

     <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
        <div class="trigger">
            <ul>
                <li><a href="/">home</a>
                <li><a href="/category">category</a>
                <li><a href="/tag">tag</a>
                <li><a href="/archive">archive</a>
                <li><a href="/about">about</a>
                <li><a href="https://resume.github.io/?qqbuby" target="_blank">R&eacute;sum&eacute;</a>
            </ul>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">How to compile and run Java in Container</h1>
    
    
    <p class="post-meta"><time datetime="2021-11-01T13:12:53+08:00" itemprop="datePublished">Nov 1, 2021</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#the-javac-command">1. The <strong>javac</strong> Command</a></li>
<li><a href="#the-java-command">2. The <strong>java</strong> Command</a>
<ul class="sectlevel2">
<li><a href="#overview-of-java-options">2.1. Overview of Java Options</a></li>
<li><a href="#standard-options-for-java">2.2. Standard Options for Java</a></li>
<li><a href="#extra-options-for-java">2.3. Extra Options for Java</a></li>
<li><a href="#advanced-options-for-java">2.4. Advanced Options for Java</a></li>
<li><a href="#advanced-runtime-options-for-java">2.5. Advanced Runtime Options for Java</a></li>
<li><a href="#advanced-jit-compiler-options-for-java">2.6. Advanced JIT Compiler Options for java</a></li>
<li><a href="#advanced-garbage-collection-options-for-java">2.7. Advanced Garbage Collection Options for Java</a></li>
<li><a href="#removed-java-options">2.8. Removed Java Options</a></li>
</ul>
</li>
<li><a href="#maven">3. Maven</a>
<ul class="sectlevel2">
<li><a href="#the-build-lifecycle">3.1. The Build Lifecycle</a></li>
<li><a href="#standard-directory-layout">3.2. Standard Directory Layout</a></li>
<li><a href="#configuring-plug-ins">3.3. Configuring Plug-ins</a></li>
<li><a href="#maven-help-plugin">3.4. Maven Help Plugin</a></li>
<li><a href="#spring-boot-maven-plugin">3.5. Spring Boot Maven Plugin</a></li>
</ul>
</li>
<li><a href="#java-in-container">4. Java in Container</a>
<ul class="sectlevel2">
<li><a href="#container-detection-support">4.1. Container detection support</a></li>
<li><a href="#spring-boot-in-kubernetes">4.2. Spring Boot in Kubernetes</a></li>
</ul>
</li>
<li><a href="#references">5. References</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="the-javac-command">1. The <strong>javac</strong> Command</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>javac</strong> command reads source files that contain module, package and type declarations written in the Java programming language, and compiles them into class files that run on the Java Virtual Machine.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// Hello.java</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Hello</span> <span class="o">{</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello Java!"</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">// Complile with `javac`
</span><span class="gp">$</span><span class="w"> </span>javac Hello.java
<span class="gp">$</span><span class="w"> </span>java Hello
<span class="go">Hello Java!

// javac -d and java -cp
</span><span class="gp">$</span><span class="w"> </span>javac Hello.java <span class="nt">-d</span> target/classes/
<span class="gp">$</span><span class="w"> </span>java <span class="nt">-cp</span> target/classes/ Hello
<span class="go">Hello Java!</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-java-command">2. The <strong>java</strong> Command</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>java</strong> command starts a Java application. It does this by starting the Java Virtual Machine (JVM), loading the specified class, and calling that class&#8217;s <em>main()</em> method. The method must be declared <em>public</em> and <em>static</em>, it must not return any value, and it must accept a <em>String</em> array as a parameter. The method declaration has the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In source-file mode, the java command can launch a class declared in a source file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can use the <code>JDK_JAVA_OPTIONS</code> launcher environment variable to prepend its content to the actual command line of the java launcher.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, the first argument that isn&#8217;t an option of the java command is the fully qualified name of the class to be called. If <code>-jar</code> is specified, then its argument is the name of the JAR file containing class and resource files for the application. The startup class must be indicated by the <code>Main-Class</code> manifest header in its manifest file.</p>
</div>
<div class="paragraph">
<p>Arguments after the class file name or the JAR file name are passed to the <em>main()</em> method.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>To launch a single source-file program</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Synopsis</strong></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">java [options] source-file [args ...]</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>java Hello.java</strong></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>java Hello.java
<span class="go">Hello Java!</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>To launch a class file</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Synopsis</strong></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">java [options] mainclass [args ...]</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>java Hello</strong></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>javac Hello.java
<span class="gp">$</span><span class="w"> </span>java Hello
<span class="go">Hello Java!</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>To launch the main class in a JAR file</strong></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">java [options] -jar jarfile [args ...]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>jarfile</em> argument is the name of a JAR file with a manifest that contains a line in the form <code>Main-Class:classname</code> that defines the class with the <code>public static void main(String[] args)</code> method that serves as your application&#8217;s starting point.</p>
</div>
<div class="paragraph">
<p>When you use <code>-jar</code>, the specified JAR file is the source of all user classes, and other class path settings are ignored.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">The <code>jar</code> command</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">jar [OPTION ...] [ [--release VERSION] [-C dir] files] ...</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>jar <span class="nt">-cf</span> foo.jar Hello.class
<span class="gp">$</span><span class="w"> </span>java <span class="nt">-cp</span> foo.jar Hello
<span class="go">Hello Java!</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>java <span class="nt">-jar</span> foo.jar
<span class="hll"><span class="go">no main manifest attribute, in foo.jar</span>
</span>
<span class="gp">$</span><span class="w"> </span>jar <span class="nt">--create</span> <span class="nt">--file</span> buz.jar <span class="nt">--main-class</span> Hello Hello.class
<span class="gp">$</span><span class="w"> </span>java <span class="nt">-jar</span> buz.jar
<span class="go">Hello Java!</span>

<span class="gp">$</span><span class="w"> </span>jar xf buz.jar META-INF/
<span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>META-INF/MANIFEST.MF
<span class="go">Manifest-Version: 1.0</span>
<span class="go">Created-By: 11.0.12 (Debian)</span>
<span class="hll"><span class="go">Main-Class: Hello</span>
</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="overview-of-java-options">2.1. Overview of Java Options</h3>
<div class="paragraph">
<p>The java command supports a wide range of options in the following categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Standard Options</strong>:</p>
<div class="paragraph">
<p>Options guaranteed to be supported by all implementations of the Java Virtual Machine (JVM).</p>
</div>
<div class="paragraph">
<p>They&#8217;re used for common actions, such as checking the version of the JRE, setting the class path, enabling verbose output, and so on.</p>
</div>
</li>
<li>
<p><strong>Extra Options</strong>:</p>
<div class="paragraph">
<p>General purpose options that are specific to the Java HotSpot Virtual Machine.</p>
</div>
<div class="paragraph">
<p>They aren&#8217;t guaranteed to be supported by all JVM implementations, and are subject to change. These options start with <strong>-X</strong>.</p>
</div>
</li>
<li>
<p><strong>Advanced Options</strong></p>
<div class="paragraph">
<p>The advanced options aren&#8217;t recommended for casual use. These are developer options used for tuning specific areas of the Java HotSpot Virtual Machine operation that often have specific system requirements and may require privileged access to system configuration parameters.</p>
</div>
<div class="paragraph">
<p>These options aren&#8217;t guaranteed to be supported by all JVM implementations and are subject to change. These options start with <strong>-XX</strong>.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>Runtime Options</strong>:</p>
<div class="paragraph">
<p>Control the runtime behavior of the Java HotSpot VM.</p>
</div>
</li>
<li>
<p><strong>JIT Compiler Options</strong>:</p>
<div class="paragraph">
<p>Control the dynamic just-in-time (JIT) compilation performed by the Java HotSpot VM.</p>
</div>
</li>
<li>
<p><strong>Serviceability Options</strong>:</p>
<div class="paragraph">
<p>Enable gathering system information and performing extensive debugging.</p>
</div>
</li>
<li>
<p><strong>Garbage Collection Options</strong>:</p>
<div class="paragraph">
<p>Control how garbage collection (GC) is performed by the Java HotSpot</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Boolean -XX options</strong> are enabled using the plus sign (<code>-XX:+OptionName</code>) and disabled using the minus sign (<code>-XX:-OptionName</code>).</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For <strong>options that require an argument</strong>, the argument may be</p>
</div>
<div class="ulist">
<ul>
<li>
<p>separated from the option name by a <code>space</code>, a <code>colon</code> (:), or an <code>equal sign</code> (=),</p>
</li>
<li>
<p>or the argument may <code>directly follow the option</code> (the exact syntax differs for each option).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you&#8217;re expected to <code>specify the size in bytes</code>, then you can use no suffix, or use the suffix k or K for kilobytes (KB), m or M for megabytes (MB), or g or G for gigabytes (GB).</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>For example, to set the size to 8 GB, you can specify either 8g, 8192m, 8388608k, or 8589934592 as the argument.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>If you are expected to <code>specify the percentage</code>, then use a number from 0 to 1.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>For example, specify 0.25 for 25%.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="standard-options-for-java">2.2. Standard Options for Java</h3>
<div class="paragraph">
<p>These are the most commonly used options supported by all implementations of the JVM.</p>
</div>
<div class="paragraph">
<p>To specify an argument for a long option, you can use either <code>--name=value</code> or <code>--name value</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>--class-path <em>classpath</em>, -classpath <em>classpath</em>, or <strong>-cp</strong> <em>classpath</em></p>
<div class="paragraph">
<p>A semicolon (<code>;</code>) separated list of <strong>directories</strong>, <strong>JAR</strong> archives, and <strong>ZIP</strong> archives to search for class files. Specifying classpath overrides any setting of the <strong>CLASSPATH</strong> environment variable.</p>
</div>
<div class="paragraph">
<p>If the class path option isn&#8217;t used and classpath isn&#8217;t set, then the user class path consists of the current directory (<code>.</code>).</p>
</div>
<div class="paragraph">
<p>As a special convenience, a class path element that contains a base name of an asterisk (<code>*</code>) is considered equivalent to specifying a list of all the files in the directory with the extension <em>.jar</em> or <em>.JAR</em> .</p>
</div>
<div class="paragraph">
<p>A Java program can&#8217;t tell the difference between the two invocations.</p>
</div>
<div class="paragraph">
<p>For example, if the directory <em>mydir</em> contains <em>a.jar</em> and <em>b.JAR</em>, then the class path element <em>mydir/*</em> is expanded to <em>A.jar:b.JAR</em>, except that the order of JAR files is unspecified. All <em>.jar</em> files in the specified directory, even hidden ones, are included in the list.</p>
</div>
<div class="paragraph">
<p>A class path entry consisting of an asterisk (<code>*</code>) expands to a list of all the jar files in the current directory.</p>
</div>
<div class="paragraph">
<p>The CLASSPATH environment variable, where defined, is similarly expanded.</p>
</div>
<div class="paragraph">
<p>Any class path wildcard expansion that occurs before the Java VM is started.</p>
</div>
<div class="paragraph">
<p>Java programs never see wildcards that aren&#8217;t expanded except by querying the environment, such as by calling <strong>System.getenv("CLASSPATH")</strong>.</p>
</div>
</li>
<li>
<p>--list-modules</p>
<div class="paragraph">
<p>Lists the observable modules and then exits.</p>
</div>
</li>
<li>
<p>-d <em>module_name</em> or --describe-module <em>module_name</em></p>
<div class="paragraph">
<p>Describes a specified module and then exits.</p>
</div>
</li>
<li>
<p>--dry-run</p>
<div class="paragraph">
<p>Creates the VM but doesn&#8217;t execute the main method.</p>
</div>
<div class="paragraph">
<p>This <strong>--dry-run</strong> option might be useful for validating the command-line options such as the module system configuration.</p>
</div>
</li>
<li>
<p>--validate-modules</p>
<div class="paragraph">
<p>Validates all modules and exit. This option is helpful for finding conflicts and other errors with modules on the module path.</p>
</div>
</li>
<li>
<p><strong>-D</strong>property=value</p>
<div class="paragraph">
<p>Sets a system property value.</p>
</div>
<div class="paragraph">
<p>The property variable is a string with no spaces that represents the name of the property. The value variable is a string that represents the value of the property.</p>
</div>
<div class="paragraph">
<p>If value is a string with spaces, then enclose it in quotation marks (for example <em>-Dfoo="foo bar"</em>).</p>
</div>
</li>
<li>
<p>-verbose:class</p>
<div class="paragraph">
<p>Displays information about each loaded class.</p>
</div>
</li>
<li>
<p><strong>-verbose:gc</strong></p>
<div class="paragraph">
<p>Displays information about each garbage collection (GC) event.</p>
</div>
</li>
<li>
<p>-verbose:jni</p>
<div class="paragraph">
<p>Displays information about the use of native methods and other Java Native Interface (JNI) activity.</p>
</div>
</li>
<li>
<p>-verbose:module</p>
<div class="paragraph">
<p>Displays information about the modules in use.</p>
</div>
</li>
<li>
<p><strong>-X</strong></p>
<div class="paragraph">
<p>Prints the help on extra options to the error stream.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="extra-options-for-java">2.3. Extra Options for Java</h3>
<div class="paragraph">
<p>The following java options are general purpose options that are specific to the Java HotSpot Virtual Machine.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>-Xlog:option</p>
<div class="paragraph">
<p>Configure or enable logging with the Java Virtual Machine (JVM) unified logging framework.</p>
</div>
</li>
<li>
<p>-Xinternalversion</p>
<div class="paragraph">
<p>Displays more detailed JVM version information than the -version option, and then exits.</p>
</div>
</li>
<li>
<p><strong>-Xmn</strong> <em>size</em></p>
<div class="paragraph">
<p>Sets the initial and maximum size (in bytes) of the heap for the <strong>young generation</strong> (nursery) in the generational collectors.</p>
</div>
<div class="paragraph">
<p>Append the letter k or K to indicate kilobytes, m or M to indicate megabytes, or g or G to indicate gigabytes.</p>
</div>
<div class="paragraph">
<p>The young generation region of the heap is used for new objects.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>GC is performed in this region more often than in other regions.</p>
</li>
<li>
<p>If the size for the young generation is too small, then a lot of minor garbage collections are performed.</p>
</li>
<li>
<p>If the size is too large, then only full garbage collections are performed, which can take a long time to complete.</p>
</li>
<li>
<p>It is recommended that you do not set the size for the young generation for the G1 collector, and keep the size for the young generation greater than 25% and less than 50% of the overall heap size for other collectors.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>The following examples show how to set the initial and maximum size of young generation to 256 MB using various units:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-Xmn256m
-Xmn262144k
-Xmn268435456</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of the <strong>-Xmn</strong> option to set both the initial and maximum size of the heap for the young generation, you can use <strong>-XX:NewSize</strong> to set the initial size and <strong>-XX:MaxNewSize</strong> to set the maximum size.</p>
</div>
</li>
<li>
<p><strong>-Xms</strong> <em>size</em></p>
<div class="paragraph">
<p>Sets the minimum and initial size (in bytes) of the heap.</p>
</div>
<div class="paragraph">
<p>This value must be a multiple of 1024 and greater than 1 MB.</p>
</div>
<div class="paragraph">
<p>Append the letter k or K to indicate kilobytes, m or M to indicate megabytes, g or G to indicate gigabytes.</p>
</div>
<div class="paragraph">
<p>The following examples show how to set the size of allocated memory to 6 MB using various units:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-Xms6291456
-Xms6144k
-Xms6m</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of the <strong>-Xms</strong> option to set both the minimum and initial size of the heap, you can use <strong>-XX:MinHeapSize</strong> to set the minimum size and <strong>-XX:InitialHeapSize</strong> to set the initial size.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t set this option, the initial size is set as the sum of the sizes allocated for the old generation and the young generation.</p>
</div>
<div class="paragraph">
<p>The initial size of the heap for the young generation can be set using the <strong>-Xmn</strong> option or the <strong>-XX:NewSize</strong> option.</p>
</div>
</li>
<li>
<p><strong>-Xmx</strong> <em>size</em></p>
<div class="paragraph">
<p>Specifies the maximum size (in bytes) of the heap.</p>
</div>
<div class="paragraph">
<p>This value must be a multiple of 1024 and greater than 2 MB.</p>
</div>
<div class="paragraph">
<p>Append the letter k or K to indicate kilobytes, m or M to indicate megabytes, or g or G to indicate gigabytes.</p>
</div>
<div class="paragraph">
<p>The default value is chosen at runtime based on system configuration.</p>
</div>
<div class="paragraph">
<p>For server deployments, <strong>-Xms</strong> and <strong>-Xmx</strong> are often set to the same value.</p>
</div>
<div class="paragraph">
<p>The following examples show how to set the maximum allowed size of allocated memory to 80 MB using various units:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-Xmx83886080
-Xmx81920k
-Xmx80m</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>-Xmx</strong> option is equivalent to <strong>-XX:MaxHeapSize</strong>.</p>
</div>
</li>
<li>
<p>-XshowSettings</p>
<div class="paragraph">
<p>Shows all settings and then continues.</p>
</div>
</li>
<li>
<p><strong>-XshowSettings</strong>:<em>category</em></p>
<div class="paragraph">
<p>Shows settings and continues.</p>
</div>
<div class="paragraph">
<p>Possible category arguments for this option include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>all</p>
<div class="paragraph">
<p>Shows all categories of settings. This is the default value.</p>
</div>
</li>
<li>
<p>locale</p>
<div class="paragraph">
<p>Shows settings related to locale.</p>
</div>
</li>
<li>
<p>properties</p>
<div class="paragraph">
<p>Shows settings related to system properties.</p>
</div>
</li>
<li>
<p>vm</p>
<div class="paragraph">
<p>Shows the settings of the JVM.</p>
</div>
</li>
<li>
<p>system</p>
<div class="paragraph">
<p>Linux: Shows host system or container configuration and continues.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>-Xss</strong> <em>size</em></p>
<div class="paragraph">
<p>Sets the thread stack size (in bytes).</p>
</div>
<div class="paragraph">
<p>Append the letter k or K to indicate KB, m or M to indicate MB, or g or G to indicate GB.</p>
</div>
<div class="paragraph">
<p>The default value depends on the platform:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Linux/x64 (64-bit): 1024 KB</p>
</li>
<li>
<p>macOS (64-bit): 1024 KB</p>
</li>
<li>
<p>Windows: The default value depends on virtual memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>The following examples set the thread stack size to 1024 KB in different units:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-Xss1m
-Xss1024k
-Xss1048576</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This option is similar to <strong>-XX:ThreadStackSize</strong>.</p>
</div>
</li>
<li>
<p>--source version</p>
<div class="paragraph">
<p>Sets the version of the source in source-file mode.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="advanced-options-for-java">2.4. Advanced Options for Java</h3>
<div class="paragraph">
<p>These java options can be used to enable other advanced options.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>-XX:+UnlockDiagnosticVMOptions</p>
<div class="paragraph">
<p>Unlocks the options intended for diagnosing the JVM. By default, this option is disabled and diagnostic options aren&#8217;t available.</p>
</div>
<div class="paragraph">
<p>Command line options that are enabled with the use of this option are not supported. If you encounter issues while using any of these options, it is very likely that you will be required to reproduce the problem without using any of these unsupported options before Oracle Support can assist with an investigation. It is also possible that any of these options may be removed or their behavior changed without any warning.</p>
</div>
</li>
<li>
<p>-XX:+UnlockExperimentalVMOptions</p>
<div class="paragraph">
<p>Unlocks the options that provide experimental features in the JVM. By default, this option is disabled and experimental features aren&#8217;t available.</p>
</div>
</li>
<li>
<p><strong>-XX:+PrintFlagsInitial</strong></p>
<div class="paragraph">
<p>Print all the default values of all XX flags.</p>
</div>
</li>
<li>
<p><strong>-XX:+PrintFlagsFinal</strong></p>
<div class="paragraph">
<p>Print all the current values to all XX flags.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="advanced-runtime-options-for-java">2.5. Advanced Runtime Options for Java</h3>
<div class="paragraph">
<p>These java options control the runtime behavior of the Java HotSpot VM.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>-XX:ActiveProcessorCount=<em>x</em></p>
<div class="paragraph">
<p>Overrides the number of CPUs that the VM will use to calculate the size of thread pools it will use for various operations such as Garbage Collection and ForkJoinPool.</p>
</div>
<div class="paragraph">
<p>The VM normally determines the number of available processors from the operating system.</p>
</div>
<div class="paragraph">
<p>This flag can be useful for partitioning CPU resources when running multiple Java processes in docker containers.</p>
</div>
<div class="paragraph">
<p>This flag is honored even if <em>-XX:-UseContainerSupport</em> is not enabled.</p>
</div>
</li>
<li>
<p><strong>-XX:MaxDirectMemorySize</strong>=<em>size</em></p>
<div class="paragraph">
<p>Sets the maximum total size (in bytes) of the java.nio package, direct-buffer allocations.</p>
</div>
<div class="paragraph">
<p>Append the letter k or K to indicate kilobytes, m or M to indicate megabytes, or g or G to indicate gigabytes.</p>
</div>
<div class="paragraph">
<p>By default, the size is set to 0, meaning that the JVM chooses the size for NIO direct-buffer allocations automatically.</p>
</div>
<div class="paragraph">
<p>The following examples illustrate how to set the NIO size to 1024 KB in different units:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-XX:MaxDirectMemorySize=1m
-XX:MaxDirectMemorySize=1024k
-XX:MaxDirectMemorySize=1048576</span></code></pre>
</div>
</div>
</li>
<li>
<p>-XX:NativeMemoryTracking=<em>mode</em></p>
<div class="paragraph">
<p>Specifies the mode for tracking JVM native memory usage.</p>
</div>
<div class="paragraph">
<p>Possible mode arguments for this option include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>off</p>
<div class="paragraph">
<p>Instructs not to track JVM native memory usage.</p>
</div>
<div class="paragraph">
<p>This is the default behavior if you don&#8217;t specify the <em>-XX:NativeMemoryTracking</em> option.</p>
</div>
</li>
<li>
<p>summary</p>
<div class="paragraph">
<p>Tracks memory usage only by JVM subsystems, such as Java heap, class, code, and thread.</p>
</div>
</li>
<li>
<p>detail</p>
<div class="paragraph">
<p>In addition to tracking memory usage by JVM subsystems, track memory usage by individual CallSite, individual virtual memory region and its committed regions.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>-XX:OnError=<em>string</em></p>
<div class="paragraph">
<p>Sets a custom command or a series of semicolon-separated commands to run when an irrecoverable error occurs.</p>
</div>
<div class="paragraph">
<p>If the string contains spaces, then it must be enclosed in quotation marks.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Linux and macOS:</p>
<div class="paragraph">
<p>The following example shows how the <em>-XX:OnError</em> option can be used to run the gcore command to create a core image, and start the gdb debugger to attach to the process in case of an irrecoverable error (the %p designates the current process identifier):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">-XX:OnError="gcore %p;</span>gdb <span class="nt">-p</span> %p<span class="s2">"</span></code></pre>
</div>
</div>
</li>
<li>
<p>Windows:</p>
<div class="paragraph">
<p>The following example shows how the <em>-XX:OnError</em> option can be used to run the userdump.exe utility to obtain a crash dump in case of an irrecoverable error (the %p designates the current process identifier).</p>
</div>
<div class="paragraph">
<p>This example assumes that the path to the userdump.exe utility is specified in the PATH environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-XX:OnError="userdump.exe %p"</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>-XX:OnOutOfMemoryError=<em>string</em></p>
<div class="paragraph">
<p>Sets a custom command or a series of semicolon-separated commands to run when an OutOfMemoryError exception is first thrown.</p>
</div>
<div class="paragraph">
<p>If the string contains spaces, then it must be enclosed in quotation marks.</p>
</div>
<div class="paragraph">
<p>For an example of a command string, see the description of the <strong>-XX:OnError</strong> option.</p>
</div>
</li>
<li>
<p><strong>-XX:+PrintCommandLineFlags</strong></p>
<div class="paragraph">
<p>Enables printing of ergonomically selected JVM flags that appeared on the command line.</p>
</div>
<div class="paragraph">
<p>It can be useful to know the ergonomic values set by the JVM, such as the heap space size and the selected garbage collector.</p>
</div>
<div class="paragraph">
<p>By default, this option is disabled and flags aren&#8217;t printed.</p>
</div>
</li>
<li>
<p>-XX:+PrintNMTStatistics</p>
<div class="paragraph">
<p>Enables printing of collected native memory tracking data at JVM exit when native memory tracking is enabled (see <em>-XX:NativeMemoryTracking</em>).</p>
</div>
<div class="paragraph">
<p>By default, this option is disabled and native memory tracking data isn&#8217;t printed.</p>
</div>
</li>
<li>
<p><strong>-XX:ThreadStackSize</strong>=<em>size</em></p>
<div class="paragraph">
<p>Sets the Java thread stack size (in kilobytes).</p>
</div>
<div class="paragraph">
<p>Use of a scaling suffix, such as k, results in the scaling of the kilobytes value so that <em>-XX:ThreadStackSize=1k</em> sets the Java thread stack size to 1024*1024 bytes or 1 megabyte.</p>
</div>
<div class="paragraph">
<p>The default value depends on the platform:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Linux/x64 (64-bit): 1024 KB</p>
</li>
<li>
<p>macOS (64-bit): 1024 KB</p>
</li>
<li>
<p>Windows: The default value depends on virtual memory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>The following examples show how to set the thread stack size to 1 megabyte in different units:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-XX:ThreadStackSize=1k
-XX:ThreadStackSize=1024</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This option is similar to <strong>-Xss</strong>.</p>
</div>
</li>
<li>
<p><strong>-XX:-UseContainerSupport</strong></p>
<div class="paragraph">
<p>The VM now provides automatic container detection support, which allows the VM to determine the amount of memory and number of processors that are available to a Java process running in docker containers.</p>
</div>
<div class="paragraph">
<p>It uses this information to allocate system resources.</p>
</div>
<div class="paragraph">
<p>This support is only available on Linux x64 platforms.</p>
</div>
<div class="paragraph">
<p>If supported, the default for this flag is true, and container support is enabled by default.</p>
</div>
<div class="paragraph">
<p>It can be disabled with <strong>-XX:-UseContainerSupport</strong>.</p>
</div>
<div class="paragraph">
<p>Unified Logging is available to help to diagnose issues related to this support.</p>
</div>
<div class="paragraph">
<p>Use <strong>-Xlog:os+container=trace</strong> for maximum logging of container information.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="advanced-jit-compiler-options-for-java">2.6. Advanced JIT Compiler Options for java</h3>
<div class="paragraph">
<p>These java options control the dynamic just-in-time (JIT) compilation performed by the Java HotSpot VM.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>-XX:InitialCodeCacheSize=<em>size</em></p>
<div class="paragraph">
<p>Sets the initial code cache size (in bytes).</p>
</div>
<div class="paragraph">
<p>Append the letter k or K to indicate kilobytes, m or M to indicate megabytes, or g or G to indicate gigabytes.</p>
</div>
<div class="paragraph">
<p>The default value depends on the platform.</p>
</div>
<div class="paragraph">
<p>The initial code cache size shouldn&#8217;t be less than the system&#8217;s minimal memory page size.</p>
</div>
<div class="paragraph">
<p>The following example shows how to set the initial code cache size to 32 KB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-XX:InitialCodeCacheSize=32k</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>-XX:ReservedCodeCacheSize</strong>=<em>size</em></p>
<div class="paragraph">
<p>Sets the maximum code cache size (in bytes) for JIT-compiled code.</p>
</div>
<div class="paragraph">
<p>Append the letter k or K to indicate kilobytes, m or M to indicate megabytes, or g or G to indicate gigabytes.</p>
</div>
<div class="paragraph">
<p>The default maximum code cache size is 240 MB; if you disable tiered compilation with the option <strong>-XX:-TieredCompilation</strong>, then the default size is 48 MB.</p>
</div>
<div class="paragraph">
<p>This option has a limit of 2 GB; otherwise, an error is generated.</p>
</div>
<div class="paragraph">
<p>The maximum code cache size shouldn&#8217;t be less than the initial code cache size; see the option <strong>-XX:InitialCodeCacheSize</strong>.</p>
</div>
</li>
<li>
<p><strong>-XX:-TieredCompilation</strong></p>
<div class="paragraph">
<p>Disables the use of tiered compilation.</p>
</div>
<div class="paragraph">
<p>By default, this option is enabled.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="advanced-garbage-collection-options-for-java">2.7. Advanced Garbage Collection Options for Java</h3>
<div class="paragraph">
<p>These java options control how garbage collection (GC) is performed by the Java HotSpot VM.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>-XX:ConcGCThreads=<em>threads</em></p>
<div class="paragraph">
<p>Sets the number of threads used for concurrent GC.</p>
</div>
<div class="paragraph">
<p>Sets threads to approximately 1/4 of the number of parallel garbage collection threads.</p>
</div>
<div class="paragraph">
<p>The default value depends on the number of CPUs available to the JVM.</p>
</div>
<div class="paragraph">
<p>For example, to set the number of threads for concurrent GC to 2, specify the following option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-XX:ConcGCThreads=2</span></code></pre>
</div>
</div>
</li>
<li>
<p>-XX:+DisableExplicitGC</p>
<div class="paragraph">
<p>Enables the option that disables processing of calls to the <strong>System.gc()</strong> method.</p>
</div>
<div class="paragraph">
<p>This option is disabled by default, meaning that calls to System.gc() are processed.</p>
</div>
<div class="paragraph">
<p>If processing of calls to System.gc() is disabled, then the JVM still performs GC when necessary.</p>
</div>
</li>
<li>
<p>-XX:+ExplicitGCInvokesConcurrent</p>
<div class="paragraph">
<p>Enables invoking of concurrent GC by using the <strong>System.gc()</strong> request.</p>
</div>
<div class="paragraph">
<p>This option is disabled by default and can be enabled only with the <strong>-XX:+UseG1GC</strong> option.</p>
</div>
</li>
<li>
<p>-XX:InitialHeapSize=<em>size</em></p>
<div class="paragraph">
<p>Sets the initial size (in bytes) of the memory allocation pool.</p>
</div>
<div class="paragraph">
<p>This value must be either 0, or a multiple of 1024 and greater than 1 MB.</p>
</div>
<div class="paragraph">
<p>Append the letter k or K to indicate kilobytes, m or M to indicate megabytes, or g or G to indicate gigabytes.</p>
</div>
<div class="paragraph">
<p>The default value is selected at run time based on the system configuration.</p>
</div>
<div class="paragraph">
<p>The following examples show how to set the size of allocated memory to 6 MB using various units:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-XX:InitialHeapSize=6291456
-XX:InitialHeapSize=6144k
-XX:InitialHeapSize=6m</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you set this option to 0, then the initial size is set as the sum of the sizes allocated for the old generation and the young generation.</p>
</div>
<div class="paragraph">
<p>The size of the heap for the young generation can be set using the <strong>-XX:NewSize</strong> option.</p>
</div>
</li>
<li>
<p>-XX:InitialRAMPercentage=<em>percent</em></p>
<div class="paragraph">
<p>Sets the initial amount of memory that the JVM will use for the Java heap before applying ergonomics heuristics as a percentage of the maximum amount determined as described in the <strong>-XX:MaxRAM</strong> option.</p>
</div>
<div class="paragraph">
<p>The default value is 1.5625 percent.</p>
</div>
<div class="paragraph">
<p>The following example shows how to set the percentage of the initial amount of memory used for the Java heap:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-XX:InitialRAMPercentage=5</span></code></pre>
</div>
</div>
</li>
<li>
<p>-XX:MaxGCPauseMillis=<em>time</em></p>
<div class="paragraph">
<p>Sets a target for the maximum GC pause time (in milliseconds).</p>
</div>
<div class="paragraph">
<p>This is a soft goal, and the JVM will make its best effort to achieve it.</p>
</div>
<div class="paragraph">
<p>The specified value doesn&#8217;t adapt to your heap size.</p>
</div>
<div class="paragraph">
<p>By default, for G1 the maximum pause time target is 200 milliseconds.</p>
</div>
<div class="paragraph">
<p>The other generational collectors do not use a pause time goal by default.</p>
</div>
<div class="paragraph">
<p>The following example shows how to set the maximum target pause time to 500 ms:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-XX:MaxGCPauseMillis=500</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>-XX:MaxHeapSize</strong>=<em>size</em></p>
<div class="paragraph">
<p>Sets the maximum size (in byes) of the memory allocation pool.</p>
</div>
<div class="paragraph">
<p>This value must be a multiple of 1024 and greater than 2 MB.</p>
</div>
<div class="paragraph">
<p>Append the letter k or K to indicate kilobytes, m or M to indicate megabytes, or g or G to indicate gigabytes.</p>
</div>
<div class="paragraph">
<p>The default value is selected at run time based on the system configuration.</p>
</div>
<div class="paragraph">
<p>For server deployments, the options <strong>-XX:InitialHeapSize</strong> and <strong>-XX:MaxHeapSize</strong> are often set to the same value.</p>
</div>
<div class="paragraph">
<p>The following examples show how to set the maximum allowed size of allocated memory to 80 MB using various units:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-XX:MaxHeapSize=83886080
-XX:MaxHeapSize=81920k
-XX:MaxHeapSize=80m</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>-XX:MaxHeapSize</strong> option is equivalent to <strong>-Xmx</strong>.</p>
</div>
</li>
<li>
<p><strong>-XX:MaxMetaspaceSize</strong>=<em>size</em></p>
<div class="paragraph">
<p>Sets the maximum amount of native memory that can be allocated for class metadata.</p>
</div>
<div class="paragraph">
<p>By default, the size isn&#8217;t limited.</p>
</div>
<div class="paragraph">
<p>The amount of metadata for an application depends on the application itself, other running applications, and the amount of memory available on the system.</p>
</div>
<div class="paragraph">
<p>The following example shows how to set the maximum class metadata size to 256 MB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-XX:MaxMetaspaceSize=256m</span></code></pre>
</div>
</div>
</li>
<li>
<p>-XX:MaxNewSize=<em>size</em></p>
<div class="paragraph">
<p>Sets the maximum size (in bytes) of the heap for the young generation (nursery).</p>
</div>
<div class="paragraph">
<p>The default value is set ergonomically.</p>
</div>
</li>
<li>
<p>-XX:MaxRAM=<em>size</em></p>
<div class="paragraph">
<p>Sets the maximum amount of memory that the JVM may use for the Java heap before applying ergonomics heuristics.</p>
</div>
<div class="paragraph">
<p>The default value is the maximum amount of available memory to the JVM process or 128 GB, whichever is lower.</p>
</div>
<div class="paragraph">
<p>The maximum amount of available memory to the JVM process is the minimum of the machine&#8217;s physical memory and any constraints set by the environment (e.g. container).</p>
</div>
<div class="paragraph">
<p>Specifying this option disables automatic use of compressed oops if the combined result of this and other options influencing the maximum amount of memory is larger than the range of memory addressable by compressed oops.</p>
</div>
<div class="paragraph">
<p>The following example shows how to set the maximum amount of available memory for sizing the Java heap to 2 GB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-XX:MaxRAM=2G</span></code></pre>
</div>
</div>
</li>
<li>
<p>-XX:MaxRAMPercentage=<em>percent</em></p>
<div class="paragraph">
<p>Sets the maximum amount of memory that the JVM may use for the Java heap before applying ergonomics heuristics as a percentage of the maximum amount determined as described in the -XX:MaxRAM option.</p>
</div>
<div class="paragraph">
<p>The default value is 25 percent.</p>
</div>
<div class="paragraph">
<p>Specifying this option disables automatic use of compressed oops if the combined result of this and other options influencing the maximum amount of memory is larger than the range of memory addressable by compressed oops. See <strong>-XX:UseCompressedOops</strong> for further information about compressed oops.</p>
</div>
<div class="paragraph">
<p>The following example shows how to set the percentage of the maximum amount of memory used for the Java heap:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-XX:MaxRAMPercentage=75</span></code></pre>
</div>
</div>
</li>
<li>
<p>-XX:MinRAMPercentage=<em>percent</em></p>
<div class="paragraph">
<p>Sets the <em>maximum</em> amount of memory that the JVM may use for the Java heap before applying ergonomics heuristics as a percentage of the maximum amount determined as described in the <strong>-XX:MaxRAM</strong> option for small heaps.</p>
</div>
<div class="paragraph">
<p>A small heap is a heap of approximately 125 MB.</p>
</div>
<div class="paragraph">
<p>The default value is 50 percent.</p>
</div>
<div class="paragraph">
<p>The following example shows how to set the percentage of the maximum amount of memory used for the Java heap for small heaps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-XX:MinRAMPercentage=75</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>-XX:MetaspaceSize</strong>=<em>size</em></p>
<div class="paragraph">
<p>Sets the size of the allocated class metadata space that triggers a garbage collection the first time it&#8217;s exceeded. This threshold for a garbage collection is increased or decreased depending on the amount of metadata used. The default size depends on the platform.</p>
</div>
</li>
<li>
<p><strong>-XX:MinHeapSize</strong>=<em>size</em></p>
<div class="paragraph">
<p>Sets the minimum size (in bytes) of the memory allocation pool. This value must be either 0, or a multiple of 1024 and greater than 1 MB. Append the letter k or K to indicate kilobytes, m or M to indicate megabytes, or g or G to indicate gigabytes. The default value is selected at run time based on the system configuration.</p>
</div>
<div class="paragraph">
<p>The following examples show how to set the mimimum size of allocated memory to 6 MB using various units:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-XX:MinHeapSize=6291456
-XX:MinHeapSize=6144k
-XX:MinHeapSize=6m</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you set this option to 0, then the minimum size is set to the same value as the initial size.</p>
</div>
</li>
<li>
<p>-XX:NewSize=<em>size</em></p>
<div class="paragraph">
<p>Sets the initial size (in bytes) of the heap for the young generation (nursery).</p>
</div>
<div class="paragraph">
<p>Append the letter k or K to indicate kilobytes, m or M to indicate megabytes, or g or G to indicate gigabytes.</p>
</div>
<div class="paragraph">
<p>The young generation region of the heap is used for new objects.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>GC is performed in this region more often than in other regions.</p>
</li>
<li>
<p>If the size for the young generation is too low, then a large number of minor GCs are performed.</p>
</li>
<li>
<p>If the size is too high, then only full GCs are performed, which can take a long time to complete.</p>
</li>
<li>
<p>It is recommended that you keep the size for the young generation greater than 25% and less than 50% of the overall heap size.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>The following examples show how to set the initial size of the young generation to 256 MB using various units:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">-XX:NewSize=256m
-XX:NewSize=262144k
-XX:NewSize=268435456</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>-XX:NewSize</strong> option is equivalent to <strong>-Xmn</strong>.</p>
</div>
</li>
<li>
<p>-XX:+UseG1GC</p>
<div class="paragraph">
<p>Enables the use of the garbage-first (G1) garbage collector.</p>
</div>
<div class="paragraph">
<p>It&#8217;s a server-style garbage collector, targeted for multiprocessor machines with a large amount of RAM.</p>
</div>
<div class="paragraph">
<p>This option meets GC pause time goals with high probability, while maintaining good throughput.</p>
</div>
<div class="paragraph">
<p>The G1 collector is recommended for applications requiring large heaps (sizes of around 6 GB or larger) with limited GC latency requirements (a stable and predictable pause time below 0.5 seconds).</p>
</div>
<div class="paragraph">
<p>By default, this option is enabled and G1 is used as the default garbage collector.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="removed-java-options">2.8. Removed Java Options</h3>
<div class="paragraph">
<p>These java options have been removed in JDK 17 and using them results in an error of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">Unrecognized VM option option-name</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>-XX:MaxPermSize</strong>=<em>size</em></p>
<div class="paragraph">
<p>Sets the maximum permanent generation space size (in bytes).</p>
</div>
<div class="paragraph">
<p>This option was deprecated in JDK 8 and superseded by the <strong>-XX:MaxMetaspaceSize</strong> option.</p>
</div>
</li>
<li>
<p><strong>-XX:PermSize</strong>=<em>size</em></p>
<div class="paragraph">
<p>Sets the space (in bytes) allocated to the permanent generation that triggers a garbage collection if it&#8217;s exceeded.</p>
</div>
<div class="paragraph">
<p>This option was deprecated in JDK 8 and superseded by the <strong>-XX:MetaspaceSize</strong> option.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="maven">3. Maven</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache <strong>Maven</strong> is a software project management and comprehension tool based on the concept of a project object model (POM).</p>
</div>
<div class="sect2">
<h3 id="the-build-lifecycle">3.1. The Build Lifecycle</h3>
<div class="paragraph">
<p>Maven is based around the central concept of a <strong>build lifecycle</strong>.</p>
</div>
<div class="paragraph">
<p>There are three built-in build lifecycles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>default</strong> lifecycle handles your project deployment,</p>
</li>
<li>
<p>the <strong>clean</strong> lifecycle handles project cleaning,</p>
</li>
<li>
<p>while the <strong>site</strong> lifecycle handles the creation of your project&#8217;s web site.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>A Build Lifecycle is Made Up of Phases</strong></p>
</div>
<div class="paragraph">
<p>Each of these build lifecycles is defined by a different list of <strong>build phases</strong>, wherein a build phase represents a stage in the lifecycle.</p>
</div>
<div class="paragraph">
<p>For example, the default lifecycle comprises of the following phases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>validate</strong></p>
<div class="ulist">
<ul>
<li>
<p>validate the project is correct and all necessary information is available</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>compile</strong></p>
<div class="ulist">
<ul>
<li>
<p>compile the source code of the project</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>test</strong></p>
<div class="ulist">
<ul>
<li>
<p>test the compiled source code using a suitable unit testing framework. These tests should not require the code be packaged or deployed</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>package</strong></p>
<div class="ulist">
<ul>
<li>
<p>take the compiled code and package it in its distributable format, such as a JAR.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>verify</strong></p>
<div class="ulist">
<ul>
<li>
<p>run any checks on results of integration tests to ensure quality criteria are met</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>install</strong></p>
<div class="ulist">
<ul>
<li>
<p>install the package into the local repository, for use as a dependency in other projects locally</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>deploy</strong></p>
<div class="ulist">
<ul>
<li>
<p>done in the build environment, copies the final package to the remote repository for sharing with other developers and projects.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>These lifecycle phases (plus the other lifecycle phases not shown here) are executed sequentially to complete the default lifecycle.</p>
</div>
<div class="paragraph">
<p>Given the lifecycle phases above, this means that when the default lifecycle is used, Maven will first</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>validate the project,</p>
</li>
<li>
<p>then will try to compile the sources,</p>
</li>
<li>
<p>run those against the tests,</p>
</li>
<li>
<p>package the binaries (e.g. jar),</p>
</li>
<li>
<p>run integration tests against that package,</p>
</li>
<li>
<p>verify the integration tests,</p>
</li>
<li>
<p>install the verified package to the local repository,</p>
</li>
<li>
<p>then deploy the installed package to a remote repository.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>A Build Phase is Made Up of Plugin Goals</strong></p>
</div>
<div class="paragraph">
<p>However, even though a build phase is responsible for a specific step in the build lifecycle, the manner in which it carries out those responsibilities may vary. And this is done by declaring the plugin goals bound to those build phases.</p>
</div>
<div class="paragraph">
<p>A <strong>plugin goal</strong> represents a specific task (finer than a build phase) which contributes to the building and managing of a project. It may be bound to zero or more build phases.</p>
</div>
<div class="paragraph">
<p>A goal not bound to any build phase could be executed outside of the build lifecycle by direct invocation.</p>
</div>
<div class="paragraph">
<p>The order of execution depends on the order in which the goal(s) and the build phase(s) are invoked.</p>
</div>
<div class="paragraph">
<p>For example, consider the command below. The <em>clean</em> and <em>package</em> arguments are <em>build phases</em>, while the <em>dependency:copy-dependencies</em> is a goal (of a plugin).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">mvn clean dependency:copy-dependencies package</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If this were to be executed, the <em>clean</em> phase will be executed first (meaning it will run all preceding phases of the clean lifecycle, plus the <em>clean</em> phase itself), and then the <em>dependency:copy-dependencies</em> goal, before finally executing the package phase (and all its preceding build phases of the default lifecycle).</p>
</div>
<div class="paragraph">
<p>Moreover, if a goal is bound to one or more build phases, that goal will be called in all those phases.</p>
</div>
<div class="paragraph">
<p>Furthermore, a build phase can also have zero or more goals bound to it.</p>
</div>
<div class="paragraph">
<p>If a build phase has no goals bound to it, that build phase will not execute.</p>
</div>
<div class="paragraph">
<p>But if it has one or more goals bound to it, it will execute all those goals.</p>
</div>
<div class="paragraph">
<p><strong>Setting Up Your Project to Use the Build Lifecycle</strong></p>
</div>
<div class="paragraph">
<p>The build lifecycle is simple enough to use, but when you are constructing a Maven build for a project, how do you go about assigning tasks to each of those build phases?</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Packaging</strong></p>
<div class="paragraph">
<p>Each packaging contains a list of goals to bind to a particular phase.</p>
</div>
<div class="paragraph">
<p>Some of the valid packaging values are <strong>jar</strong>, <strong>war</strong>, <strong>ear</strong> and <strong>pom</strong>.</p>
</div>
<div class="paragraph">
<p>If no packaging value has been specified, it will default to <strong>jar</strong>.</p>
</div>
</li>
<li>
<p><strong>Plugins</strong></p>
<div class="paragraph">
<p>Plugins are artifacts that provide goals to Maven.</p>
</div>
<div class="paragraph">
<p>A plugin may have one or more goals wherein each goal represents a capability of that plugin.</p>
</div>
<div class="paragraph">
<p>For example, the Compiler plugin has two goals: compile and testCompile.</p>
</div>
<div class="paragraph">
<p>The former compiles the source code of your main code, while the latter compiles the source code of your test code.</p>
</div>
<div class="paragraph">
<p>The goals that are configured will be added to the goals already bound to the lifecycle from the <strong>packaging</strong> selected.</p>
</div>
<div class="paragraph">
<p>If more than one goal is bound to a particular phase, the order used is that those from the packaging are executed first, followed by those configured in the POM.</p>
</div>
<div class="paragraph">
<p>Note that you can use the <strong>&lt;executions&gt;</strong> element to gain more control over the order of particular goals.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="standard-directory-layout">3.2. Standard Directory Layout</h3>
<div class="paragraph">
<p>Having a common directory layout allows users familiar with one Maven project to immediately feel at home in another Maven project. The advantages are analogous to adopting a site-wide look-and-feel.</p>
</div>
<div class="paragraph">
<p>The next section documents the directory layout expected by Maven and the directory layout created by Maven. Try to conform to this structure as much as possible. However, if you can&#8217;t, these settings can be overridden via the project descriptor.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">src/main/java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application/Library sources</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">src/main/resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application/Library resources</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">src/main/filters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource filter files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">src/main/webapp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web application sources</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">src/test/java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test sources</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">src/test/resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test resources</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">src/test/filters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Test resource filter files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">src/it</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integration Tests (primarily for plugins)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">src/assembly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assembly descriptors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">src/site</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Site</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LICENSE.txt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project&#8217;s license</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOTICE.txt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notices and attributions required by libraries that the project depends on</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">README.txt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Project&#8217;s readme</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="configuring-plug-ins">3.3. Configuring Plug-ins</h3>
<div class="paragraph">
<p>In Maven, there are two kinds of plugins, build and reporting:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Build plugins</strong> are executed during the build and configured in the <code>&lt;build/&gt;</code> element.</p>
</li>
<li>
<p><strong>Reporting plugins</strong> are executed during the site generation and configured in the <code>&lt;reporting/&gt;</code> element.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All plugins should have minimal required information: <strong>groupId</strong>, <strong>artifactId</strong> and <strong>version</strong>.</p>
</div>
<div class="paragraph">
<p>Maven plugins (build and reporting) are configured by specifying a <code>&lt;configuration&gt;</code> element where the child elements of the <code>&lt;configuration&gt;</code> element are mapped to fields, or setters, inside your <strong>Mojo</strong>.</p>
</div>
<div class="paragraph">
<p>Remember that a plug-in consists of one or more Mojos where a Mojo maps to a goal.</p>
</div>
<div class="paragraph">
<p>For example, you have a Mojo that performs a query against a particular URL, with a specified timeout and list of options. The Mojo might look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="cm">/**
 * @goal query
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyQueryMojo</span> <span class="kd">extends</span> <span class="nc">AbstractMojo</span> <span class="o">{</span>
    <span class="nd">@Parameter</span><span class="o">(</span><span class="n">property</span> <span class="o">=</span> <span class="s">"query.url"</span><span class="o">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">url</span><span class="o">;</span>

    <span class="nd">@Parameter</span><span class="o">(</span><span class="n">property</span> <span class="o">=</span> <span class="s">"timeout"</span><span class="o">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"50"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">timeout</span><span class="o">;</span>

    <span class="nd">@Parameter</span><span class="o">(</span><span class="n">property</span> <span class="o">=</span> <span class="s">"options"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">options</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">MojoExecutionException</span> <span class="o">{</span>
        <span class="c1">// ...</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To configure the Mojo from your POM with the desired URL, timeout and options you might have something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;project&gt;</span>
  ...
  <span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>maven-myquery-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
          <span class="nt">&lt;url&gt;</span>http://www.foobar.com/query<span class="nt">&lt;/url&gt;</span>
          <span class="nt">&lt;timeout&gt;</span>10<span class="nt">&lt;/timeout&gt;</span>
          <span class="nt">&lt;options&gt;</span>
            <span class="nt">&lt;option&gt;</span>one<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;option&gt;</span>two<span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;option&gt;</span>three<span class="nt">&lt;/option&gt;</span>
          <span class="nt">&lt;/options&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>
    ...
<span class="nt">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The elements in the configuration match the names of the fields in the Mojo.</p>
</div>
<div class="paragraph">
<p>For Mojos that are intended to be executed directly from the CLI, their parameters usually provide a means to be configured via <strong>system properties</strong> instead of a &lt;configuration&gt; section in the POM.</p>
</div>
<div class="paragraph">
<p>The plugin documentation for those parameters will list an expression that denotes the system properties for the configuration.</p>
</div>
<div class="paragraph">
<p>In the Mojo above, the parameter url is associated with the expression <em>${query.url}</em>, meaning its value can be specified by the system property query.url as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh">mvn myquery:query <span class="nt">-Dquery</span>.url<span class="o">=</span>http://maven.apache.org</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Help Goal</strong></p>
</div>
<div class="paragraph">
<p>Most Maven plugins have a help goal that prints a description of the plugin and its parameters and types. For instance, to see help for the <em>javadoc</em> goal, type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh">mvn javadoc:help <span class="nt">-Ddetail</span> <span class="nt">-Dgoal</span><span class="o">=</span>javadoc</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Configuring Parameters</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Mapping Simple Objects</strong></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;myString&gt;</span>a string<span class="nt">&lt;/myString&gt;</span>
  <span class="nt">&lt;myBoolean&gt;</span>true<span class="nt">&lt;/myBoolean&gt;</span>
  <span class="nt">&lt;myInteger&gt;</span>10<span class="nt">&lt;/myInteger&gt;</span>
  <span class="nt">&lt;myDouble&gt;</span>1.0<span class="nt">&lt;/myDouble&gt;</span>
  <span class="nt">&lt;myFile&gt;</span>c:\temp<span class="nt">&lt;/myFile&gt;</span>
  <span class="nt">&lt;myURL&gt;</span>http://maven.apache.org<span class="nt">&lt;/myURL&gt;</span>
<span class="nt">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>Mapping Complex Objects</strong></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;person&gt;</span>
    <span class="nt">&lt;firstName&gt;</span>Jason<span class="nt">&lt;/firstName&gt;</span>
    <span class="nt">&lt;lastName&gt;</span>van Zyl<span class="nt">&lt;/lastName&gt;</span>
  <span class="nt">&lt;/person&gt;</span>
<span class="nt">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;person</span> <span class="na">implementation=</span><span class="s">"com.mycompany.mojo.query.SuperPerson"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;firstName&gt;</span>Jason<span class="nt">&lt;/firstName&gt;</span>
    <span class="nt">&lt;lastName&gt;</span>van Zyl<span class="nt">&lt;/lastName&gt;</span>
  <span class="nt">&lt;/person&gt;</span>
<span class="nt">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>Mapping Collections</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Mapping Lists</strong></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAnimalMojo</span> <span class="kd">extends</span> <span class="nc">AbstractMojo</span> <span class="o">{</span>
    <span class="nd">@Parameter</span><span class="o">(</span><span class="n">property</span> <span class="o">=</span> <span class="s">"animals"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span> <span class="n">animals</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">MojoExecutionException</span> <span class="o">{</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;animals&gt;</span>
    <span class="nt">&lt;animal&gt;</span>cat<span class="nt">&lt;/animal&gt;</span>
    <span class="nt">&lt;animal&gt;</span>dog<span class="nt">&lt;/animal&gt;</span>
    <span class="nt">&lt;animal&gt;</span>aardvark<span class="nt">&lt;/animal&gt;</span>
  <span class="nt">&lt;/animals&gt;</span>
<span class="nt">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>Mapping Properties</strong></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">    <span class="nd">@Parameter</span><span class="o">(</span><span class="n">property</span> <span class="o">=</span> <span class="s">"myProperties"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Properties</span> <span class="n">myProperties</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;myProperties&gt;</span>
    <span class="nt">&lt;property&gt;</span>
      <span class="nt">&lt;name&gt;</span>propertyName1<span class="nt">&lt;/name&gt;</span>
      <span class="nt">&lt;value&gt;</span>propertyValue1<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
      <span class="nt">&lt;name&gt;</span>propertyName2<span class="nt">&lt;/name&gt;</span>
      <span class="nt">&lt;value&gt;</span>propertyValue2<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
  <span class="nt">&lt;/myProperties&gt;</span>
<span class="nt">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring Build Plugins</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Using the <code>&lt;executions&gt;</code> Tag</strong></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;build&gt;</span>
  <span class="nt">&lt;plugins&gt;</span>
    <span class="nt">&lt;plugin&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>maven-myquery-plugin<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;executions&gt;</span>
        <span class="nt">&lt;execution&gt;</span>
          <span class="nt">&lt;id&gt;</span>execution1<span class="nt">&lt;/id&gt;</span>
          <span class="nt">&lt;phase&gt;</span>test<span class="nt">&lt;/phase&gt;</span>
          <span class="nt">&lt;configuration&gt;</span>
            ...
          <span class="nt">&lt;/configuration&gt;</span>
          <span class="nt">&lt;goals&gt;</span>
            <span class="nt">&lt;goal&gt;</span>query<span class="nt">&lt;/goal&gt;</span>
          <span class="nt">&lt;/goals&gt;</span>
        <span class="nt">&lt;/execution&gt;</span>
        <span class="nt">&lt;execution&gt;</span>
          <span class="nt">&lt;id&gt;</span>execution2<span class="nt">&lt;/id&gt;</span>
          <span class="nt">&lt;configuration&gt;</span>
            ...
          <span class="nt">&lt;/configuration&gt;</span>
          <span class="nt">&lt;goals&gt;</span>
            <span class="nt">&lt;goal&gt;</span>query<span class="nt">&lt;/goal&gt;</span>
          <span class="nt">&lt;/goals&gt;</span>
        <span class="nt">&lt;/execution&gt;</span>
      <span class="nt">&lt;/executions&gt;</span>
    <span class="nt">&lt;/plugin&gt;</span>
  <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span></code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>The first execution with id "execution1" binds this configuration to the <strong>test</strong> phase.</p>
</li>
<li>
<p>The second execution does not have a <em>&lt;phase&gt;</em> tag, have a default phase binding.</p>
</li>
<li>
<p>If the goal has a default phase binding then it will execute in that phase.</p>
</li>
<li>
<p>But if the goal is not bound to any lifecycle phase then it simply won&#8217;t be executed during the build lifecycle.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that while execution id&#8217;s have to be unique among all executions of a single plugin within a POM, they don&#8217;t have to be unique across an inheritance hierarchy of POMs.</p>
</div>
<div class="paragraph">
<p>Executions of the same id from different POMs are merged.</p>
</div>
<div class="paragraph">
<p>The same applies to executions that are defined by profiles.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p><strong>Using the <code>&lt;dependencies&gt;</code> Tag</strong></p>
<div class="paragraph">
<p>You could configure the dependencies of the Build plugins, commonly to use a more recent dependency version.</p>
</div>
<div class="paragraph">
<p>For instance, the Maven Antrun Plugin version 1.2 uses Ant version 1.6.5, if you want to use the latest Ant version when running this plugin, you need to add &lt;dependencies&gt; element like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>maven-antrun-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.2<span class="nt">&lt;/version&gt;</span>
    ...
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apache.ant<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>ant<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.7.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.apache.ant<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>ant-launcher<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>1.7.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>Using the <code>&lt;inherited&gt;</code> Tag In Build Plugins</strong></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>maven-antrun-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.2<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;inherited&gt;</span>false<span class="nt">&lt;/inherited&gt;</span>
    ...
<span class="nt">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="maven-help-plugin">3.4. Maven Help Plugin</h3>
<div class="ulist">
<ul>
<li>
<p>The <strong>help:active-profiles</strong> Goal</p>
<div class="paragraph">
<p>The active-profiles goal is used to discover which profiles have been applied to the projects currently being built.</p>
</div>
<div class="paragraph">
<p>For each project in the build session, it will output a list of profiles which have been applied to that project, along with the source of the profile (<strong>POM</strong>, <strong>settings.xml</strong> or <strong>profiles.xml</strong>).</p>
</div>
<div class="paragraph">
<p>You can execute this goal using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="c"># mvn help:active-profiles</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
you could also use the output parameter to redirect output to a file.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The <strong>help:all-profiles</strong> Goal</p>
<div class="paragraph">
<p>The all-profiles goal is used to discover all available profiles under the current project.</p>
</div>
<div class="paragraph">
<p>You can execute this goal using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="c"># mvn help:all-profiles</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
you could also use the output parameter to redirect output to a file.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The <strong>help:describe</strong> Goal</p>
<div class="paragraph">
<p>The describe goal is used to discover information about Maven plugins.</p>
</div>
<div class="paragraph">
<p>Given either a plugin or a groupId, an artifactId and optionally a version, the goal will lookup that plugin and output details about it.</p>
</div>
<div class="paragraph">
<p>If the user also specifies which goal to describe, the describe goal will limit output to the details of that goal, including parameters.</p>
</div>
<div class="paragraph">
<p>You can execute this goal using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="c"># mvn help:describe -DgroupId=org.somewhere -DartifactId=some-plugin -Dversion=0.0.0</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
you could also use the output parameter to redirect output to a file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Refer to Configuring Describe Goal for more information about its configuration.</p>
</div>
</li>
<li>
<p>The <strong>help:effective-pom</strong> Goal</p>
<div class="paragraph">
<p>The effective-pom goal is used to make visible the POM that results from the application of interpolation, inheritance and active profiles.</p>
</div>
<div class="paragraph">
<p>It provides a useful way of removing the guesswork about just what ends up in the POM that Maven uses to build your project.</p>
</div>
<div class="paragraph">
<p>It will iterate over all projects in the current build session, printing the effective POM for each.</p>
</div>
<div class="paragraph">
<p>You can execute this goal using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="c"># mvn help:effective-pom</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
you could also use the output parameter to redirect output to a file.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The <strong>help:effective-settings</strong> Goal</p>
<div class="paragraph">
<p>The effective-settings goal is used to view the settings that Maven actually uses to run the build.</p>
</div>
<div class="paragraph">
<p>These settings are a result of merging the global file with the user&#8217;s file, with the user&#8217;s file taking precedence.</p>
</div>
<div class="paragraph">
<p>You can execute this goal using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="c"># mvn help:effective-settings</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
you could also use the output parameter to redirect output to a file.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The <strong>help:system</strong> Goal</p>
<div class="paragraph">
<p>The system goal is used to view the system information like system properties and environment variables.</p>
</div>
<div class="paragraph">
<p>You can execute this goal using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="c"># mvn help:system</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
you could also use the output parameter to redirect output to a file.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The <strong>help:evaluate</strong> Goal</p>
<div class="paragraph">
<p>You could use this interactive goal to evaluate some Maven expressions. To do it, just call the help:evaluate goal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">#</span><span class="w"> </span>mvn <span class="nb">help</span>:evaluate <span class="nt">-Dartifact</span><span class="o">=</span>org.apache.maven.plugins:maven-help-plugin
<span class="c">...
</span><span class="go">[INFO] [help:evaluate]
</span><span class="gp">[INFO] Enter the Maven expression i.e. $</span><span class="o">{</span>project.groupId<span class="o">}</span> or 0 to <span class="nb">exit</span>?:
<span class="gp">$</span><span class="o">{</span>project.artifactId<span class="o">}</span>
<span class="go">[INFO]
maven-help-plugin
</span><span class="gp">[INFO] Enter the Maven expression i.e. $</span><span class="o">{</span>project.groupId<span class="o">}</span> or 0 to <span class="nb">exit</span>?:
<span class="gp">$</span><span class="o">{</span>project.none<span class="o">}</span>
<span class="go">[INFO]
null object or invalid expression
</span><span class="c">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The artifact parameter refers to ask expressions on the artifact POM. If omitted, the evaluate goal uses the current pom.</p>
</div>
<div class="paragraph">
<p>You could ask for all Maven expressions listed in the Javadoc of the PluginParameterExpressionEvaluator class.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot-maven-plugin">3.5. Spring Boot Maven Plugin</h3>
<div class="ulist">
<ul>
<li>
<p>Create a Spring MVC project with <a href="start.spring.io" class="bare">start.spring.io</a></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>curl <span class="nt">-sS</span> <span class="nt">-o</span> demo.zip <span class="s2">"https://start.spring.io/starter.zip?type=maven-project&amp;language=java&amp;bootVersion=2.5.6&amp;baseDir=demo&amp;groupId=com.example&amp;artifactId=demo&amp;name=demo&amp;description=Demo%20project%20for%20Spring%20Boot&amp;packageName=com.example.demo&amp;packaging=jar&amp;javaVersion=11&amp;dependencies=web,devtools,actuator"</span>
<span class="gp">$</span><span class="w"> </span>unzip demo.zip <span class="o">&amp;&amp;</span> <span class="nb">cd </span>demo</code></pre>
</div>
</div>
</li>
<li>
<p>Display help information on spring-boot-maven-plugin.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn spring-boot:help
<span class="go">
</span><span class="c">...
</span><span class="go">
This plugin has 7 goals:

spring-boot:build-image
  Package an application into a OCI image using a buildpack.

spring-boot:build-info
  Generate a build-info.properties file based on the content of the current
  MavenProject.

spring-boot:help
  Display help information on spring-boot-maven-plugin.
</span><span class="gp">  Call mvn spring-boot:help -Ddetail=true -Dgoal=&lt;goal-name&gt;</span><span class="w"> </span>to display
<span class="go">  parameter details.

spring-boot:repackage
  Repackage existing JAR and WAR archives so that they can be executed from the
  command line using java -jar. With layout=NONE can also be used simply to
  package a JAR with nested dependencies (and no main class, so not executable).

spring-boot:run
  Run an application in place.

spring-boot:start
  Start a spring application. Contrary to the run goal, this does not block and
  allows other goals to operate on the application. This goal is typically used
  in integration test scenario where the application is started before a test
  suite and stopped after.

spring-boot:stop
  Stop an application that has been started by the 'start' goal. Typically
  invoked once a test suite has completed.

</span><span class="c">...</span></code></pre>
</div>
</div>
</li>
<li>
<p>Build and run Spring boot</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn package
<span class="gp">$</span><span class="w"> </span>java <span class="nt">-Dmanagement</span>.endpoints.web.exposure.include<span class="o">=</span>health <span class="nt">-Dserver</span>.port<span class="o">=</span>8088 <span class="nt">-jar</span> target/demo-0.0.1-SNAPSHOT.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Open another command shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>curl <span class="nt">-i</span> localhost:8088/actuator/health
<span class="go">HTTP/1.1 200
Content-Type: application/vnd.spring-boot.actuator.v3+json
Transfer-Encoding: chunked
Date: Mon, 01 Nov 2021 10:52:48 GMT

{"status":"UP"}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Show <code>META-INF/MANIFEST.MF</code> of <em>demo-0.0.1-SNAPSHOT.jar</em></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>jar <span class="nt">-xf</span> target/demo-0.0.1-SNAPSHOT.jar META-INF/MANIFEST.MF

<span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>META-INF/MANIFEST.MF
<span class="go">Manifest-Version: 1.0</span>
<span class="go">Created-By: Maven Jar Plugin 3.2.0</span>
<span class="go">Build-Jdk-Spec: 11</span>
<span class="go">Implementation-Title: demo</span>
<span class="go">Implementation-Version: 0.0.1-SNAPSHOT</span>
<span class="hll"><span class="go">Main-Class: org.springframework.boot.loader.JarLauncher</span>
</span><span class="go">Start-Class: com.example.demo.DemoApplication</span>
<span class="go">Spring-Boot-Version: 2.5.6</span>
<span class="go">Spring-Boot-Classes: BOOT-INF/classes/</span>
<span class="go">Spring-Boot-Lib: BOOT-INF/lib/</span>
<span class="go">Spring-Boot-Classpath-Index: BOOT-INF/classpath.idx</span>
<span class="hll"><span class="go">Spring-Boot-Layers-Index: BOOT-INF/layers.idx</span>
</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java-in-container">4. Java in Container</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The linux <code>free</code> command detects memory info from <code>/proc/meminfo</code> instead of <code>/sys/fs/cgroup/memory/memory.stat</code>, that&#8217;s the container total memory is always the same with the virtual machine host total memory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>free
<span class="go">              total        used        free      shared  buff/cache   available
Mem:        4017728      726892     1148152        1212     2142684     3026308
Swap:             0           0           0

</span><span class="gp">$</span><span class="w"> </span>docker run <span class="nt">--rm</span> openjdk:8 free
<span class="go">               total        used        free      shared  buff/cache   available
Mem:         4017728      814556     1408108        1284     1795064     2943488
Swap:              0           0           0

</span><span class="gp">$</span><span class="w"> </span>docker run <span class="nt">--rm</span> <span class="nt">-m</span> 512m openjdk:11 free
<span class="go">WARNING: Your kernel does not support swap limit capabilities or the cgroup is not mounted. Memory limited without swap.
               total        used        free      shared  buff/cache   available
Mem:         4017728      816368     1383084        1292     1818276     2941724
Swap:              0           0           0

</span><span class="gp">$</span><span class="w"> </span>docker run <span class="nt">--rm</span> <span class="nt">-m</span> 512m openjdk:11 <span class="nb">cat</span> /sys/fs/cgroup/memory/memory.limit_in_bytes
<span class="go">WARNING: Your kernel does not support swap limit capabilities or the cgroup is not mounted. Memory limited without swap.
536870912

</span><span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="k">$((</span><span class="m">536870912</span> <span class="o">/</span> <span class="m">1024</span> <span class="o">/</span> <span class="m">1024</span><span class="k">))</span>m
<span class="go">512m</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We will use the <a href="https://docs.oracle.com/en/java/javase/17/gctuning/parallel-collector1.html">parallel collector</a> to demostrate the java VM container support. Unless the initial and maximum heap sizes are specified on the command line, they&#8217;re calculated based on the amount of memory on the machine. The default maximum heap size is one-fourth of the physical memory while the initial heap size is 1/64th of physical memory. The maximum amount of space allocated to the young generation is one third of the total heap size.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh"><span class="c"># Run Java in virtual machine host</span>
<span class="nv">$ </span>java <span class="nt">-XX</span>:+UseParallelGC <span class="nt">-XshowSettings</span>:vm <span class="nt">-version</span>
VM settings:
<span class="hll">    Max. Heap Size <span class="o">(</span>Estimated<span class="o">)</span>: 873.00M
</span>    Using VM: OpenJDK 64-Bit Server VM

openjdk version <span class="s2">"11.0.12"</span> 2021-07-20
OpenJDK Runtime Environment <span class="o">(</span>build 11.0.12+7-post-Debian-2deb10u1<span class="o">)</span>
OpenJDK 64-Bit Server VM <span class="o">(</span>build 11.0.12+7-post-Debian-2deb10u1, mixed mode, sharing<span class="o">)</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="container-detection-support">4.1. Container detection support</h3>
<div class="paragraph">
<p>The runtime <code>UseContainerSupport</code> option now provides automatic container detection support, which allows the VM to determine the amount of memory and number of processors that are available to a Java process running in docker containers. It uses this information to allocate system resources. This support is only available on Linux x64 platforms. If supported, the default for this flag is true, and container support is enabled by default. It can be disabled with <em>-XX:-UseContainerSupport</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use <code>-XX:-UseContainerSupport</code> to disable container support</p>
<div class="paragraph">
<p>As we can see, the default java VM maximum heap size is always same with the host, and the maximum  heap size <em>873M</em> is about one fourth of the physical memory 4G.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run Java in container without memory limit</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>docker run <span class="nt">--rm</span> openjdk:11 java <span class="nt">-XX</span>:-UseContainerSupport <span class="nt">-XX</span>:+UseParallelGC <span class="nt">-XshowSettings</span>:vm <span class="nt">-version</span>
<span class="go">VM settings:</span>
<span class="hll"><span class="go">    Max. Heap Size (Estimated): 873.00M</span>
</span><span class="go">    Using VM: OpenJDK 64-Bit Server VM</span>

<span class="go">openjdk version "11.0.13" 2021-10-19</span>
<span class="go">OpenJDK Runtime Environment 18.9 (build 11.0.13+8)</span>
<span class="go">OpenJDK 64-Bit Server VM 18.9 (build 11.0.13+8, mixed mode, sharing)</span></code></pre>
</div>
</div>
</li>
<li>
<p>Run Java in container with memory limit</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>docker run <span class="nt">--rm</span> <span class="nt">-m</span> 512m openjdk:11 java <span class="nt">-XX</span>:-UseContainerSupport <span class="nt">-XX</span>:+UseParallelGC <span class="nt">-XshowSettings</span>:vm <span class="nt">-version</span>
<span class="go">WARNING: Your kernel does not support swap limit capabilities or the cgroup is not mounted. Memory limited without swap.</span>
<span class="go">VM settings:</span>
<span class="hll"><span class="go">    Max. Heap Size (Estimated): 873.00M</span>
</span><span class="go">    Using VM: OpenJDK 64-Bit Server VM</span>

<span class="go">openjdk version "11.0.13" 2021-10-19</span>
<span class="go">OpenJDK Runtime Environment 18.9 (build 11.0.13+8)</span>
<span class="go">OpenJDK 64-Bit Server VM 18.9 (build 11.0.13+8, mixed mode, sharing)</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Use <code>-XX:+UseContainerSupport</code> to enable container support</p>
<div class="paragraph">
<p>The default value for this flag <code>-XX:+UseContainerSupport</code> is true, so we can run java without it. Now, the default maximum heap size is <em>114M</em>, which is about one fourth of the memory limit 512m.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run Java in container with memory limit</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>docker run <span class="nt">--rm</span> <span class="nt">-m</span> 512m openjdk:11 java <span class="nt">-XX</span>:+UseParallelGC <span class="nt">-XshowSettings</span>:vm <span class="nt">-version</span>
<span class="go">WARNING: Your kernel does not support swap limit capabilities or the cgroup is not mounted. Memory limited without swap.</span>
<span class="go">VM settings:</span>
<span class="hll"><span class="go">    Max. Heap Size (Estimated): 114.00M</span>
</span><span class="go">    Using VM: OpenJDK 64-Bit Server VM</span>

<span class="go">openjdk version "11.0.13" 2021-10-19</span>
<span class="go">OpenJDK Runtime Environment 18.9 (build 11.0.13+8)</span>
<span class="go">OpenJDK 64-Bit Server VM 18.9 (build 11.0.13+8, mixed mode, sharing)</span></code></pre>
</div>
</div>
</li>
<li>
<p>Use <code>-Xlog:os+container=trace</code> for maximum logging of container information.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>docker run <span class="nt">--rm</span> <span class="nt">-m</span> 512m openjdk:11 java <span class="nt">-Xlog</span>:os+container<span class="o">=</span>trace <span class="nt">-version</span>
<span class="go">WARNING: Your kernel does not support swap limit capabilities or the cgroup is not mounted. Memory limited without swap.</span>
<span class="go">[0.000s][trace][os,container] OSContainer::init: Initializing Container Support</span>
<span class="hll"><span class="go">[0.001s][trace][os,container] Path to /memory.use_hierarchy is /sys/fs/cgroup/memory/memory.use_hierarchy</span>
</span><span class="go">[0.001s][trace][os,container] Use Hierarchy is: 1</span>
<span class="hll"><span class="go">[0.001s][trace][os,container] Path to /memory.limit_in_bytes is /sys/fs/cgroup/memory/memory.limit_in_bytes</span>
</span><span class="go">[0.001s][trace][os,container] Memory Limit is: 536870912</span>
<span class="go">[0.001s][info ][os,container] Memory Limit is: 536870912</span>
<span class="hll"><span class="go">[0.001s][trace][os,container] Path to /cpu.cfs_quota_us is /sys/fs/cgroup/cpu,cpuacct/cpu.cfs_quota_us</span>
</span><span class="go">[0.001s][trace][os,container] CPU Quota is: -1</span>
<span class="hll"><span class="go">[0.001s][trace][os,container] Path to /cpu.cfs_period_us is /sys/fs/cgroup/cpu,cpuacct/cpu.cfs_period_us</span>
</span><span class="go">[0.001s][trace][os,container] CPU Period is: 100000</span>
<span class="hll"><span class="go">[0.001s][trace][os,container] Path to /cpu.shares is /sys/fs/cgroup/cpu,cpuacct/cpu.shares</span>
</span><span class="go">[0.001s][trace][os,container] CPU Shares is: 1024</span>
<span class="go">[0.001s][trace][os,container] OSContainer::active_processor_count: 2</span>
<span class="go">[0.001s][trace][os,container] OSContainer::active_processor_count (cached): 2</span>
<span class="go">[0.003s][trace][os,container] OSContainer::active_processor_count (cached): 2</span>
<span class="go">[0.039s][trace][os,container] Path to /cpu.cfs_quota_us is /sys/fs/cgroup/cpu,cpuacct/cpu.cfs_quota_us</span>
<span class="go">[0.040s][trace][os,container] CPU Quota is: -1</span>
<span class="go">[0.040s][trace][os,container] Path to /cpu.cfs_period_us is /sys/fs/cgroup/cpu,cpuacct/cpu.cfs_period_us</span>
<span class="go">[0.040s][trace][os,container] CPU Period is: 100000</span>
<span class="go">[0.040s][trace][os,container] Path to /cpu.shares is /sys/fs/cgroup/cpu,cpuacct/cpu.shares</span>
<span class="go">[0.041s][trace][os,container] CPU Shares is: 1024</span>
<span class="go">[0.041s][trace][os,container] OSContainer::active_processor_count: 2</span>
<span class="go">[0.063s][trace][os,container] Path to /memory.limit_in_bytes is /sys/fs/cgroup/memory/memory.limit_in_bytes</span>
<span class="go">[0.064s][trace][os,container] Memory Limit is: 536870912</span>
<span class="go">[0.064s][trace][os,container] Path to /memory.usage_in_bytes is /sys/fs/cgroup/memory/memory.usage_in_bytes</span>
<span class="go">[0.065s][trace][os,container] Memory Usage is: 10055680</span>

<span class="c">...</span>

<span class="go">openjdk version "11.0.13" 2021-10-19</span>
<span class="go">OpenJDK Runtime Environment 18.9 (build 11.0.13+8)</span>
<span class="go">OpenJDK 64-Bit Server VM 18.9 (build 11.0.13+8, mixed mode, sharing)</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="spring-boot-in-kubernetes">4.2. Spring Boot in Kubernetes</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create Spring MVC project with start.spring.io</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>curl <span class="nt">-sS</span> <span class="nt">-o</span> demo.zip <span class="s2">"https://start.spring.io/starter.zip?type=maven-project&amp;language=java&amp;bootVersion=2.5.6&amp;baseDir=demo&amp;groupId=com.example&amp;artifactId=demo&amp;name=demo&amp;description=Demo%20project%20for%20Spring%20Boot&amp;packageName=com.example.demo&amp;packaging=jar&amp;javaVersion=11&amp;dependencies=web,devtools,actuator"</span>
<span class="gp">$</span><span class="w"> </span>unzip demo.zip <span class="o">&amp;&amp;</span> <span class="nb">cd </span>demo</code></pre>
</div>
</div>
</li>
<li>
<p>Build OCI image with <code>Dockerfile</code></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="dockerfile"><span class="c"># Dockerfile</span>
<span class="k">FROM</span><span class="s"> openjdk:11</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> ./target/*.jar /app/app.jar</span>
<span class="k">CMD</span><span class="s"> ["java", "-jar", "/app/app.jar"]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn package <span class="o">&amp;&amp;</span> docker build <span class="nb">.</span> <span class="nt">-t</span> demo:0.0.1-SNAPSHOT
<span class="go">[INFO] Scanning for projects...
[INFO]
</span><span class="gp">[INFO] --------------------------&lt; com.example:demo &gt;</span><span class="nt">--------------------------</span>
<span class="go">[INFO] Building demo 0.0.1-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------

. . .

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  14.242 s
[INFO] Finished at: 2021-11-02T17:49:38+08:00
[INFO] ------------------------------------------------------------------------
Sending build context to Docker daemon  19.66MB
Step 1/4 : FROM openjdk:11
</span><span class="gp"> ---&gt;</span><span class="w"> </span>40eccaa4f420
<span class="go">Step 2/4 : WORKDIR /app
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Running <span class="k">in </span>69e8c68d3924
<span class="go">Removing intermediate container 69e8c68d3924
</span><span class="gp"> ---&gt;</span><span class="w"> </span>c2ce7e058438
<span class="go">Step 3/4 : COPY ./target/*.jar /app/app.jar
</span><span class="gp"> ---&gt;</span><span class="w"> </span>8b4c2e01ea26
<span class="go">Step 4/4 : CMD ["java", "-jar", "/app/app.jar"]
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Running <span class="k">in </span>e4cf2f54f7ba
<span class="go">Removing intermediate container e4cf2f54f7ba
</span><span class="gp"> ---&gt;</span><span class="w"> </span>d244def82917
<span class="go">Successfully built d244def82917
Successfully tagged demo:0.0.1-SNAPSHOT</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>docker run <span class="nt">--rm</span> <span class="nt">--name</span> demo <span class="nt">-d</span> <span class="nt">-p</span> 8088:8080 demo:0.0.1-SNAPSHOT
<span class="go">d16f5962bbf5ce64eee87ca37b0e94613dcc22a93069ef95dc678dc82fb4962e

</span><span class="gp">$</span><span class="w"> </span>curl <span class="nt">-i</span> localhost:8088/actuator/health
<span class="go">HTTP/1.1 200
Content-Type: application/vnd.spring-boot.actuator.v3+json
Transfer-Encoding: chunked
Date: Tue, 02 Nov 2021 09:51:11 GMT

{"status":"UP"}

</span><span class="gp">$</span><span class="w"> </span>docker stop  demo0
<span class="go">demo</span></code></pre>
</div>
</div>
</li>
<li>
<p>Build OCI image with multiple layers with layertools</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To make it easier to create optimized Docker images, Spring Boot supports adding a layer index file to the jar. It provides a list of layers and the parts of the jar that should be contained within them. The list of layers in the index is ordered based on the order in which the layers should be added to the Docker/OCI image. Out-of-the-box, the following layers are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dependencies (for regular released dependencies)</p>
</li>
<li>
<p>spring-boot-loader (for everything under org/springframework/boot/loader)</p>
</li>
<li>
<p>snapshot-dependencies (for snapshot dependencies)</p>
</li>
<li>
<p>application (for application classes and resources)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>java <span class="nt">-Djarmode</span><span class="o">=</span>layertools <span class="se">\</span>
<span class="gp">&gt;</span><span class="w"> </span><span class="nt">-jar</span> target/demo-0.0.1-SNAPSHOT.jar extract <span class="nt">--destination</span> layers
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>tree <span class="nt">-L</span> 3 layers/
<span class="go">layers/
 application
  BOOT-INF
   classes
   classpath.idx
   layers.idx
  META-INF
      MANIFEST.MF
      maven
 dependencies
  BOOT-INF
      lib
 snapshot-dependencies
 spring-boot-loader
     org
         springframework</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This layering is designed to separate code based on how likely it is to change between application builds. Library code is less likely to change between builds, so it is placed in its own layers to allow tooling to re-use the layers from cache. Application code is more likely to change between builds so it is isolated in a separate layer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="dockerfile"><span class="c"># Dockerfile.layers</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">openjdk:11</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s">builder</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> target/*.jar app.jar</span>
<span class="k">RUN </span>java <span class="nt">-Djarmode</span><span class="o">=</span>layertools <span class="nt">-jar</span> app.jar extract

<span class="k">FROM</span><span class="s"> openjdk:11</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> --from=builder /app/dependencies/ ./</span>
<span class="k">COPY</span><span class="s"> --from=builder /app/spring-boot-loader/ ./</span>
<span class="k">COPY</span><span class="s"> --from=builder /app/snapshot-dependencies/ ./</span>
<span class="k">COPY</span><span class="s"> --from=builder /app/application/ ./</span>

<span class="k">CMD</span><span class="s"> ["java", "org.springframework.boot.loader.JarLauncher"]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>docker build <span class="nb">.</span> <span class="nt">-t</span> demo:0.0.1-SNAPSHOT <span class="nt">-f</span> Dockerfile.layers
<span class="go">Sending build context to Docker daemon  19.66MB
Step 1/11 : FROM openjdk:11 as builder
</span><span class="gp"> ---&gt;</span><span class="w"> </span>40eccaa4f420
<span class="go">Step 2/11 : WORKDIR /app
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Running <span class="k">in </span>e25debcc04d8
<span class="go">Removing intermediate container e25debcc04d8
</span><span class="gp"> ---&gt;</span><span class="w"> </span>7fbb05a599db
<span class="go">Step 3/11 : COPY target/*.jar app.jar
</span><span class="gp"> ---&gt;</span><span class="w"> </span>2a9ae411237d
<span class="go">Step 4/11 : RUN java -Djarmode=layertools -jar app.jar extract
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Running <span class="k">in </span>a47dcec36428
<span class="go">Removing intermediate container a47dcec36428
</span><span class="gp"> ---&gt;</span><span class="w"> </span>5eb010818830
<span class="go">Step 5/11 : FROM openjdk:11
</span><span class="gp"> ---&gt;</span><span class="w"> </span>40eccaa4f420
<span class="go">Step 6/11 : WORKDIR /app
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Using cache
<span class="gp"> ---&gt;</span><span class="w"> </span>7fbb05a599db
<span class="go">Step 7/11 : COPY --from=builder /app/dependencies/ ./
</span><span class="gp"> ---&gt;</span><span class="w"> </span>829945939519
<span class="go">Step 8/11 : COPY --from=builder /app/spring-boot-loader/ ./
</span><span class="gp"> ---&gt;</span><span class="w"> </span>cc00e84c914e
<span class="go">Step 9/11 : COPY --from=builder /app/snapshot-dependencies/ ./
</span><span class="gp"> ---&gt;</span><span class="w"> </span>d2171d6819c6
<span class="go">Step 10/11 : COPY --from=builder /app/application/ ./
</span><span class="gp"> ---&gt;</span><span class="w"> </span>31ff9f69f026
<span class="go">Step 11/11 : CMD ["java", "org.springframework.boot.loader.JarLauncher"]
</span><span class="gp"> ---&gt;</span><span class="w"> </span>Running <span class="k">in </span>897e8650809c
<span class="go">Removing intermediate container 897e8650809c
</span><span class="gp"> ---&gt;</span><span class="w"> </span>49fa23a24b42
<span class="go">Successfully built 49fa23a24b42
Successfully tagged demo:0.0.1-SNAPSHOT</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>docker run <span class="nt">--rm</span> <span class="nt">--name</span> demo <span class="nt">-d</span> <span class="nt">-p</span> 8088:8080 demo:0.0.1-SNAPSHOT
<span class="go">4c6a0c6e90d0d74632a7a76e028ae1b85d0ab693903b046dfe535615f0908b43

</span><span class="gp">$</span><span class="w"> </span>curl <span class="nt">-i</span> localhost:8088/actuator/health
<span class="go">HTTP/1.1 200
Content-Type: application/vnd.spring-boot.actuator.v3+json
Transfer-Encoding: chunked
Date: Tue, 02 Nov 2021 10:03:57 GMT

{"status":"UP"}

</span><span class="gp">$</span><span class="w"> </span>docker stop demo
<span class="go">demo</span></code></pre>
</div>
</div>
</li>
<li>
<p>Build OCI image with <code>mvn spring-boot:build-image</code></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn spring-boot:build-image
<span class="go">[INFO] Scanning for projects...</span>
<span class="go">[INFO]</span>
<span class="gp">[INFO] --------------------------&lt; com.example:demo &gt;</span><span class="nt">--------------------------</span>
<span class="go">[INFO] Building demo 0.0.1-SNAPSHOT</span>
<span class="go">[INFO] --------------------------------[ jar ]---------------------------------</span>

<span class="c">...</span>

<span class="go">[INFO]     [creator]     Paketo BellSoft Liberica Buildpack 8.9.0</span>
<span class="go">[INFO]     [creator]       https://github.com/paketo-buildpacks/bellsoft-liberica</span>
<span class="go">[INFO]     [creator]       Build Configuration:</span>
<span class="gp">[INFO]     [creator]         $</span>BP_JVM_TYPE                 JRE             the JVM <span class="nb">type</span> - JDK or JRE
<span class="gp">[INFO]     [creator]         $</span>BP_JVM_VERSION              11.<span class="k">*</span>            the Java version
<span class="go">[INFO]     [creator]       Launch Configuration:</span>
<span class="gp">[INFO]     [creator]         $</span>BPL_DEBUG_ENABLED           <span class="nb">false           </span>enables Java remote debugging support
<span class="gp">[INFO]     [creator]         $</span>BPL_DEBUG_PORT              8000            configure the remote debugging port
<span class="gp">[INFO]     [creator]         $</span>BPL_DEBUG_SUSPEND           <span class="nb">false           </span>configure whether to <span class="nb">suspend </span>execution <span class="k">until </span>a debugger has attached
<span class="gp">[INFO]     [creator]         $</span>BPL_HEAP_DUMP_PATH                          write heap dumps on error to this path
<span class="gp">[INFO]     [creator]         $</span>BPL_JAVA_NMT_ENABLED        <span class="nb">true            </span>enables Java Native Memory Tracking <span class="o">(</span>NMT<span class="o">)</span>
<span class="gp">[INFO]     [creator]         $</span>BPL_JAVA_NMT_LEVEL          summary         configure level of NMT, summary or detail
<span class="gp">[INFO]     [creator]         $</span>BPL_JFR_ARGS                                configure custom Java Flight Recording <span class="o">(</span>JFR<span class="o">)</span> arguments
<span class="gp">[INFO]     [creator]         $</span>BPL_JFR_ENABLED             <span class="nb">false           </span>enables Java Flight Recording <span class="o">(</span>JFR<span class="o">)</span>
<span class="gp">[INFO]     [creator]         $</span>BPL_JMX_ENABLED             <span class="nb">false           </span>enables Java Management Extensions <span class="o">(</span>JMX<span class="o">)</span>
<span class="gp">[INFO]     [creator]         $</span>BPL_JMX_PORT                5000            configure the JMX port
<span class="gp">[INFO]     [creator]         $</span>BPL_JVM_HEAD_ROOM           0               the headroom <span class="k">in </span>memory calculation
<span class="gp">[INFO]     [creator]         $</span>BPL_JVM_LOADED_CLASS_COUNT  35% of classes  the number of loaded classes <span class="k">in </span>memory calculation
<span class="gp">[INFO]     [creator]         $</span>BPL_JVM_THREAD_COUNT        250             the number of threads <span class="k">in </span>memory calculation
<span class="gp">[INFO]     [creator]         $</span>JAVA_TOOL_OPTIONS                           the JVM launch flags

<span class="c">...</span>

<span class="go">[INFO]     [creator]     Saving docker.io/library/demo:0.0.1-SNAPSHOT...</span>
<span class="go">[INFO]     [creator]     *** Images (702b824ba18f):</span>
<span class="go">[INFO]     [creator]           docker.io/library/demo:0.0.1-SNAPSHOT</span>
<span class="go">[INFO]</span>
<span class="hll"><span class="go">[INFO] Successfully built image 'docker.io/library/demo:0.0.1-SNAPSHOT'</span>
</span><span class="go">[INFO]</span>
<span class="go">[INFO] ------------------------------------------------------------------------</span>
<span class="go">[INFO] BUILD SUCCESS</span>
<span class="go">[INFO] ------------------------------------------------------------------------</span>
<span class="go">[INFO] Total time:  15.435 s</span>
<span class="go">[INFO] Finished at: 2021-11-02T14:35:32+08:00</span>
<span class="go">[INFO] ------------------------------------------------------------------------</span></code></pre>
</div>
</div>
</li>
<li>
<p>Deploy demo.app into Kubernetes</p>
<div class="ulist">
<ul>
<li>
<p>unable to calculate memory configuration</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># demo.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">demo</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">demo</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">demo</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">demo</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">demo</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">demo:0.0.1-SNAPSHOT</span>
          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">requests</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="s">100m</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">128Mi</span>
            <span class="na">limits</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="s">250m</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">256Mi</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>kubectl apply <span class="nt">-f</span> demo.yaml
<span class="go">deployment.apps/demo created</span>

<span class="gp">$</span><span class="w"> </span>kubectl get po demo-f74fb85d9-gh28w
<span class="go">NAME                   READY   STATUS   RESTARTS      AGE</span>
<span class="go">demo-f74fb85d9-gh28w   0/1     Error    3 (34s ago)   52s</span>

<span class="gp">$</span><span class="w"> </span>kubectl logs demo-f74fb85d9-gh28w
<span class="go">Setting Active Processor Count to 2</span>
<span class="go">unable to calculate memory configuration</span>
<span class="hll"><span class="go">fixed memory regions require 597169K which is greater than 256M available for allocation: -XX:MaxDirectMemorySize=10M, -XX:MaxMetaspaceSize=85169K, -XX:ReservedCodeCacheSize=240M, -Xss1M * 250 threads</span>
</span><span class="go">ERROR: failed to launch: exec.d: failed to execute exec.d file at path '/layers/paketo-buildpacks_bellsoft-liberica/helper/exec.d/memory-calculator': exit status 1</span></code></pre>
</div>
</div>
</li>
<li>
<p>Java VM  Garbage Collection Tuning</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yml"><span class="c1"># demo.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">demo</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">demo</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">demo</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">demo</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">demo</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">demo:0.0.1-SNAPSHOT</span>
<span class="hll">          <span class="na">env</span><span class="pi">:</span>
</span><span class="hll">            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">JAVA_TOOL_OPTIONS</span>
</span><span class="hll">              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">-XX:MaxDirectMemorySize=8M</span><span class="nv"> </span><span class="s">-XX:MaxMetaspaceSize=64M</span><span class="nv"> </span><span class="s">-XX:ReservedCodeCacheSize=16M</span><span class="nv"> </span><span class="s">-Xss512K"</span>
</span>          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">requests</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="s">100m</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">128Mi</span>
            <span class="na">limits</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="s">250m</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">256Mi</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>kubectl get po <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>demo
<span class="go">NAME                    READY   STATUS    RESTARTS   AGE
demo-7b848bcfd6-82lms   1/1     Running   0          25s

</span><span class="gp">$</span><span class="w"> </span>kubectl logs <span class="nt">-f</span> demo-7b848bcfd6-82lms
<span class="go">Setting Active Processor Count to 2
Calculated JVM Memory Configuration: -Xmx43M (Total Memory: 256M, Thread Count: 250, Loaded Class Count: 12623, Headroom: 0%)
Enabling Java Native Memory Tracking
Adding 128 container CA certificates to JVM truststore
Spring Cloud Bindings Enabled
Picked up JAVA_TOOL_OPTIONS: -XX:MaxDirectMemorySize=8M -XX:MaxMetaspaceSize=64M -XX:ReservedCodeCacheSize=16M -Xss512K -Djava.security.properties=/layers/paketo-buildpacks_bellsoft-liberica/java-security-properties/java-security.properties -XX:+ExitOnOutOfMemoryError -XX:ActiveProcessorCount=2 -Xmx43M -XX:+UnlockDiagnosticVMOptions -XX:NativeMemoryTracking=summary -XX:+PrintNMTStatistics -Dorg.springframework.cloud.bindings.boot.enable=true

</span><span class="c">...
</span><span class="go">
2021-11-02 07:34:06.238  INFO 1 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
2021-11-02 07:34:06.432  INFO 1 --- [           main] com.example.demo.DemoApplication         : Started DemoApplication in 28.591 seconds (JVM running for 32.397)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>kubectl expose deployment demo <span class="nt">--port</span> 8080 <span class="nt">--type</span> NodePort
<span class="go">service/demo exposed

</span><span class="gp">$</span><span class="w"> </span>kubectl get svc <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>demo
<span class="go">NAME   TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
</span><span class="gp">demo   NodePort   10.99.172.195   &lt;none&gt;</span><span class="w">        </span>8080:30227/TCP   6s
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>curl <span class="nt">-i</span> localhost:30227
<span class="go">HTTP/1.1 404
Vary: Origin
Vary: Access-Control-Request-Method
Vary: Access-Control-Request-Headers
Content-Type: application/json
Transfer-Encoding: chunked
Date: Tue, 02 Nov 2021 07:42:29 GMT

{"timestamp":"2021-11-02T07:42:29.133+00:00","status":404,"error":"Not Found","path":"/"}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Liveness and Readiness Probes with Spring Boot</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># demo.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">demo</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">demo</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">demo</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">demo</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">demo</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">demo:0.0.1-SNAPSHOT</span>
          <span class="na">env</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">JAVA_TOOL_OPTIONS</span>
              <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">-XX:MaxDirectMemorySize=8M</span><span class="nv"> </span><span class="s">-XX:MaxMetaspaceSize=64M</span><span class="nv"> </span><span class="s">-XX:ReservedCodeCacheSize=16M</span><span class="nv"> </span><span class="s">-Xss512K"</span>
<span class="hll">          <span class="na">args</span><span class="pi">:</span>
</span><span class="hll">            <span class="pi">-</span> <span class="s">Dmanagement.endpoint.health.group.health.include=readiness,liveness</span>
</span><span class="hll">            <span class="pi">-</span> <span class="s">Dmanagement.endpoints.web.exposure.include=health</span>
</span><span class="hll">          <span class="na">livenessProbe</span><span class="pi">:</span>
</span><span class="hll">            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">60</span>
</span><span class="hll">            <span class="na">httpGet</span><span class="pi">:</span>
</span><span class="hll">              <span class="na">path</span><span class="pi">:</span> <span class="s">/actuator/health/liveness</span>
</span><span class="hll">              <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
</span><span class="hll">          <span class="na">readinessProbe</span><span class="pi">:</span>
</span><span class="hll">            <span class="na">initialDelaySeconds</span><span class="pi">:</span> <span class="m">60</span>
</span><span class="hll">            <span class="na">httpGet</span><span class="pi">:</span>
</span><span class="hll">              <span class="na">path</span><span class="pi">:</span> <span class="s">/actuator/health/readiness</span>
</span><span class="hll">              <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
</span>          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">requests</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="s">100m</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">128Mi</span>
            <span class="na">limits</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="s">250m</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">256Mi</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>kubectl get po <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>demo
<span class="go">NAME                    READY   STATUS    RESTARTS   AGE
demo-5f9cd9c556-mwkrx   1/1     Running   0          110s

</span><span class="gp">$</span><span class="w"> </span>curl <span class="nt">-i</span> localhost:30227/actuator/health
<span class="go">HTTP/1.1 200
Content-Type: application/vnd.spring-boot.actuator.v3+json
Transfer-Encoding: chunked
Date: Tue, 02 Nov 2021 07:48:07 GMT

{"status":"UP","groups":["liveness","readiness"]}</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references">5. References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.oracle.com/en/java/javase/17/docs/specs/man/index.html" class="bare">https://docs.oracle.com/en/java/javase/17/docs/specs/man/index.html</a></p>
</li>
<li>
<p><a href="https://docs.oracle.com/en/java/javase/17/gctuning/parallel-collector1.html" class="bare">https://docs.oracle.com/en/java/javase/17/gctuning/parallel-collector1.html</a></p>
</li>
<li>
<p><a href="https://maven.apache.org/index.html" class="bare">https://maven.apache.org/index.html</a></p>
</li>
<li>
<p><a href="https://maven.apache.org/plugins/index.html" class="bare">https://maven.apache.org/plugins/index.html</a></p>
</li>
<li>
<p><a href="https://maven.apache.org/pom.html" class="bare">https://maven.apache.org/pom.html</a></p>
</li>
<li>
<p><a href="https://maven.apache.org/settings.html" class="bare">https://maven.apache.org/settings.html</a></p>
</li>
<li>
<p><a href="https://maven.apache.org/plugins/maven-help-plugin/usage.html" class="bare">https://maven.apache.org/plugins/maven-help-plugin/usage.html</a></p>
</li>
<li>
<p><a href="https://maven.apache.org/plugins/maven-dependency-plugin/usage.html" class="bare">https://maven.apache.org/plugins/maven-dependency-plugin/usage.html</a></p>
</li>
<li>
<p><a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html" class="bare">https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/2.5.x/reference/htmlsingle/#features.container-images.layering" class="bare">https://docs.spring.io/spring-boot/docs/2.5.x/reference/htmlsingle/#features.container-images.layering</a></p>
</li>
</ul>
</div>
</div>
</div>
  </div>

  <ul class="post-navigation">
    <li>
      
      <a href="/2021/10/28/forwarded-http-extension-ingress-nginx-spring/">&laquo; Forwarded Headers and Kubernetes Ingress Nginx</a>
      
    </li>
    <li>
      
      <a href="/2021/11/11/kubernetes-authn-authz/">kubernetes Users and Role-Based Access Control &raquo;</a>
      
    </li>
  </ul>
</article>

      </div>
    </div>

    <footer class="site-footer">
  <div class="license">
    <span>Article licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></span>
  </div>
  
  <details open>
    <summary>Extral Links</summary>
    <div>
      
      <a href="https://jekyllrb.com/">Jekyll</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://shopify.github.io/">Liquid</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://docs.asciidoctor.org/">Asciidoctor</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://github.com/qqbuby/">GitHub</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="/feed.xml">RSS</a>
      
      
    </div>
  </details>
  
</footer>


<!-- https://github.com/bryanbraun/anchorjs -->
<script src="/js/anchor.min.js"></script>
<script>
  anchors.add();
  anchors.remove(".site-title");
</script>




  </body>

</html>
