<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bing WebMaster -->
  <meta name="msvalidate.01" content="AB2FFF876C37F59D9121882CC8395DE5" />

  <title>0 - Kubernetes Overview</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://blog.codefarm.me/2019/02/21/kubernetes-crash-course-0/">
  <link rel="alternate" type="application/rss+xml" title="CODE FARM" href="https://blog.codefarm.me/feed.xml">

  <!-- https://cdn.jsdelivr.net/gh/lurongkai/anti-baidu/js/anti-baidu-latest.min.js -->
<script type="text/javascript" src="/js/anti-baidu.min.js" charset="UTF-8"></script>

  
<!-- Google Analytics Website tracking -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83971182-1', 'auto');
  ga('send', 'pageview');

</script>


  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SN88FJ18E5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SN88FJ18E5');
</script>



</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <h2 class="site-title">
      <a class="site-title" href="/">CODE FARM</a>
    </h2>

     <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
        <div class="trigger">
            <ul>
                <li><a href="/">home</a>
                <li><a href="/category">category</a>
                <li><a href="/tag">tag</a>
                <li><a href="/archive">archive</a>
                <li><a href="/about">about</a>
                <li><a href="https://resume.github.io/?qqbuby" target="_blank">R&eacute;sum&eacute;</a>
            </ul>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">0 - Kubernetes Overview</h1>
    
    
    <p class="post-meta"><time datetime="2019-02-21T17:55:05+08:00" itemprop="datePublished">Feb 21, 2019</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <ul id="markdown-toc">
  <li><a href="#what-is-kubernetes" id="markdown-toc-what-is-kubernetes">What is Kubernetes?</a></li>
  <li><a href="#kubernetes-vs-docker-swarm-vs-apache-mesos" id="markdown-toc-kubernetes-vs-docker-swarm-vs-apache-mesos">Kubernetes vs Docker Swarm vs Apache Mesos</a></li>
  <li><a href="#cloud-native-computing-foundation" id="markdown-toc-cloud-native-computing-foundation">CLOUD NATIVE <small><small>COMPUTING FOUNDATION</small></small></a></li>
  <li><a href="#setup-kubernetes-cluster" id="markdown-toc-setup-kubernetes-cluster">Setup Kubernetes Cluster</a>    <ul>
      <li><a href="#set-dockerservice-behind-http-proxy" id="markdown-toc-set-dockerservice-behind-http-proxy">Set docker.service behind HTTP proxy</a></li>
      <li><a href="#set-http-proxy-for-aptyum" id="markdown-toc-set-http-proxy-for-aptyum">Set HTTP Proxy for APT/YUM</a></li>
      <li><a href="#start-minikube-behind-a-http-proxy" id="markdown-toc-start-minikube-behind-a-http-proxy">Start minikube behind a HTTP Proxy</a></li>
    </ul>
  </li>
  <li><a href="#learn-kubernetes-basics" id="markdown-toc-learn-kubernetes-basics">Learn Kubernetes Basics</a>    <ul>
      <li><a href="#kubectl" id="markdown-toc-kubectl">Kubectl</a></li>
      <li><a href="#using-kubectl-to-create-a-deployment" id="markdown-toc-using-kubectl-to-create-a-deployment">Using kubectl to Create a Deployment</a></li>
      <li><a href="#viewing-pods-and-nodes" id="markdown-toc-viewing-pods-and-nodes">Viewing Pods and Nodes</a></li>
      <li><a href="#pods-overview" id="markdown-toc-pods-overview">Pods overview</a></li>
      <li><a href="#node-overview" id="markdown-toc-node-overview">Node overview</a></li>
      <li><a href="#using-a-service-to-expose-your-app" id="markdown-toc-using-a-service-to-expose-your-app">Using a Service to Expose Your App</a>        <ul>
          <li><a href="#services-and-labels" id="markdown-toc-services-and-labels">Services and Labels</a></li>
          <li><a href="#expose-your-app-publicly" id="markdown-toc-expose-your-app-publicly">Expose Your App Publicly</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#running-multiple-instances-of-your-app" id="markdown-toc-running-multiple-instances-of-your-app">Running Multiple Instances of Your App</a>    <ul>
      <li><a href="#scale-your-app" id="markdown-toc-scale-your-app">Scale Your App</a></li>
    </ul>
  </li>
  <li><a href="#performing-a-rolling-update" id="markdown-toc-performing-a-rolling-update">Performing a Rolling Update</a>    <ul>
      <li><a href="#update-your-app" id="markdown-toc-update-your-app">Update Your App</a></li>
    </ul>
  </li>
  <li><a href="#quit-or-not-quit-" id="markdown-toc-quit-or-not-quit-">Quit or not quit ?</a></li>
</ul>

<style>
img {
 width: 55%;
}
</style>

<hr />

<h3 id="what-is-kubernetes">What is Kubernetes?</h3>

<ul>
  <li>
    <p>Kubernetes is a production-grade, open-source platform that orchestrates the placement (scheduling) and execution of application containers within and across computer clusters.</p>
  </li>
  <li>
    <p>Kubernetes provides a container-centric management environment. It orchestrates computing, networking, and storage infrastructure on behalf of user workloads.</p>
  </li>
  <li>
    <p><a href="https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/">https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/</a></p>
  </li>
</ul>

<h3 id="kubernetes-vs-docker-swarm-vs-apache-mesos">Kubernetes vs Docker Swarm vs Apache Mesos</h3>

<p><img src="/assets/kubernetes/k8s-swarm-mesos.png" alt="Kubernetes vs Docker Swarm vs Apache Mesos" /></p>

<ul>
  <li><a href="https://codefresh.io/kubernetes-tutorial/kubernetes-vs-docker-swarm-vs-apache-mesos/">https://codefresh.io/kubernetes-tutorial/kubernetes-vs-docker-swarm-vs-apache-mesos/</a></li>
</ul>

<h3 id="cloud-native-computing-foundation">CLOUD NATIVE <small><small>COMPUTING FOUNDATION</small></small></h3>

<p><img src="/assets/kubernetes/cncf.png" alt="CLOUD NATIVE COMPUTING FOUNDATION" /></p>

<ul>
  <li>CNCF is an open source software foundation dedicated to making cloud native computing universal and sustainable.</li>
  <li>Cloud native computing uses an open source software stack to deploy applications as microservices, packaging each part into its own container, and dynamically orchestrating those containers to optimize resource utilization.</li>
  <li>Cloud native technologies enable software developers to build great products faster.</li>
  <li>https://www.cncf.io/</li>
</ul>

<h3 id="setup-kubernetes-cluster">Setup Kubernetes Cluster</h3>

<p><img src="/assets/kubernetes/gfw.png" alt="GFW" /></p>

<ul>
  <li>Minikube &amp; Kubeadm</li>
  <li>
    <p>AKS &amp; EKS &amp; ACK &amp; TKE</p>
  </li>
  <li>
    <p><a href="https://kubernetes.io/docs/setup/">https://kubernetes.io/docs/setup/</a></p>
  </li>
  <li>
    <p><a href="https://kubernetes.io/docs/setup/minikube/">https://kubernetes.io/docs/setup/minikube/</a></p>
  </li>
  <li>
    <p><a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/">https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/</a></p>
  </li>
  <li>
    <p><a href="https://codefarm.me/2018/12/27/intall-minikube-with-kubeadm-on-debian/">https://codefarm.me/2018/12/27/intall-minikube-with-kubeadm-on-debian/</a></p>
  </li>
  <li><a href="https://codefarm.me/2019/01/28/bootstrapping-kubernetes-clusters-with-kubeadm/">https://codefarm.me/2019/01/28/bootstrapping-kubernetes-clusters-with-kubeadm/</a></li>
</ul>

<h4 id="set-dockerservice-behind-http-proxy">Set docker.service behind HTTP proxy</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1. Edit the docker.service configuration with systemctl</span>
<span class="nv">$ </span><span class="nb">sudo </span>systemctl edit docker.service
<span class="c"># 2. Add the following text in the editor (Please update the PROXY_HOST and PROXY_PORT !!!)</span>
<span class="c">#   [Service]</span>
<span class="c">#   Environment="HTTP_PROXY=http://PROXY_HOST:PROXY_PORT/" "NO_PROXY=registry.docker-cn.com,registry-mirror-cache-cn.oss-cn-shanghai.aliyuncs.com,repository.gridsum.com,index.docker.io,registry.hub.docker.com,registry-1.docker.io,auth.docker.io,production.cloudflare.docker.com" "HTTPS_PROXY=http://PROXY_HOST:PROXY_PORT/"</span>
<span class="c"># 3. Exit the editor. You can also run the following command to print the docker.service.d/override.conf</span>
<span class="nv">$ </span><span class="nb">cat</span> /etc/systemd/system/docker.service.d/override.conf 
<span class="o">[</span>Service]
<span class="nv">Environment</span><span class="o">=</span><span class="s2">"HTTP_PROXY=http://PROXY_HOST:PROXY_PORT/"</span> <span class="s2">"NO_PROXY=registry.docker-cn.com,registry-mirror-cache-cn.oss-cn-shanghai.aliyuncs.com,repository.gridsum.com,index.docker.io,registry.hub.docker.com,registry-1.docker.io,auth.docker.io,production.cloudflare.docker.com"</span> <span class="s2">"HTTPS_PROXY=http://PROXY_HOST:PROXY_PORT/"</span>
<span class="c"># 4. Reload systemd manager configuration</span>
<span class="nv">$ </span><span class="nb">sudo </span>systemctl daemon-reload
<span class="c"># 5. Restart the docker.service</span>
<span class="nv">$ </span><span class="nb">sudo </span>systemctl restart docker.service
</code></pre></div></div>

<h4 id="set-http-proxy-for-aptyum">Set HTTP Proxy for APT/YUM</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Set HTTP proxy for APT:</span>
<span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> &gt; /etc/apt/apt.conf.d/httproxy 
&gt; Acquire::http::Proxy "http://PROXY_HOST:PORT";
&gt; EOF

# Set HTTP proxy for YUM:
</span><span class="nv">$ </span><span class="sh">echo 'proxy=http://PROXY_HOST:PORT' &gt;&gt; /etc/yum.conf
</span></code></pre></div></div>

<h4 id="start-minikube-behind-a-http-proxy">Start minikube behind a HTTP Proxy</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>minikube start <span class="se">\</span>
     <span class="nt">--docker-env</span> <span class="nv">HTTP_PROXY</span><span class="o">=</span>http://PROXY_HOST:PORT/ <span class="se">\</span>
     <span class="nt">--docker-env</span> <span class="nv">HTTPS_PROXY</span><span class="o">=</span>http://PROXY_HOST:PORT/ <span class="se">\</span>
     <span class="nt">--docker-env</span> <span class="nv">NO_PROXY</span><span class="o">=</span>index.docker.io,<span class="se">\</span>
 registry.hub.docker.com,<span class="se">\</span>
 registry-1.docker.io,<span class="se">\</span>
 registry.docker-cn.com,<span class="se">\</span>
 registry-mirror-cache-cn.oss-cn-shanghai.aliyuncs.com,<span class="se">\</span>
 192.168.99.100<span class="se">\</span>
     <span class="nt">--registry-mirror</span> https://registry.docker-cn.com
</code></pre></div></div>

<ul>
  <li><a href="https://codefarm.me/2018/08/09/http-proxy-docker-minikube/">https://codefarm.me/2018/08/09/http-proxy-docker-minikube/</a></li>
</ul>

<h3 id="learn-kubernetes-basics">Learn Kubernetes Basics</h3>

<ul>
  <li>Deploy an App</li>
  <li>Explore Your App</li>
  <li>Expose Your App Publicly</li>
  <li>Scale Your App</li>
  <li>
    <p>Update Your App</p>
  </li>
  <li><a href="https://kubernetes.io/docs/tutorials/kubernetes-basics/">https://kubernetes.io/docs/tutorials/kubernetes-basics/</a></li>
</ul>

<h4 id="kubectl">Kubectl</h4>

<p>Kubectl is a command line interface for running commands against Kubernetes clusters.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># kubectl controls the Kubernetes cluster manager.</span>
<span class="nv">$ </span>kubectl <span class="nt">--help</span>
<span class="c"># Output shell completion code for the specified shell (bash or zsh).</span>
<span class="nv">$ </span>kubectl completion <span class="nt">--help</span>
<span class="c"># Print the supported API resources on the server</span>
<span class="nv">$ </span>kubectl api-resources <span class="nt">--help</span>
<span class="c"># List the fields for supported resources</span>
<span class="nv">$ </span>kubectl explain <span class="nt">--help</span>
<span class="c"># Modify kubeconfig files using subcommands like "kubectl config set current-context my-context"</span>
<span class="nv">$ </span>kubectl config <span class="nt">--help</span>
<span class="c"># Print the logs for a container in a pod or specified resource.</span>
<span class="nv">$ </span>kubectl logs <span class="nt">--help</span>
<span class="c"># Execute a command in a container.</span>
<span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">--help</span>
</code></pre></div></div>

<h4 id="using-kubectl-to-create-a-deployment">Using kubectl to Create a Deployment</h4>

<p><img src="https://d33wubrfki0l68.cloudfront.net/152c845f25df8e69dd24dd7b0836a289747e258a/4a1d2/docs/tutorials/kubernetes-basics/public/images/module_02_first_app.svg" alt="Kubernetes Cluster" /></p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl run nginx <span class="nt">--image</span><span class="o">=</span>nginx:1.15 <span class="nt">--port</span> 80

<span class="nv">$ </span>kubectl proxy

<span class="nv">$ </span>curl <span class="nt">-iI</span> http://localhost:8001/api/v1/namespaces/default/pods/<span class="si">$(</span>kubectl get po –o <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.items[0].metadata.name}'</span><span class="si">)</span>/proxy
</code></pre></div></div>

<ul>
  <li><strong>kubectl get</strong> - list resources</li>
  <li><strong>kubectl describe</strong> - show detailed information about a resource</li>
  <li><strong>kubectl logs</strong> - print the logs from a container in a pod</li>
  <li><strong>kubectl exec</strong> - execute a command on a container in a pod</li>
</ul>

<h4 id="viewing-pods-and-nodes">Viewing Pods and Nodes</h4>

<p><img src="https://d33wubrfki0l68.cloudfront.net/5cb72d407cbe2755e581b6de757e0d81760d5b86/a9df9/docs/tutorials/kubernetes-basics/public/images/module_03_nodes.svg" alt="Node overview" /></p>

<ul>
  <li>Pod is a Kubernetes abstraction that represents a group of one or more application containers (such as Docker or rkt), and some shared resources for those containers. Those resources include:</li>
  <li>Shared storage, as Volumes</li>
  <li>Networking, as a unique cluster IP address</li>
  <li>
    <p>Information about how to run each container, such as the container image version or specific ports to use</p>
  </li>
  <li>
    <p>A Pod models an application-specific “logical host” and can contain different application containers which are relatively tightly coupled.</p>
  </li>
  <li>Pods are the atomic unit on the Kubernetes platform.</li>
</ul>

<h4 id="pods-overview">Pods overview</h4>

<p><img src="https://d33wubrfki0l68.cloudfront.net/fe03f68d8ede9815184852ca2a4fd30325e5d15a/98064/docs/tutorials/kubernetes-basics/public/images/module_03_pods.svg" alt="Pods overview" /></p>

<h4 id="node-overview">Node overview</h4>

<p><img src="https://d33wubrfki0l68.cloudfront.net/5cb72d407cbe2755e581b6de757e0d81760d5b86/a9df9/docs/tutorials/kubernetes-basics/public/images/module_03_nodes.svg" alt="Node overview" /></p>

<ul>
  <li>A Pod always runs on a Node.</li>
  <li>A Node is a worker machine in Kubernetes and may be either a virtual or a physical machine, depending on the cluster.</li>
  <li>Each Node is managed by the Master.</li>
  <li>
    <p>A Node can have multiple pods, and the Kubernetes master automatically handles scheduling the pods across the Nodes in the cluster.</p>
  </li>
  <li>Every Kubernetes Node runs at least:
    <ul>
      <li><strong>Kubelet</strong>, a process responsible for communication between the Kubernetes Master and the Node; it manages the Pods and the containers running on a machine.</li>
      <li>A <strong>container runtime</strong> (like Docker, rkt) responsible for pulling the container image from a registry, unpacking the container, and running the application.</li>
    </ul>
  </li>
</ul>

<h4 id="using-a-service-to-expose-your-app">Using a Service to Expose Your App</h4>

<p><img src="https://d33wubrfki0l68.cloudfront.net/cc38b0f3c0fd94e66495e3a4198f2096cdecd3d5/ace10/docs/tutorials/kubernetes-basics/public/images/module_04_services.svg" alt="Services and Labels" /></p>

<ul>
  <li>Kubernetes Pods are mortal.</li>
  <li>A Kubernetes Service is an abstraction layer which defines a logical set of Pods and enables external traffic exposure, load balancing and service discovery for those Pods.</li>
  <li>Services can be exposed in different ways by specifying a type in the ServiceSpec:
    <ul>
      <li><strong>ClusterIP</strong> (default) - Exposes the Service on an internal IP in the cluster. This type makes the Service only reachable from within the cluster.</li>
      <li><strong>NodePort</strong> - Exposes the Service on the same port of each selected Node in the cluster using NAT. Makes a Service accessible from outside the cluster using <NodeIP>:<NodePort>. Superset of ClusterIP.</NodePort></NodeIP></li>
      <li><strong>LoadBalancer</strong> - Creates an external load balancer in the current cloud (if supported) and assigns a fixed, external IP to the Service. Superset of NodePort.</li>
      <li><strong>ExternalName</strong> - Exposes the Service using an arbitrary name (specified by externalName in the spec) by returning a CNAME record with the name. No proxy is used.</li>
    </ul>
  </li>
</ul>

<h5 id="services-and-labels">Services and Labels</h5>

<p><img src="https://d33wubrfki0l68.cloudfront.net/b964c59cdc1979dd4e1904c25f43745564ef6bee/f3351/docs/tutorials/kubernetes-basics/public/images/module_04_labels.svg" alt="Services and Labels" /></p>

<ul>
  <li><strong>Labels</strong> are key/value pairs that are attached to objects, such as pods.</li>
  <li>Labels are intended to be used to specify identifying attributes of objects that are meaningful and relevant to users, but do not directly imply semantics to the core system.</li>
  <li>Labels can be used to organize and to select subsets of objects.</li>
  <li>Services match a set of Pods using labels and selectors, a grouping primitive that allows logical operation on objects in Kubernetes.</li>
  <li><a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/</a></li>
</ul>

<h5 id="expose-your-app-publicly">Expose Your App Publicly</h5>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl run nginx <span class="nt">--image</span><span class="o">=</span>nginx:1.15 <span class="nt">--port</span><span class="o">=</span>80
kubectl run <span class="nt">--generator</span><span class="o">=</span>deployment/apps.v1 is DEPRECATED and will be removed <span class="k">in </span>a future version. Use kubectl run <span class="nt">--generator</span><span class="o">=</span>run-pod/v1 or kubectl create instead.
deployment.apps/nginx created
<span class="nv">$ </span>kubectl get po nginx-6f7d58d4cc-7vnxv <span class="nt">--show-labels</span> 
NAME                     READY   STATUS    RESTARTS   AGE   LABELS
nginx-6f7d58d4cc-7vnxv   1/1     Running   0          13s   pod-template-hash<span class="o">=</span>6f7d58d4cc,run<span class="o">=</span>nginx
<span class="nv">$ </span>kubectl expose deployment nginx <span class="nt">--type</span><span class="o">=</span>NodePort <span class="nt">--port</span><span class="o">=</span>80 
service/nginx exposed
<span class="nv">$ </span>kubectl get svc nginx 
NAME    TYPE       CLUSTER-IP     EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>        AGE
nginx   NodePort   10.98.138.39   &lt;none&gt;        80:31462/TCP   26s
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get svc nginx <span class="nt">-ojsonpath</span><span class="o">=</span><span class="s1">'{.spec.ports[0].nodePort}'</span>
31462<span class="nv">$ </span>kubectl get no <span class="nt">-o</span> wide
NAME          STATUS   ROLES    AGE   VERSION   INTERNAL-IP      EXTERNAL-IP   OS-IMAGE                       KERNEL-VERSION   CONTAINER-RUNTIME
far-seer-01   Ready    master   24d   v1.13.2   192.168.66.128   &lt;none&gt;        Debian GNU/Linux 9 <span class="o">(</span>stretch<span class="o">)</span>   4.9.0-8-amd64    docker://18.6.0
<span class="nv">$ </span>curl <span class="nt">-iI</span> 192.168.66.128:31462
HTTP/1.1 200 OK
Server: nginx/1.15.8
Date: Thu, 21 Feb 2019 07:24:48 GMT
Content-Type: text/html
Content-Length: 612
Last-Modified: Tue, 25 Dec 2018 09:56:47 GMT
Connection: keep-alive
ETag: <span class="s2">"5c21fedf-264"</span>
Accept-Ranges: bytes

</code></pre></div></div>

<h3 id="running-multiple-instances-of-your-app">Running Multiple Instances of Your App</h3>

<p><img src="https://d33wubrfki0l68.cloudfront.net/043eb67914e9474e30a303553d5a4c6c7301f378/0d8f6/docs/tutorials/kubernetes-basics/public/images/module_05_scaling1.svg" alt="Current State" /></p>

<p><img src="https://d33wubrfki0l68.cloudfront.net/30f75140a581110443397192d70a4cdb37df7bfc/b5f56/docs/tutorials/kubernetes-basics/public/images/module_05_scaling2.svg" alt="New State" /></p>

<h4 id="scale-your-app">Scale Your App</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get po
NAME                     READY   STATUS    RESTARTS   AGE
nginx-6f7d58d4cc-7vnxv   1/1     Running   0          20m
<span class="nv">$ </span>kubectl scale deployment nginx <span class="nt">--replicas</span><span class="o">=</span>4    <span class="c"># scale out</span>
deployment.extensions/nginx scaled
<span class="nv">$ </span>kubectl get po
NAME                     READY   STATUS    RESTARTS   AGE
nginx-6f7d58d4cc-7vnxv   1/1     Running   0          20m
nginx-6f7d58d4cc-ddhgk   1/1     Running   0          5s
nginx-6f7d58d4cc-l7grh   1/1     Running   0          5s
nginx-6f7d58d4cc-m8nr2   1/1     Running   0          5s
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nv">$ </span>kubectl scale deployment nginx <span class="nt">--replicas</span><span class="o">=</span>2    <span class="c"># scale in</span>
deployment.extensions/nginx scaled
<span class="nv">$ </span>kubectl get po <span class="nt">-w</span>
NAME                     READY   STATUS        RESTARTS   AGE
nginx-6f7d58d4cc-7vnxv   1/1     Running       0          21m
nginx-6f7d58d4cc-ddhgk   1/1     Running       0          62s
nginx-6f7d58d4cc-l7grh   0/1     Terminating   0          62s
nginx-6f7d58d4cc-m8nr2   0/1     Terminating   0          62s
nginx-6f7d58d4cc-m8nr2   0/1   Terminating   0     64s
nginx-6f7d58d4cc-m8nr2   0/1   Terminating   0     64s
nginx-6f7d58d4cc-l7grh   0/1   Terminating   0     64s
nginx-6f7d58d4cc-l7grh   0/1   Terminating   0     64s
^C<span class="nv">$ </span>kubectl get po
NAME                     READY   STATUS    RESTARTS   AGE
nginx-6f7d58d4cc-7vnxv   1/1     Running   0          21m
nginx-6f7d58d4cc-ddhgk   1/1     Running   0          79s
<span class="nv">$ </span>
</code></pre></div></div>

<h3 id="performing-a-rolling-update">Performing a Rolling Update</h3>

<p><img src="https://d33wubrfki0l68.cloudfront.net/30f75140a581110443397192d70a4cdb37df7bfc/fa906/docs/tutorials/kubernetes-basics/public/images/module_06_rollingupdates1.svg" alt="Current State" /></p>

<p><img src="https://d33wubrfki0l68.cloudfront.net/678bcc3281bfcc588e87c73ffdc73c7a8380aca9/703a2/docs/tutorials/kubernetes-basics/public/images/module_06_rollingupdates2.svg" alt="Updating State" /></p>

<p><img src="https://d33wubrfki0l68.cloudfront.net/6d8bc1ebb4dc67051242bc828d3ae849dbeedb93/fbfa8/docs/tutorials/kubernetes-basics/public/images/module_06_rollingupdates4.svg" alt="New State" /></p>

<h4 id="update-your-app">Update Your App</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get deployment
NAME    READY   UP-TO-DATE   AVAILABLE   AGE
nginx   2/2     2            2           53m
<span class="nv">$ </span>kubectl get svc nginx 
NAME    TYPE       CLUSTER-IP     EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>        AGE
nginx   NodePort   10.98.138.39   &lt;none&gt;        80:31462/TCP   52m
<span class="nv">$ </span>curl <span class="nt">-iIs</span> 192.168.66.128:31462 | <span class="nb">grep </span>Server
Server: nginx/1.15.8
<span class="nv">$ </span>kubectl <span class="nb">set </span>image deploy nginx <span class="nv">nginx</span><span class="o">=</span>nginx:1.13 <span class="o">&amp;&amp;</span> kubectl get deploy nginx <span class="nt">-w</span>
deployment.extensions/nginx image updated
NAME    READY   UP-TO-DATE   AVAILABLE   AGE
nginx   2/2     1            2           54m
nginx   3/2   1     3     54m
nginx   2/2   1     2     54m
nginx   2/2   2     2     54m
^Ccurl <span class="nt">-iIs</span> 192.168.66.128:31462 | <span class="nb">grep </span>Server
Server: nginx/1.13.12
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl rollout undo deployment nginx 
deployment.extensions/nginx rolled back
<span class="nv">$ </span>kubectl get deployments <span class="nt">-w</span>
NAME    READY   UP-TO-DATE   AVAILABLE   AGE
nginx   2/2     2            2           58m
^Ccurl <span class="nt">-iIs</span> 192.168.66.128:31462 | <span class="nb">grep </span>Server
Server: nginx/1.15.8
<span class="nv">$ </span>kubectl rollout undo deployment nginx 
deployment.extensions/nginx rolled back
<span class="nv">$ </span>curl <span class="nt">-iIs</span> 192.168.66.128:31462 | <span class="nb">grep </span>Server
Server: nginx/1.13.12
<span class="nv">$ </span>kubectl get rs
NAME               DESIRED   CURRENT   READY   AGE
nginx-5df8d97c98   0         0         0       21m
nginx-6b46d56475   2         2         2       17m
nginx-6f7d58d4cc   0         0         0       63m
<span class="nv">$ </span>kubectl rollout <span class="nb">history </span>deployment nginx 
deployment.extensions/nginx 
REVISION  CHANGE-CAUSE
2         &lt;none&gt;
3         &lt;none&gt;
</code></pre></div></div>

<h3 id="quit-or-not-quit-">Quit or not quit ?</h3>

<p><a href="https://kubernetes.io/">https://kubernetes.io/</a></p>

  </div>

  <ul class="post-navigation">
    <li>
      
      <a href="/2019/02/01/access-kubernetes-api-with-client-certificates/">&laquo; Access Kubernetes API with Client Certificates</a>
      
    </li>
    <li>
      
      <a href="/2019/02/22/kubernetes-crash-course-1/">1 - Kubernetes Objects &raquo;</a>
      
    </li>
  </ul>
</article>

      </div>
    </div>

    <footer class="site-footer">
  <div class="license">
    <span>Article licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></span>
  </div>
  
  <details open>
    <summary>Extral Links</summary>
    <div>
      
      <a href="https://jekyllrb.com/">Jekyll</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://shopify.github.io/">Liquid</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://docs.asciidoctor.org/">Asciidoctor</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://github.com/qqbuby/">GitHub</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="/feed.xml">RSS</a>
      
      
    </div>
  </details>
  
</footer>


<!-- https://github.com/bryanbraun/anchorjs -->
<script src="/js/anchor.min.js"></script>
<script>
  anchors.add();
  anchors.remove(".site-title");
</script>




  </body>

</html>
