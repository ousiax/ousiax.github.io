= Internet Address Architecture
:page-layout: post
:page-categories: ['networking']
:page-tags: ['networking']
:page-date: 2022-11-11 08:33:09 +0800
:page-revdate: 2022-11-11 08:33:09 +0800
:sectnums:
:toc:

Every device connected to the Internet has at least one IP address. Devices used in private networks based on the TCP/IP protocols also require IP addresses. In either case, the forwarding procedures implemented by IP routers use IP addresses to identify where traffic is going. IP addresses also indicate where traffic has come from.

IP addresses are similar in some ways to telephone numbers, but whereas telephone numbers are often known and used directly by end users, IP addresses are often shielded from a user's view by the Internet’s DNS, which allows most users to use names instead of numbers. Users are confronted with manipulating IP addresses when they are required to set up networks themselves or when the DNS has failed for some reason.

== Expressing IP Address

The vast majority of Internet users who are familiar with IP addresses understand the most popular type: *IPv4* addresses. Such addresses are often represented in so-called dotted-quad or dotted-decimal notation.

.Example IPv4 addresses written in dotted-quad and binary notation
[%header,cols="1,1",width=75%]
|===
|Dotted-Quad Representation
|Binary Representation

|0.0.0.0
|00000000 00000000 00000000 00000000

|1.2.3.4
|00000001 00000010 00000011 00000100

|10.0.0.255
|00001010 00000000 00000000 11111111

|165.195.130.107
|10100101 11000011 10000010 01101011

|255.255.255.255
|11111111 11111111 11111111 11111111

|===

In *IPv6*, addresses are 128 bits in length, four times larger than IPv4 addresses, and generally speaking are less familiar to most users. The conventional notation adopted for IPv6 addresses is a series of four hexadecimal ("hex," or base-16) numbers called _blocks_ or _fields_ separated by colons.

Although not as familiar to users as decimal numbers, hexadecimal numbers make the task of converting to binary somewhat simpler. In addition, a number of agreed-upon simplifications have been standardized for expressing IPv6 addresses [RFC4291]:

. Leading zeros of a block need not be written.
+
For example, the address `5f05:2000:80ad:5800:0058:0800:2023:1d71` can been written as `5f05:2000:80ad:5800:58:800:2023:1d71`.

. Blocks of all zeros can be omitted and replaced by the notation `::`.
+
For example, the IPv6 address `0:0:0:0:0:0:0:1` can be written more compactly as `::1`. Similarly, the address `2001:0db8:0:0:0:0:0:2` can be written more compactly
as `2001:db8::2`.
+
To avoid ambiguities, the `::` notation may be used only once in an IPv6 address.

. Embedded IPv4 addresses represented in the IPv6 format can use a form of hybrid notation in which the block immediately preceding the IPv4 portion of the address has the value ffff and the remaining part of the address is formatted using dotted-quad.
+
For example, the IPv6 address `::ffff:10.0.0.1` represents the IPv4 address `10.0.0.1`. This is called an _IPv4-mapped IPv6 address_.

. A conventional notation is adopted in which the low-order 32 bits of the IPv6 address can be written using dotted-quad notation.
+
The IPv6 address `::0102:f001` is therefore equivalent to the address `::1.2.240.1`. This is called an _IPv4-compatible IPv6 address_.
+
Note that IPv4-compatible addresses are not the same as IPv4-mapped addresses; they are compatible only in the sense that they can be written down or manipulated by software in a way similar to IPv4 addresses.

.Examples of IPv6 addresses and their binary representations
[%header,cols="1,1",width=75%]
|===
|Hex Notation
|Binary Representation

|5f05:2000:80ad:5800:58:800:2023:1d71
|0101111100000101 0010000000000000
1000000010101101 0101100000000000
0000000001011000 0000100000000000
0010000000100011 0001110101110001

|::1
|0000000000000000 0000000000000000
0000000000000000 0000000000000000
0000000000000000 0000000000000000
0000000000000000 0000000000000001

|::1.2.240.1 or ::102:f001
|0000000000000000 0000000000000000
0000000000000000 0000000000000000
0000000000000000 0000000000000000
0000000100000010 1111000000000001

|===

In some circumstances (e.g., when expressing a URL containing an address) the colon delimiter in an IPv6 address may be confused with another separator
such as the colon used between an IP address and a port number. In such circumstances, bracket characters, `[` and `]`, are used to surround the IPv6 address.

For example, the URL `http://[2001:0db8:85a3:08d3:1319:8a2e:0370:7344]:443/` refers to port number `443` on IPv6 host `2001:0db8:85a3:08d3:1319:8a2e:0370:7344` using the HTTP/TCP/IPv6 protocols.

== Basic IP Address Structure

Because of the large number of addresses (especially for IPv6), it is convenient to divide the address space into chunks. IP addresses are grouped by type and size.

Most of the IPv4 address chunks are eventually subdivided down to a single address and used to identify a single network interface of a computer attached to the Internet or to some private intranet. These addresses are called *unicast* addresses.

Beyond *unicast addresses*, other types of addresses include *broadcast*, *multicast*, and *anycast*, which may refer to more than one interface, plus some special-purpose addresses.

=== Classful Addressing

When the Internet’s address structure was originally defined, every unicast IP address had a _network_ portion, to identify the network on which the interface using the IP address was to be found, and a _host_ portion, used to identify the particular host on the network given in the network portion. Thus, some number of contiguous bits in the address became known as the _net number_, and remaining bits were known as the _host number_. At the time, most hosts had only a single network interface, so the terms _interface address_ and _host address_ were used somewhat interchangeably.

With the realization that different networks might have different numbers of hosts, and that each host requires a unique IP address, a partitioning was devised wherein different-size allocation units of IP address space could be given out to different sites, based on their current and projected number of hosts. The partitioning of the address space involved *five classes*. Each class represented a different trade-off in the number of bits of a 32-bit IPv4 address devoted to the network number versus the number of bits devoted to the host number.

.The original ("classful") IPv4 address space partitioning
[%header,cols="1,2,2,1,2,2,2"]
|===
|Class
|Address Range
|High-Order Bits
|Use
|Fraction of Total
|Number of Nets
|Number of Hosts

|A
|0.0.0.0–127.255.255.255
|0
|Unicast/special
|1/2
|128
|16,777,216

|B
|128.0.0.0–191.255.255.255
|10
|Unicast/special
|1/4
|16,384
|65,536

|C
|192.0.0.0–223.255.255.255
|110
|Unicast/special
|1/8
|2,097,152
|256

|D
|224.0.0.0–239.255.255.255
|1110
|Multicast
|1/16
|N/A
|N/A

|E
|240.0.0.0–255.255.255.255
|1111
|Reserved
|1/16
|N/A
|N/A

|===

=== Subnet Addressing

One of the earliest difficulties encountered when the Internet began to grow was the inconvenience of having to allocate a new network number for any new network segment that was to be attached to the Internet. This became especially cumbersome with the development and increasing use of local area networks (LANs) in the early 1980s.

To address the problem, it was natural to consider a way that a site attached to the Internet could be allocated a network number centrally that could then be subdivided locally by site administrators. If this could be accomplished without altering the rest of the Internet's core routing infrastructure, so much the better.

Implementing this idea would require the ability to alter the line between the network portion of an IP address and the host portion, but only for local purposes at a site; the rest of the Internet would "see" only the traditional class A, B, and C partitions. The approach adopted to support this capability is called *subnet addressing*[RFC0950].

Using subnet addressing, a site is allocated a class A, B, or C network number, leaving some number of remaining host bits to be further allocated and assigned within a site. The site may further divide the host portion of its base address allocation into a *subnetwork* (subnet) number and a host number.

In exchange for the additional flexibility provided by subnet addressing, a new cost is imposed. Because the definition of the *Subnet* and *Host* fields is now site-specific (not dictated by the class of the network number), all routers and hosts at a site require a new way to determine where the Subnet field of the address and the Host field of the address are located within the address. Before subnets, this information could be derived directly by knowing whether a network number was from class A, B, or C (as indicated by the first few bits in the address).

.An example of a subnetted class B address. Using 8 bits for the subnet ID provides for 256 subnets with 254 hosts on each of the subnets. This partitioning may be altered by the network administrator.
[%header,cols="1,1,3,3,3"]
|===
|Class
2+|Centrally Allocated
2+|Locally Managed at Site

|B
|110
|Net Number (16 bits; 14 free)
|Subnet ID (8 bits)
|Host ID (8 bits)

|===

This particular configuration allows the site to support 256 subnetworks, and each subnetwork may contain up to 254 hosts (now the first and last addresses for each subnetwork are not available, as opposed to losing only the first and last addresses of the entire allocated range). Recall that the subnetwork structure is known only by hosts and routers where the subnetting is taking place. The remainder of the Internet still treats any address associated with the site just as it did prior to the advent of subnet addressing.

.A site is allocated the classical class B network number 128.32. The network administrator decides to apply a site-wide subnet mask of 255.255.255.0, giving 256 subnetworks where each subnetwork can hold 256 – 2 = 254 hosts. The IPv4 address of each host on the same subnet has the subnetwork number in common. All of the IPv4 addresses of hosts on the left-hand LAN segment start with 128.32.1, and all of those on the right start with 128.32.2.
image::/assets/internet-address-architecture/subnet-addressing.png[,55%,55%]

=== Subnet mask

The *subnet mask* is an assignment of bits used by a host or router to determine how the network and subnetwork information is partitioned from the host information in a corresponding IP address. Subnet masks for IP are the same length as the corresponding IP addresses (32 bits for IPv4 and 128 bits for IPv6). They are typically configured into a host or router in the same way as IP addresses—either statically (typical for routers) or using some dynamic system such as the _Dynamic Host Configuration Protocol_ (DHCP). For IPv4, subnet masks may be written in the same way an IPv4 address is written (i.e., dotted-decimal).

Although not originally required to be arranged in this manner, today subnet masks are structured as some number of 1 bits followed by some number of 0 bits. Because of this arrangement, it is possible to use a shorthand format for expressing masks that simply gives the number of contiguous 1 bits in the mask (starting from the left). This format is now the most common format and is sometimes called the *prefix length*.

.IPv4 subnet mask examples in various formats
[%header,cols="2,2,3"]
|===
|Dotted-Decimal Representation
|Shorthand (Prefix Length)
|Binary Representation

|128.0.0.0
|/1
|10000000 00000000 00000000 00000000

|255.0.0.0
|/8
|11111111 00000000 00000000 00000000

|255.192.0.0
|/10
|11111111 11000000 00000000 00000000

|255.255.0.0
|/16
|11111111 11111111 00000000 00000000

|255.255.254.0
|/23
|11111111 11111111 11111110 00000000

|255.255.255.192
|/27
|11111111 11111111 11111111 11100000

|255.255.255.255
|/32
|11111111 11111111 11111111 11111111

|===

.IPv6 subnet mask examples in various formats
[%header,cols="2,2,3"]
|===
|Hex Notation
|Shorthand (Prefix Length)
|Binary Representation

|ffff:ffff:ffff:ffff::
|/64
|1111111111111111 1111111111111111
1111111111111111 1111111111111111
0000000000000000 0000000000000000
0000000000000000 0000000000000000

|ff00::
|/8
|1111111100000000 0000000000000000
0000000000000000 0000000000000000
0000000000000000 0000000000000000
0000000000000000 0000000000000000
|===

Masks are used by routers and hosts to determine where the network/subnetwork portion of an IP address ends and the host part begins. A bit set to 1 in the subnet mask means the corresponding bit position in an IP address should be considered part of a combined network/subnetwork portion of an address, which is used as the basis for forwarding datagrams. Conversely, a bit set to 0 in the subnet mask means the corresponding bit position in an IP address should be considered part of the host portion.

.An IP address can be combined with a subnet mask using a bitwise AND operation in order to form the network/subnetwork identifier (prefix) of the address used for routing. In this example, applying a mask of length 24 to the IPv4 address 128.32.1.14 gives the prefix 128.32.1.0/24.
image::/assets/internet-address-architecture/ip-network-subnet.png[,75%,75%]
