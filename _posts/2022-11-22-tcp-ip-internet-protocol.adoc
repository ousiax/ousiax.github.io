= TCP IP Internet Protocol
:page-layout: post
:page-categories: ['networking']
:page-tags: ['networking']
:page-date: 2022-11-22 09:17:14 +0800
:page-revdate: 2022-11-22 09:17:14 +0800
:toc: premable
:sectnums:

IP is the workhorse protocol of the TCP/IP protocol suite. All TCP, UDP, ICMP, and IGMP data gets transmitted as IP datagrams. IP provides a *_best-effort_*, *_connectionless_* datagram delivery service.

== IPv4 and IPv6 Headers

The normal size of the IPv4 header is 20 bytes, unless _options_ are present (which is rare).

The IPv6 header is twice as large but never has any options, may have _extension headers_.

The most significant bit of headers and datagrams is numbered 0 at the left, and the least significant bit of a 32-bit value is numbered 31 on the right.

* The 4 bytes in a 32-bit value are transmitted in the following order: bits _0–7_ first, then bits _8–15_, then _16–23_, and bits _24–31_ last.
* This is called *big endian byte ordering*, which is the byte ordering required for all binary integers in the TCP/IP headers as they traverse a network. It is also called *network byte order*.
* Computer CPUs that store binary integers in other formats, such as the *little endian* format, must convert the header values into network byte order for transmission and back again for reception.
+
[source,console,highlight=4]
----
$ lscpu 
Architecture:                    x86_64
CPU op-mode(s):                  32-bit, 64-bit
Byte Order:                      Little Endian
Model name:                      Intel(R) Core(TM) i5-10210U CPU @ 1.60GHz
----

.The IPv4 datagram. The header is of variable size, limited to fifteen 32-bit words (60 bytes) by the 4-bit IHL field. A typical IPv4 header contains 20 bytes (no options). The source and destination addresses are 32 bits long. Most of the second 32-bit word is used for the IPv4 fragmentation function. A header checksum helps ensure that the fields in the header are delivered correctly to the proper destination but does not protect the data.
image::/assets/tcp-ip-internet-protocol/ipv4-datagram.png[IPv4 Datagram,55%,55%]

.The IPv6 header is of fixed size (40 bytes) and contains 128-bit source and destination addresses. The Next Header field is used to indicate the presence and types of additional extension headers that follow the IPv6 header, forming a daisy chain of headers that may include special extensions or processing directives. Application data follows the header chain, usually immediately following a transport-layer header.
image::/assets/tcp-ip-internet-protocol/ipv6-datagram.png[IPv6 Datagram,55%,55%]
