<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bing WebMaster -->
  <meta name="msvalidate.01" content="AB2FFF876C37F59D9121882CC8395DE5" />

  <title>Intro to SQL Server Database</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://blog.codefarm.me/2023/04/06/sql-server-database/">
  <link rel="alternate" type="application/rss+xml" title="CODE FARM" href="https://blog.codefarm.me/feed.xml">

  <!-- https://cdn.jsdelivr.net/gh/lurongkai/anti-baidu/js/anti-baidu-latest.min.js -->
<script type="text/javascript" src="/js/anti-baidu.min.js" charset="UTF-8"></script>

  
<!-- Google Analytics Website tracking -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83971182-1', 'auto');
  ga('send', 'pageview');

</script>


  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SN88FJ18E5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SN88FJ18E5');
</script>



</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
    <h2 class="site-title">
      <a class="site-title" href="/">CODE FARM</a>
    </h2>

     <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
        <div class="trigger">
            <ul>
                <li><a href="/">home</a>
                <li><a href="/category">category</a>
                <li><a href="/tag">tag</a>
                <li><a href="/archive">archive</a>
                <li><a href="/about">about</a>
                <li><a href="https://resume.github.io/?qqbuby" target="_blank">R&eacute;sum&eacute;</a>
            </ul>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Intro to SQL Server Database</h1>
    
    
    <p class="post-meta"><time datetime="2023-04-06T10:14:18+08:00" itemprop="datePublished">Apr 6, 2023</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#deploy-and-connect-to-sql-server-linux-containers">1. Deploy and connect to SQL Server Linux containers</a>
<ul class="sectlevel2">
<li><a href="#pull-and-run-the-sql-server-linux-container-image">1.1. Pull and run the SQL Server Linux container image</a></li>
<li><a href="#connect-to-sql-server">1.2. Connect to SQL Server</a></li>
<li><a href="#create-and-query-data">1.3. Create and query data</a>
<ul class="sectlevel3">
<li><a href="#create-a-new-database">1.3.1. Create a new database</a></li>
<li><a href="#insert-data">1.3.2. Insert data</a></li>
<li><a href="#select-data">1.3.3. Select data</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#databases">2. Databases</a>
<ul class="sectlevel2">
<li><a href="#basic-information-about-databases">2.1. Basic Information about Databases</a></li>
<li><a href="#working-with-databases">2.2. Working with Databases</a></li>
<li><a href="#system-databases">2.3. System Databases</a>
<ul class="sectlevel3">
<li><a href="#master-database">2.3.1. master Database</a></li>
</ul>
</li>
<li><a href="#contained-databases">2.4. Contained Databases</a></li>
<li><a href="#database-files-and-filegroups">2.5. Database Files and Filegroups</a>
<ul class="sectlevel3">
<li><a href="#database-files">2.5.1. Database Files</a></li>
<li><a href="#logical-and-physical-file-names">2.5.2. Logical and Physical File Names</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#database-engine-permissions-and-principals">3. Database Engine Permissions and Principals</a>
<ul class="sectlevel2">
<li><a href="#security-principals">3.1. Security principals</a>
<ul class="sectlevel3">
<li><a href="#logins">3.1.1. Logins</a></li>
<li><a href="#fixed-server-roles">3.1.2. Fixed server roles</a></li>
<li><a href="#user-defined-server-roles">3.1.3. User-defined server roles</a></li>
<li><a href="#database-users">3.1.4. Database users</a></li>
<li><a href="#fixed-database-roles">3.1.5. Fixed database roles</a></li>
<li><a href="#user-defined-database-roles">3.1.6. User-defined database roles</a></li>
<li><a href="#other-principals">3.1.7. Other principals</a></li>
</ul>
</li>
<li><a href="#assign-permissions">3.2. Assign permissions</a></li>
<li><a href="#permission-hierarchy">3.3. Permission hierarchy</a></li>
<li><a href="#monitor-permissions">3.4. Monitor permissions</a></li>
<li><a href="#principals-database-engine">3.5. Principals (Database Engine)</a>
<ul class="sectlevel3">
<li><a href="#sql-server-level-principals">3.5.1. SQL Server-level principals</a></li>
<li><a href="#database-level-principals">3.5.2. Database-level principals</a></li>
<li><a href="#sa-login">3.5.3. sa Login</a></li>
<li><a href="#dbo-user-and-dbo-schema">3.5.4. dbo User and dbo Schema</a></li>
<li><a href="#public-server-role-and-database-role">3.5.5. public Server Role and Database Role</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sql-and-t-sql">4. SQL and T-SQL</a></li>
<li><a href="#sql-server-utilities-statements-go">5. SQL Server Utilities Statements - GO</a></li>
<li><a href="#transact-sql-syntax-conventions-transact-sql">6. Transact-SQL syntax conventions (Transact-SQL)</a>
<ul class="sectlevel2">
<li><a href="#multipart-names">6.1. Multipart names</a></li>
</ul>
</li>
<li><a href="#tutorial-write-transact-sql-statements">7. Tutorial: Write Transact-SQL statements</a>
<ul class="sectlevel2">
<li><a href="#lesson-1-create-and-query-database-objects">7.1. Lesson 1: Create and query database objects</a>
<ul class="sectlevel3">
<li><a href="#create-a-database">7.1.1. Create a database</a></li>
<li><a href="#create-a-table">7.1.2. Create a Table</a>
<ul class="sectlevel4">
<li><a href="#switch-the-query-editor-connection-to-the-testdata-database">7.1.2.1. Switch the Query Editor connection to the TestData database</a></li>
<li><a href="#create-the-table">7.1.2.2. Create the table</a></li>
</ul>
</li>
<li><a href="#insert-and-update-data-in-a-table">7.1.3. Insert and update data in a table</a>
<ul class="sectlevel4">
<li><a href="#insert-data-into-a-table">7.1.3.1. Insert data into a table</a></li>
<li><a href="#update-the-products-table">7.1.3.2. Update the products table</a></li>
</ul>
</li>
<li><a href="#read-data-from-a-table">7.1.4. Read data from a table</a>
<ul class="sectlevel4">
<li><a href="#read-the-data-in-a-table">7.1.4.1. Read the data in a table</a></li>
<li><a href="#useful-functions-in-a-select-statement">7.1.4.2. Useful functions in a SELECT statement</a></li>
</ul>
</li>
<li><a href="#create-views-and-stored-procedures">7.1.5. Create views and stored procedures</a>
<ul class="sectlevel4">
<li><a href="#create-a-view">7.1.5.1. Create a view</a></li>
<li><a href="#test-the-view">7.1.5.2. Test the view</a></li>
<li><a href="#create-a-stored-procedure">7.1.5.3. Create a stored procedure</a></li>
<li><a href="#test-the-stored-procedure">7.1.5.4. Test the stored procedure</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#lesson-2-configure-permissions-on-database-objects">7.2. Lesson 2: Configure permissions on database objects</a>
<ul class="sectlevel3">
<li><a href="#create-a-login">7.2.1. Create a login</a>
<ul class="sectlevel4">
<li><a href="#create-a-new-windows-account">7.2.1.1. Create a new Windows account</a></li>
<li><a href="#create-a-sql-login-using-windows-authentication-with-t-sql">7.2.1.2. Create a SQL login  using Windows Authentication with T-SQL</a></li>
<li><a href="#create-a-login-using-sql-server-authentication-with-t-sql">7.2.1.3. Create a login using SQL Server Authentication with T-SQL</a></li>
</ul>
</li>
<li><a href="#grant-access-to-a-database">7.2.2. Grant access to a database</a>
<ul class="sectlevel4">
<li><a href="#create-a-user-in-a-database">7.2.2.1. Create a user in a database</a></li>
<li><a href="#create-views-and-stored-procedures-2">7.2.2.2. Create views and stored procedures</a></li>
<li><a href="#about-grant">7.2.2.3. About GRANT</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#lesson-3-delete-database-objects">7.3. Lesson 3: Delete database objects</a>
<ul class="sectlevel3">
<li><a href="#revoke-stored-procedure-permissions">7.3.1. Revoke stored procedure permissions</a></li>
<li><a href="#drop-permissions">7.3.2. Drop permissions</a></li>
<li><a href="#delete-table">7.3.3. Delete table</a></li>
<li><a href="#remove-database">7.3.4. Remove database</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#references">8. References</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="deploy-and-connect-to-sql-server-linux-containers">1. Deploy and connect to SQL Server Linux containers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this quickstart, you&#8217;ll use Docker to pull and run the SQL Server 2022 (16.x) Linux container image, <a href="https://hub.docker.com/_/microsoft-mssql-server">mssql-server-linux</a>. Then you can connect with <strong>sqlcmd</strong> to create your first database and run queries.</p>
</div>
<div class="sect2">
<h3 id="pull-and-run-the-sql-server-linux-container-image">1.1. Pull and run the SQL Server Linux container image</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pull the SQL Server 2022 (16.x) Linux container image from the Microsoft Container Registry.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">sudo </span>docker pull mcr.microsoft.com/mssql/server:2022-latest</code></pre>
</div>
</div>
</li>
<li>
<p>To run the Linux container image with Docker, you can use the following command from a bash shell or elevated PowerShell command prompt.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>SA_PASSWORD</code> environment variable is deprecated. Please use <code>MSSQL_SA_PASSWORD</code> instead.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nb">sudo </span>docker run <span class="nt">-e</span> <span class="s2">"ACCEPT_EULA=Y"</span> <span class="nt">-e</span> <span class="s2">"MSSQL_SA_PASSWORD=&lt;YourStrong@Passw0rd&gt;"</span> <span class="se">\</span>
   <span class="nt">-p</span> 1433:1433 <span class="nt">--name</span> sql1 <span class="nt">--hostname</span> sql1 <span class="se">\</span>
   <span class="nt">-d</span> <span class="se">\</span>
   mcr.microsoft.com/mssql/server:2022-latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your password should follow the SQL Server default password policy, otherwise the container can&#8217;t set up SQL Server and will stop working. By default, the password must be at least eight characters long and contain characters from three of the following four sets: uppercase letters, lowercase letters, base-10 digits, and symbols.</p>
</div>
<div class="paragraph">
<p>By default, this quickstart creates a container with the Developer edition of SQL Server. The process for running production editions in containers is slightly different.</p>
</div>
</li>
<li>
<p>To view your Docker containers, use the <code>docker ps</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">docker ps</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">CONTAINER ID   IMAGE                                        COMMAND                  CREATED          STATUS        PORTS                                       NAMES
</span><span class="gp">274554ac9f0d   mcr.microsoft.com/mssql/server:2022-latest   "/opt/mssql/bin/permâ€¦"   42 seconds ago   Up 1 second   0.0.0.0:1433-&gt;</span>1433/tcp, :::1433-&gt;1433/tcp   sql1</code></pre>
</div>
</div>
</li>
<li>
<p>If the <code>STATUS</code> column shows a status of <code>Up</code>, then SQL Server is running in the container and listening on the port specified in the <code>PORTS</code> column. If the <code>STATUS</code> column for your SQL Server container shows <code>Exited</code>, see the <a href="https://learn.microsoft.com/en-us/sql/linux/sql-server-linux-docker-container-troubleshooting?view=sql-server-ver16">Troubleshooting section of the configuration guide</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="connect-to-sql-server">1.2. Connect to SQL Server</h3>
<div class="paragraph">
<p>The following steps use the SQL Server command-line tool, sqlcmd, inside the container to connect to SQL Server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>docker exec -it</code> command to start an interactive bash shell inside your running container. In the following example <code>sql1</code> is name specified by the <code>--name</code> parameter when you created the container.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nb">sudo </span>docker <span class="nb">exec</span> <span class="nt">-it</span> sql1 <span class="s2">"bash"</span></code></pre>
</div>
</div>
</li>
<li>
<p>Once inside the container, connect locally with <strong>sqlcmd</strong>, using its full path.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">/opt/mssql-tools/bin/sqlcmd <span class="nt">-S</span> localhost <span class="nt">-U</span> SA <span class="nt">-P</span> <span class="s2">"&lt;YourStrong@Passw0rd&gt;"</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can omit the password on the command-line to be prompted to enter it. Here&#8217;s an example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">/opt/mssql-tools/bin/sqlcmd <span class="nt">-S</span> localhost <span class="nt">-U</span> SA</code></pre>
</div>
</div>
</li>
<li>
<p>If successful, you should get to a <strong>sqlcmd</strong> command prompt: <code>1&gt;</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="create-and-query-data">1.3. Create and query data</h3>
<div class="paragraph">
<p>The following sections walk you through using <strong>sqlcmd</strong> and Transact-SQL to create a new database, add data, and run a query.</p>
</div>
<div class="sect3">
<h4 id="create-a-new-database">1.3.1. Create a new database</h4>
<div class="paragraph">
<p>The following steps create a new database named <code>TestDB</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the sqlcmd command prompt, paste the following Transact-SQL command to create a test database:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">TestDB</span><span class="p">;</span></code></pre>
</div>
</div>
</li>
<li>
<p>On the next line, write a query to return the name of all of the databases on your server:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">Name</span> <span class="k">from</span> <span class="n">sys</span><span class="p">.</span><span class="n">databases</span><span class="p">;</span></code></pre>
</div>
</div>
</li>
<li>
<p>The previous two commands weren&#8217;t run immediately. Type <code>GO</code> on a new line to run the previous commands:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">GO</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="insert-data">1.3.2. Insert data</h4>
<div class="paragraph">
<p>Next create a new table, Inventory, and insert two new rows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <em>sqlcmd</em> command prompt, switch context to the new <em>TestDB</em> database:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="n">USE</span> <span class="n">TestDB</span><span class="p">;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Create new table named <code>Inventory</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Inventory</span> <span class="p">(</span><span class="n">id</span> <span class="nb">INT</span><span class="p">,</span> <span class="n">name</span> <span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">quantity</span> <span class="nb">INT</span><span class="p">);</span></code></pre>
</div>
</div>
</li>
<li>
<p>Insert data into the new table:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Inventory</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'banana'</span><span class="p">,</span> <span class="mi">150</span><span class="p">);</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">Inventory</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'orange'</span><span class="p">,</span> <span class="mi">154</span><span class="p">);</span></code></pre>
</div>
</div>
</li>
<li>
<p>Type <code>GO</code> to run the previous commands:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">GO</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="select-data">1.3.3. Select data</h4>
<div class="paragraph">
<p>Now, run a query to return data from the <code>Inventory</code> table.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <em>sqlcmd</em> command prompt, enter a query that returns rows from the <code>Inventory</code> table where the quantity is greater than 152:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">Inventory</span> <span class="k">WHERE</span> <span class="n">quantity</span> <span class="o">&gt;</span> <span class="mi">152</span><span class="p">;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Run the command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">GO</span></code></pre>
</div>
</div>
</li>
<li>
<p>Exit the sqlcmd command prompt</p>
<div class="paragraph">
<p>To end your sqlcmd session, type <code>QUIT</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="n">QUIT</span></code></pre>
</div>
</div>
</li>
<li>
<p>To exit the interactive command-prompt in your container, type <code>exit</code>. Your container continues to run after you exit the interactive bash shell.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="databases">2. Databases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <em>database</em> in <em>SQL Server</em> is made up of a collection of <em>tables</em> that stores a specific set of structured data. A tableontains a collection of <em>rows</em>, also referred to as <em>records</em> or <em>tuples</em>, and <em>columns</em>, also referred to as <em>attributes</em>. Each column in the table is designed to store a certain type of information, for example, dates, names, dollar amounts, and numbers.</p>
</div>
<div class="sect2">
<h3 id="basic-information-about-databases">2.1. Basic Information about Databases</h3>
<div class="paragraph">
<p>A computer can have one or more than one instance of <em>SQL Server</em> installed. Each instance of SQL Server can contain one or many <em>databases</em>. Within a database, there are one or many object ownership groups called <em>schemas</em>. Within each schema there are database objects such as <em>tables</em>, <em>views</em>, and <em>stored procedures</em>. Some objects such as certificates and asymmetric keys are contained within the database, but are not contained within a schema. For more information about creating tables, see <a href="https://learn.microsoft.com/en-us/sql/relational-databases/tables/tables?view=sql-server-ver16">Tables</a>.</p>
</div>
<div class="paragraph">
<p>SQL Server databases are stored in the file system in <em>files</em>. Files can be grouped into <em>filegroups</em>. For more information about files and filegroups, see {sqldb-file-filegroups}[Database Files and Filegroups].</p>
</div>
<div class="paragraph">
<p>When people gain access to an instance of SQL Server they are identified as a <em>login</em>. When people gain access to a database they are identified as a <em>database user</em>. A database user can be based on a login. If <em>contained databases</em> are enabled, a database user can be created that is not based on a login. For more information about users, see <code>CREATE USER</code> (<a href="https://learn.microsoft.com/en-us/sql/t-sql/language-reference?view=sql-server-ver16">Transact-SQL</a>).</p>
</div>
<div class="paragraph">
<p>A user that has access to a database can be given <em>permission</em> to access the objects in the database. Though permissions can be granted to <em>individual users</em>, we recommend creating <em>database roles</em>, adding the database users to the roles, and then grant access permission to the roles. Granting permissions to roles instead of users makes it easier to keep permissions consistent and understandable as the number of users grow and continually change. For more information about roles permissions, see <code>CREATE ROLE</code> (<a href="https://learn.microsoft.com/en-us/sql/t-sql/language-reference?view=sql-server-ver16">Transact-SQL</a>) and <a href="https://learn.microsoft.com/en-us/sql/relational-databases/security/authentication-access/principals-database-engine?view=sql-server-ver16">Principals (Database Engine)</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="working-with-databases">2.2. Working with Databases</h3>
<div class="paragraph">
<p>Most people who work with databases use the <em>SQL Server Management Studio</em> tool. The Management Studio tool has a graphical user interface for creating databases and the objects in the databases. Management Studio also has a query editor for interacting with databases by writing Transact-SQL statements. Management Studio can be installed from the SQL Server installation disk, or downloaded from MSDN. For more information about SQL Server Management Studio tool, see <a href="https://learn.microsoft.com/en-us/sql/ssms/sql-server-management-studio-ssms?view=sql-server-ver16">SQL Server Management Studio (SSMS)</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="system-databases">2.3. System Databases</h3>
<div class="paragraph">
<p>SQL Server includes the following system databases.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System database</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://learn.microsoft.com/en-us/sql/relational-databases/databases/master-database?view=sql-server-ver16">master Database</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Records all the system-level information for an instance of SQL Server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://learn.microsoft.com/en-us/sql/relational-databases/databases/msdb-database?view=sql-server-ver16">msdb Database</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is used by SQL Server Agent for scheduling alerts and jobs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://learn.microsoft.com/en-us/sql/relational-databases/databases/model-database?view=sql-server-ver16">model Database</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is used as the template for all databases created on the instance of SQL Server. Modifications made to the model database, such as database size, collation, recovery model, and other database options, are applied to any databases created afterward.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://learn.microsoft.com/en-us/sql/relational-databases/databases/resource-database?view=sql-server-ver16">Resource Database</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is a read-only database that contains system objects that are included with SQL Server. System objects are physically persisted in the Resource database, but they logically appear in the sys schema of every database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://learn.microsoft.com/en-us/sql/relational-databases/databases/tempdb-database?view=sql-server-ver16">tempdb Database</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is a workspace for holding temporary objects or intermediate result sets.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Azure SQL Database single databases and elastic pools, only <em>master</em> Database and <em>tempdb</em> Database apply.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="master-database">2.3.1. master Database</h4>
<div class="paragraph">
<p>The <em>master database</em> records all the system-level information for a SQL Server system. This includes instance-wide metadata such as logon accounts, endpoints, linked servers, and system configuration settings.</p>
</div>
<div class="paragraph">
<p>In SQL Server, system objects are no longer stored in the <em>master</em> database; instead, they are stored in the <em>Resource database</em>.</p>
</div>
<div class="paragraph">
<p>Also, <em>master</em> is the database that records the existence of all other databases and the location of those database files and records the initialization information for SQL Server. Therefore, SQL Server cannot start if the master database is unavailable.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="contained-databases">2.4. Contained Databases</h3>
<div class="paragraph">
<p>A <em>contained database</em> is a database that is isolated from other databases and from the instance of SQL Server that hosts the database. SQL Server helps user to isolate their database from the instance in 4 ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Much of the metadata that describes a database is maintained in the database. (In addition to, or instead of, maintaining metadata in the master database.)</p>
</li>
<li>
<p>All metadata are defined using the same collation.</p>
</li>
<li>
<p>User authentication can be performed by the database, reducing the databases dependency on the logins of the instance of SQL Server.</p>
</li>
<li>
<p>The SQL Server environment (DMV&#8217;s, XEvents, etc.) reports and can act upon containment information.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="database-files-and-filegroups">2.5. Database Files and Filegroups</h3>
<div class="paragraph">
<p>At a minimum, every SQL Server database has two operating system files: a <em>data file</em> and a <em>log file</em>. Data files contain data and objects such as tables, indexes, stored procedures, and views. Log files contain the information that is required to recover all transactions in the database. Data files can be grouped together in filegroups for allocation and administration purposes.</p>
</div>
<div class="sect3">
<h4 id="database-files">2.5.1. Database Files</h4>
<div class="paragraph">
<p>SQL Server databases have three types of files, as shown in the following table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains startup information for the database and points to the other files in the database. Every database has one primary data file. The recommended file name extension for primary data files is <em>.mdf</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secondary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional user-defined data files. Data can be spread across multiple disks by putting each file on a different disk drive. The recommended file name extension for secondary data files is <em>.ndf</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction Log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The log holds information used to recover the database. There must be at least one log file for each database. The recommended file name extension for transaction logs is <em>.ldf</em>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, a simple database named <strong>Sales</strong> has one primary file that contains all data and objects and a log file that contains the transaction log information. A more complex database named <strong>Orders</strong> can be created that includes one primary file and five secondary files. The data and objects within the database spread across all six files, and the four log files contain the transaction log information.</p>
</div>
<div class="paragraph">
<p>By default, the data and transaction logs are put on the same drive and path to handle single-disk systems. This choice may not be optimal for production environments. We recommend that you <em>put data and log files on separate disks</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="logical-and-physical-file-names">2.5.2. Logical and Physical File Names</h4>
<div class="paragraph">
<p>SQL Server files have two file name types:</p>
</div>
<div class="paragraph">
<p><strong>logical_file_name</strong>: The <em>logical_file_name</em> is the name used to refer to the physical file in all Transact-SQL statements. The logical file name must comply with the rules for SQL Server identifiers and must be unique among logical file names in the database.</p>
</div>
<div class="paragraph">
<p><strong>os_file_name</strong>: The <em>os_file_name</em> is the name of the physical file including the directory path. It must follow the rules for the operating system file names.</p>
</div>
<div class="paragraph">
<p>When multiple instances of SQL Server are running on a single computer, each instance receives a different default directory to hold the files for the databases created in the instance. For more information, see <a href="https://learn.microsoft.com/en-us/sql/sql-server/install/file-locations-for-default-and-named-instances-of-sql-server?view=sql-server-ver16">File Locations for Default and Named Instances of SQL Server</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="database-engine-permissions-and-principals">3. Database Engine Permissions and Principals</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>Permissions</em> in the Database Engine are managed at the <em>server level</em> through <em>logins</em> and <em>server roles</em>, and at the <em>database level</em> through <em>database users</em> and <em>database roles</em>. The model for SQL Database exposes the same system within each database, but the server level permissions aren&#8217;t available.</p>
</div>
<div class="sect2">
<h3 id="security-principals">3.1. Security principals</h3>
<div class="paragraph">
<p><em>Security principal</em> is the official name of the identities that use SQL Server and that can be assigned permission to take actions. They are usually people or groups of people, but can be other entities that pretend to be people.</p>
</div>
<div class="paragraph">
<p>The security principals can be created and managed using the Transact-SQL listed, or by using SQL Server Management Studio.</p>
</div>
<div class="sect3">
<h4 id="logins">3.1.1. Logins</h4>
<div class="paragraph">
<p><em>Logins</em> are individual user accounts for logging on to the SQL Server Database Engine. SQL Server and SQL Database support logins based on <em>Windows authentication</em> and logins based on <em>SQL Server authentication</em>.</p>
</div>
<div class="paragraph">
<p>For information about the two types of logins, see <a href="https://learn.microsoft.com/en-us/sql/relational-databases/security/choose-an-authentication-mode?view=sql-server-ver16">Choose an Authentication Mode</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="fixed-server-roles">3.1.2. Fixed server roles</h4>
<div class="paragraph">
<p>In SQL Server, <em>fixed server roles</em> are a set of pre-configured roles that provide convenient group of server-level permissions. Logins can be added to the roles using the <code>ALTER SERVER ROLE &#8230;&#8203; ADD MEMBER</code> statement.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://learn.microsoft.com/en-us/sql/t-sql/statements/alter-server-role-transact-sql?view=sql-server-ver16">ALTER SERVER ROLE (Transact-SQL)</a>.</p>
</div>
<div class="paragraph">
<p>SQL Database doesn&#8217;t support the fixed server roles, but has two roles in the <code>master</code> database (<code>dbmanager</code> and <code>loginmanager</code>) that act like server roles.</p>
</div>
</div>
<div class="sect3">
<h4 id="user-defined-server-roles">3.1.3. User-defined server roles</h4>
<div class="paragraph">
<p>In SQL Server, you can create your own server roles and assign server-level permissions to them. Logins can be added to the server roles using the <code>ALTER SERVER ROLE &#8230;&#8203; ADD MEMBER</code> statement.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://learn.microsoft.com/en-us/sql/t-sql/statements/alter-server-role-transact-sql?view=sql-server-ver16">ALTER SERVER ROLE (Transact-SQL)</a>.</p>
</div>
<div class="paragraph">
<p>SQL Database doesn&#8217;t support the user-defined server roles.</p>
</div>
</div>
<div class="sect3">
<h4 id="database-users">3.1.4. Database users</h4>
<div class="paragraph">
<p>Logins are granted access to a database by creating a <em>database user</em> in a database and mapping that database user to sign in. Typically the database user name is the same as the login name, though it doesn&#8217;t have to be the same.</p>
</div>
<div class="paragraph">
<p>Each database user maps to a single login. A login can be mapped to only one user in a database, but can be mapped as a database user in several different databases.</p>
</div>
<div class="paragraph">
<p>Database users can also be created that don&#8217;t have a corresponding login. These users are called <em>contained database users</em>. Microsoft encourages the use of contained database users because it makes it easier to move your database to a different server. Like a login, a contained database user can use either Windows authentication or SQL Server authentication. For more information, see <a href="https://learn.microsoft.com/en-us/sql/relational-databases/security/contained-database-users-making-your-database-portable?view=sql-server-ver16">Contained Database Users - Making Your Database Portable</a>.</p>
</div>
<div class="paragraph">
<p>There are 12 types of users with slight differences in how they authenticate, and who they represent. To see a list of users, see <a href="https://learn.microsoft.com/en-us/sql/t-sql/statements/create-user-transact-sql?view=sql-server-ver16">CREATE USER (Transact-SQL)</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="fixed-database-roles">3.1.5. Fixed database roles</h4>
<div class="paragraph">
<p><em>Fixed database roles</em> are a set of pre-configured roles that provide convenient group of database-level permissions. Database users and user-defined database roles can be added to the fixed database roles using the <code>ALTER ROLE &#8230;&#8203; ADD MEMBER</code> statement.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://learn.microsoft.com/en-us/sql/t-sql/statements/alter-role-transact-sql?view=sql-server-ver16">ALTER ROLE (Transact-SQL)</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="user-defined-database-roles">3.1.6. User-defined database roles</h4>
<div class="paragraph">
<p>Users with the <code>CREATE ROLE</code> permission can create new <em>user-defined database roles</em> to represent groups of users with common permissions. Typically permissions are granted or denied to the entire role, simplifying permissions management and monitoring. Database users can be added to the database roles by using the <code>ALTER ROLE &#8230;&#8203; ADD MEMBER</code> statement.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://learn.microsoft.com/en-us/sql/t-sql/statements/alter-role-transact-sql?view=sql-server-ver16">ALTER ROLE (Transact-SQL)</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="other-principals">3.1.7. Other principals</h4>
<div class="paragraph">
<p>Additional security principals not discussed here include application roles, and logins and users based on certificates or asymmetric keys.</p>
</div>
<div class="paragraph">
<p>For a graphic showing the relationships between Windows users, Windows groups, logins, and database users, see <a href="https://learn.microsoft.com/en-us/sql/relational-databases/security/authentication-access/create-a-database-user?view=sql-server-ver16">Create a Database User</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assign-permissions">3.2. Assign permissions</h3>
<div class="paragraph">
<p>Most permission statements have the format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">AUTHORIZATION</span> <span class="n">PERMISSION</span> <span class="k">ON</span> <span class="n">SECURABLE</span><span class="p">::</span><span class="n">NAME</span> <span class="k">TO</span> <span class="n">PRINCIPAL</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AUTHORIZATION</code> must be <code>GRANT</code>, <code>REVOKE</code> or <code>DENY</code>.</p>
</li>
<li>
<p>The <code>PERMISSION</code> establishes what action is allowed or prohibited. The exact number of permissions differs between SQL Server and SQL Database. The permissions are listed in the article <a href="https://learn.microsoft.com/en-us/sql/relational-databases/security/permissions-database-engine?view=sql-server-ver16">Permissions (Database Engine)</a> and in the chart referenced below.</p>
</li>
<li>
<p><code>ON SECURABLE::NAME</code> is the type of securable (server, server object, database, or database object) and its name.</p>
<div class="paragraph">
<p>Some permissions don&#8217;t require <code>ON SECURABLE::NAME</code> because it is unambiguous or inappropriate in the context. For example, the <code>CREATE TABLE</code> permission doesn&#8217;t require the <code>ON SECURABLE::NAME</code> clause (<code>GRANT CREATE TABLE TO Mary</code>; allows Mary to create tables).</p>
</div>
</li>
<li>
<p><code>PRINCIPAL</code> is the security principal (login, user, or role) which receives or loses the permission. Grant permissions to roles whenever possible.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example grant statement, grants the <code>UPDATE</code> permission on the <code>Parts</code> table or view that is contained in the <code>Production</code> schema to the role named <code>PartsTeam</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">GRANT</span> <span class="k">UPDATE</span> <span class="k">ON</span> <span class="k">OBJECT</span><span class="p">::</span><span class="n">Production</span><span class="p">.</span><span class="n">Parts</span> <span class="k">TO</span> <span class="n">PartsTeam</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example grant statement grants the <code>UPDATE</code> permission on the <code>Production</code> schema, and by extension on any table or view contained within this schema to the role named <code>ProductionTeam</code>, which is a more effective and salable approach to assigning permissions than on individual object-level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">GRANT</span> <span class="k">UPDATE</span> <span class="k">ON</span> <span class="k">SCHEMA</span><span class="p">::</span><span class="n">Production</span> <span class="k">TO</span> <span class="n">ProductionTeam</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Permissions are granted to security principals (logins, users, and roles) by using the <code>GRANT</code> statement. Permissions are explicitly denied by using the <code>DENY</code> command. A previously granted or denied permission is removed by using the <code>REVOKE</code> statement. Permissions are cumulative, with the user receiving all the permissions granted to the user, login, and any group memberships; however any permission denial overrides all grants.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A common mistake is to attempt to remove a <code>GRANT</code> by using <code>DENY</code> instead of <code>REVOKE</code>. This can cause problems when a user receives permissions from multiple sources; which is quite common. The following example demonstrates the principal.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Sales group receives <code>SELECT</code> permissions on the OrderStatus table through the statement <code>GRANT SELECT ON OBJECT::OrderStatus TO Sales;</code>. User Jae is a member of the Sales role. Jae has also been granted <code>SELECT</code> permission to the <code>OrderStatus</code> table under their own user name through the statement <code>GRANT SELECT ON OBJECT::OrderStatus TO Jae</code>;. Presume the administer wishes to remove the <code>GRANT</code> to the Sales role.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the administrator correctly executes <code>REVOKE SELECT ON OBJECT::OrderStatus TO Sales</code>;, then Jae will retain <code>SELECT</code> access to the OrderStatus table through their individual <code>GRANT</code> statement.</p>
</li>
<li>
<p>If the administrator incorrectly executes <code>DENY SELECT ON OBJECT::OrderStatus TO Sales;</code> then Jae, as a member of the Sales role, will be denied the <code>SELECT</code> permission because the <code>DENY</code> to Sales overrides their individual <code>GRANT</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Permissions can be configured using Management Studio. Find the securable in Object Explorer, right-click the securable, and then select <strong>Properties</strong>. Select the <strong>Permissions</strong> page.</p>
</div>
<div class="paragraph">
<p>For help on using the permission page, see <a href="https://learn.microsoft.com/en-us/sql/relational-databases/security/permissions-or-securables-page?view=sql-server-ver16">Permissions or Securables Page</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="permission-hierarchy">3.3. Permission hierarchy</h3>
<div class="paragraph">
<p>Permissions have a parent/child hierarchy. That is, if you grant <em>SELECT</em> permission on a database, that permission includes <em>SELECT</em> permission on all (child) schemas in the database. If you grant <em>SELECT</em> permission on a schema, it includes <em>SELECT</em> permission on all the (child) tables and views in the schema. The permissions are transitive; that is, if you grant <em>SELECT</em> permission on a database, it includes <em>SELECT</em> permission on all (child) schemas, and all (grandchild) tables and views.</p>
</div>
<div class="paragraph">
<p>Permissions also have covering permissions. The <em>CONTROL</em> permission on an object, normally gives you all other permissions on the object.</p>
</div>
<div class="paragraph">
<p>Because both the parent/child hierarchy and the covering hierarchy can act on the same permission, the permission system can get complicated. For example, let&#8217;s take a table (Region), in a schema (Customers), in a database (SalesDB).</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CONTROL</code> permission on table Region includes all the other permissions on the table Region, including <code>ALTER</code>, <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, and some other permissions.</p>
</li>
<li>
<p><code>SELECT</code> on the Customers schema that owns the Region table includes the <code>SELECT</code> permission on the Region table.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So <code>SELECT</code> permission on the Region table can be achieved through any of these six statements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">OBJECT</span><span class="p">::</span><span class="n">Region</span> <span class="k">TO</span> <span class="n">Jae</span><span class="p">;</span>

<span class="k">GRANT</span> <span class="n">CONTROL</span> <span class="k">ON</span> <span class="k">OBJECT</span><span class="p">::</span><span class="n">Region</span> <span class="k">TO</span> <span class="n">Jae</span><span class="p">;</span>

<span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">SCHEMA</span><span class="p">::</span><span class="n">Customers</span> <span class="k">TO</span> <span class="n">Jae</span><span class="p">;</span>

<span class="k">GRANT</span> <span class="n">CONTROL</span> <span class="k">ON</span> <span class="k">SCHEMA</span><span class="p">::</span><span class="n">Customers</span> <span class="k">TO</span> <span class="n">Jae</span><span class="p">;</span>

<span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="k">DATABASE</span><span class="p">::</span><span class="n">SalesDB</span> <span class="k">TO</span> <span class="n">Jae</span><span class="p">;</span>

<span class="k">GRANT</span> <span class="n">CONTROL</span> <span class="k">ON</span> <span class="k">DATABASE</span><span class="p">::</span><span class="n">SalesDB</span> <span class="k">TO</span> <span class="n">Jae</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="monitor-permissions">3.4. Monitor permissions</h3>
<div class="paragraph">
<p>The following views return security information.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The logins and user-defined server roles on a server can be examined by using the <code>sys.server_principals</code> view. This view isn&#8217;t available in SQL Database.</p>
</li>
<li>
<p>The users and user-defined roles in a database can be examined by using the <code>sys.database_principals</code> view.</p>
</li>
<li>
<p>The permissions granted to logins and user-defined fixed server roles can be examined by using the <code>sys.server_permissions</code> view. This view isn&#8217;t available in SQL Database.</p>
</li>
<li>
<p>The permissions granted to users and user-defined fixed database roles can be examined by using the <code>sys.database_permissions</code> view.</p>
</li>
<li>
<p>Database role membership can be examined by using the <code>sys.database_role_members</code> view.</p>
</li>
<li>
<p>Server role membership can be examined by using the <code>sys.server_role_members</code> view. This view isn&#8217;t available in SQL Database.</p>
</li>
<li>
<p>For additional security related views, see <a href="https://learn.microsoft.com/en-us/sql/relational-databases/system-catalog-views/security-catalog-views-transact-sql?view=sql-server-ver16">Security Catalog Views (Transact-SQL)</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="principals-database-engine">3.5. Principals (Database Engine)</h3>
<div class="paragraph">
<p><em>Principals</em> are entities that can request SQL Server resources. Like other components of the SQL Server authorization model, principals can be arranged in a hierarchy. The scope of influence of a principal depends on the scope of the definition of the principal: Windows, server, database; and whether the principal is indivisible or a collection. A <em>Windows Login</em> is an example of an indivisible principal, and a <em>Windows Group</em> is an example of a principal that is a collection. Every principal has a <em>security identifier (SID)</em>.</p>
</div>
<div class="sect3">
<h4 id="sql-server-level-principals">3.5.1. SQL Server-level principals</h4>
<div class="ulist">
<ul>
<li>
<p>SQL Server authentication Login</p>
</li>
<li>
<p>Windows authentication login for a Windows user</p>
</li>
<li>
<p>Windows authentication login for a Windows group</p>
</li>
<li>
<p>Azure Active Directory authentication login for a AD user</p>
</li>
<li>
<p>Azure Active Directory authentication login for a AD group</p>
</li>
<li>
<p>Server Role</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="database-level-principals">3.5.2. Database-level principals</h4>
<div class="ulist">
<ul>
<li>
<p>Database User (There are 12 types of users. For more information, see CREATE USER.)</p>
</li>
<li>
<p>Database Role</p>
</li>
<li>
<p>Application Role</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sa-login">3.5.3. sa Login</h4>
<div class="paragraph">
<p>The SQL Server <code>sa</code> login is a server-level principal. By default, it is created when an instance is installed.</p>
</div>
<div class="paragraph">
<p>Beginning in SQL Server 2005 (9.x), the default database of sa is master. This is a change of behavior from earlier versions of SQL Server.</p>
</div>
<div class="paragraph">
<p>The <code>sa</code> login is a member of the <code>sysadmin</code> fixed server-level role.</p>
</div>
<div class="paragraph">
<p>The <code>sa</code> login has all permissions on the server and cannot be limited.</p>
</div>
<div class="paragraph">
<p>The <code>sa</code> login cannot be dropped, but it can be disabled so that no one can use it.</p>
</div>
</div>
<div class="sect3">
<h4 id="dbo-user-and-dbo-schema">3.5.4. dbo User and dbo Schema</h4>
<div class="paragraph">
<p>The <code>dbo</code> user is a special user principal in each database.</p>
</div>
<div class="paragraph">
<p>All SQL Server administrators, members of the <code>sysadmin</code> fixed server role, <code>sa</code> login, and owners of the database, enter databases as the <code>dbo</code> user.</p>
</div>
<div class="paragraph">
<p>The <code>dbo</code> user has all permissions in the database and cannot be limited or dropped.</p>
</div>
<div class="paragraph">
<p><code>dbo</code> stands for database owner, but the <code>dbo</code> user account is not the same as the <code>db_owner</code> fixed database role, and the <code>db_owner</code> fixed database role is not the same as the user account that is recorded as the owner of the database.</p>
</div>
<div class="paragraph">
<p>The <code>dbo</code> user owns the <code>dbo</code> schema. The <code>dbo</code> schema is the default schema for all users, unless some other schema is specified. The <code>dbo</code> schema cannot be dropped.</p>
</div>
</div>
<div class="sect3">
<h4 id="public-server-role-and-database-role">3.5.5. public Server Role and Database Role</h4>
<div class="paragraph">
<p>Every login belongs to the <code>public</code> fixed server role, and every database user belongs to the <code>public</code> database role.</p>
</div>
<div class="paragraph">
<p>When a login or user has not been granted or denied specific permissions on a securable, the login or user inherits the permissions granted to public on that securable.</p>
</div>
<div class="paragraph">
<p>The <code>public</code> fixed server role and the <code>public</code> fixed database role cannot be dropped. However you can revoke permissions from the <code>public</code> roles.</p>
</div>
<div class="paragraph">
<p>There are many permissions that are assigned to the <code>public</code> roles by default. Most of these permissions are needed for routine operations in the database; the type of things that everyone should be able to do.</p>
</div>
<div class="paragraph">
<p>Be careful when revoking permissions from the public login or user, as it will affect all logins/users. Generally you should not deny permissions to public, because the deny statement overrides any grant statements you might make to individuals.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sql-and-t-sql">4. SQL and T-SQL</h2>
<div class="sectionbody">
<div class="quoteblock">
<div class="title">SQL, From Wikipedia, the free encyclopedia, <a href="https://en.wikipedia.org/wiki/SQL" class="bare">https://en.wikipedia.org/wiki/SQL</a></div>
<blockquote>
<div class="paragraph">
<p><strong>Structured Query Language</strong>, abbreviated as <strong>SQL</strong> (/ËŒÉ›sËŒkjuËËˆÉ›l/ ) <em>S-Q-L</em>, sometimes /ËˆsiËkwÉ™l/ "sequel" for historical reasons), is a domain-specific language used in programming and designed for managing data held in a relational database management system (RDBMS), or for stream processing in a relational data stream management system (RDSMS). It is particularly useful in handling structured data, i.e. data incorporating relations among entities and variables.</p>
</div>
</blockquote>
</div>
<div class="quoteblock">
<div class="title">Transact-SQL, From Wikipedia, the free encyclopedia, <a href="https://en.wikipedia.org/wiki/Transact-SQL" class="bare">https://en.wikipedia.org/wiki/Transact-SQL</a></div>
<blockquote>
<div class="paragraph">
<p>Transact-SQL (T-SQL) is Microsoft&#8217;s and Sybase&#8217;s proprietary extension to the SQL (Structured Query Language) used to interact with relational databases. T-SQL expands on the SQL standard to include procedural programming, local variables, various support functions for string processing, date processing, mathematics, etc. and changes to the DELETE and UPDATE statements.</p>
</div>
<div class="paragraph">
<p>Transact-SQL is central to using Microsoft SQL Server. All applications that communicate with an instance of SQL Server do so by sending Transact-SQL statements to the server, regardless of the user interface of the application.</p>
</div>
<div class="paragraph">
<p>Stored procedures in SQL Server are executable server-side routines. The advantage of stored procedures is the ability to pass parameters.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sql-server-utilities-statements-go">5. SQL Server Utilities Statements - GO</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SQL Server provides commands that are not Transact-SQL statements, but are recognized by the <strong>sqlcmd</strong> and <strong>osql</strong> utilities and SQL Server Management Studio Code Editor. These commands can be used to facilitate the readability and execution of batches and scripts.</p>
</div>
<div class="paragraph">
<p><code>GO</code> signals the end of a batch of Transact-SQL statements to the SQL Server utilities.</p>
</div>
<div class="paragraph">
<p><strong>Syntax</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">GO</span> <span class="p">[</span><span class="k">count</span><span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Arguments</strong></p>
</div>
<div class="paragraph">
<p><em>count</em></p>
</div>
<div class="paragraph">
<p>Is a positive integer. The batch preceding GO will execute the specified number of times.</p>
</div>
<div class="paragraph">
<p><strong>Remarks</strong></p>
</div>
<div class="paragraph">
<p><code>GO</code> is not a Transact-SQL statement; it is a command recognized by the <strong>sqlcmd</strong> and <strong>osql</strong> utilities and SQL Server Management Studio Code editor.</p>
</div>
<div class="paragraph">
<p>SQL Server utilities interpret <code>GO</code> as a signal that they should send the current batch of Transact-SQL statements to an instance of SQL Server. The current batch of statements is composed of all statements entered since the last <code>GO</code>, or since the start of the ad hoc session or script if this is the first <code>GO</code>.</p>
</div>
<div class="paragraph">
<p>A Transact-SQL statement cannot occupy the same line as a <code>GO</code> command. However, the line can contain comments.</p>
</div>
<div class="paragraph">
<p>Users must follow the rules for batches. For example, any execution of a stored procedure after the first statement in a batch must include the <code>EXECUTE</code> keyword. The scope of local (user-defined) variables is limited to a batch, and cannot be referenced after a <code>GO</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="n">USE</span> <span class="n">AdventureWorks2012</span><span class="p">;</span>
<span class="k">GO</span>
<span class="k">DECLARE</span> <span class="o">@</span><span class="n">MyMsg</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="o">@</span><span class="n">MyMsg</span> <span class="o">=</span> <span class="s1">'Hello, World.'</span>
<span class="k">GO</span> <span class="c1">-- @MyMsg is not valid after this GO ends the batch.</span>

<span class="c1">-- Yields an error because @MyMsg not declared in this batch.</span>
<span class="n">PRINT</span> <span class="o">@</span><span class="n">MyMsg</span>
<span class="k">GO</span>

<span class="k">SELECT</span> <span class="o">@@</span><span class="k">VERSION</span><span class="p">;</span>
<span class="c1">-- Yields an error: Must be EXEC sp_who if not first statement in</span>
<span class="c1">-- batch.</span>
<span class="n">sp_who</span>
<span class="k">GO</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>SQL Server applications can send multiple Transact-SQL statements to an instance of SQL Server for execution as a batch. The statements in the batch are then compiled into a single <em>execution plan</em>. Programmers executing ad hoc statements in the SQL Server utilities, or building scripts of Transact-SQL statements to run through the SQL Server utilities, use <code>GO</code> to signal the end of a batch.</p>
</div>
<div class="paragraph">
<p>Applications based on the ODBC or OLE DB APIs receive a syntax error if they try to execute a <code>GO</code> command. The SQL Server utilities never send a <code>GO</code> command to the server.</p>
</div>
<div class="paragraph">
<p>Do not use a semicolon as a statement terminator after <code>GO</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Yields an error because ; is not permitted after GO</span>
<span class="k">SELECT</span> <span class="o">@@</span><span class="k">VERSION</span><span class="p">;</span>
<span class="k">GO</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transact-sql-syntax-conventions-transact-sql">6. Transact-SQL syntax conventions (Transact-SQL)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following table lists and describes conventions that are used in the syntax diagrams in the Transact-SQL reference.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Convention</th>
<th class="tableblock halign-left valign-top">Used for</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UPPERCASE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transact-SQL keywords.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>italic</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User-supplied parameters of Transact-SQL syntax.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>bold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type database names, table names, column names, index names, stored procedures, utilities, data type names, and text exactly as shown.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">| (vertical bar)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Separates syntax items enclosed in brackets or braces. You can use only one of the items.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[ ] (brackets)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional syntax item.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{ } (braces)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required syntax items. Don&#8217;t type the braces.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[ , &#8230;&#8203;n ]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the preceding item can be repeated n number of times. The occurrences are separated by commas.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">[ &#8230;&#8203;n ]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the preceding item can be repeated n number of times. The occurrences are separated by blanks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transact-SQL statement terminator. Although the semicolon isn&#8217;t required for most statements in this version of SQL Server, it will be required in a future version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">::=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name for a block of syntax. Use this convention to group and label sections of lengthy syntax or a unit of syntax that you can use in more than one location within a statement. Each location in which the block of syntax could be used is indicated with the label enclosed in chevrons: &lt;label&gt;.</p>
<p class="tableblock">A set is a collection of expressions, for example &lt;grouping set&gt;; and a list is a collection of sets, for example &lt;composite element list&gt;.</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="multipart-names">6.1. Multipart names</h3>
<div class="paragraph">
<p>Unless specified otherwise, all Transact-SQL references to the name of a database object can be a four-part name in the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre><em>server_name.[database_name].[schema_name].object_name</em>

<em>| database_name.[schema_name].object_name</em>

<em>| schema_name.object_name</em>

<em>| object_name</em></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>server_name</p>
<div class="paragraph">
<p>Specifies a linked server name or remote server name.</p>
</div>
</li>
<li>
<p>database_name</p>
<div class="paragraph">
<p>Specifies the name of a SQL Server database when the object resides in a local instance of SQL Server. When the object is in a linked server, database_name specifies an OLE DB catalog.</p>
</div>
</li>
<li>
<p>schema_name</p>
<div class="paragraph">
<p>Specifies the name of the schema that contains the object if the object is in a SQL Server database. When the object is in a linked server, schema_name specifies an OLE DB schema name.</p>
</div>
</li>
<li>
<p>object_name</p>
<div class="paragraph">
<p>Refers to the name of the object.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When referencing a specific object, you don&#8217;t always have to specify the server, database, and schema for the SQL Server Database Engine to identify the object. However, if the object can&#8217;t be found, an error is returned.</p>
</div>
<div class="paragraph">
<p>To avoid name resolution errors, we recommend specifying the schema name whenever you specify a schema-scoped object.</p>
</div>
<div class="paragraph">
<p>To omit intermediate nodes, use periods to indicate these positions. The following table shows the valid formats of object names.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Object reference format</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>server_name.database_name.schema_name.object_name</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Four-part name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>server_name.database_name..object_name</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Schema name is omitted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>server_name..schema_name.object_name</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database name is omitted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>server_name&#8230;&#8203;object_name</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database and schema name are omitted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>database_name.schema_name.object_name</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server name is omitted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>database_name..object_name</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and schema name are omitted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>schema_name.object_name</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and database name are omitted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>object_name</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server, database, and schema name are omitted.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">@@</span><span class="n">SERVERNAME</span><span class="p">;</span> <span class="c1">-- 8a90e1fbcc1b</span>
<span class="k">SELECT</span> <span class="n">name</span> <span class="k">FROM</span> <span class="p">[</span><span class="mi">8</span><span class="n">a90e1fbcc1b</span><span class="p">].[</span><span class="n">master</span><span class="p">].[</span><span class="n">sys</span><span class="p">].[</span><span class="n">servers</span><span class="p">];</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tutorial-write-transact-sql-statements">7. Tutorial: Write Transact-SQL statements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This tutorial is intended as a brief introduction to the Transact-SQL language and not as a replacement for a Transact-SQL class. The statements in this tutorial are intentionally simple, and aren&#8217;t meant to represent the complexity found in a typical production database.</p>
</div>
<div class="sect2">
<h3 id="lesson-1-create-and-query-database-objects">7.1. Lesson 1: Create and query database objects</h3>
<div class="paragraph">
<p>Transact-SQL statements can be written and submitted to the Database Engine in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By using SQL Server Management Studio.</p>
</li>
<li>
<p>By using the <strong>sqlcmd</strong> utility.</p>
</li>
<li>
<p>By connecting from an application that you create.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="create-a-database">7.1.1. Create a database</h4>
<div class="paragraph">
<p>Like many Transact-SQL statements, the <a href="https://learn.microsoft.com/en-us/sql/t-sql/statements/create-database-transact-sql?view=sql-server-ver16">CREATE DATABASE</a> statement has a required parameter: the name of the database.</p>
</div>
<div class="paragraph">
<p><code>CREATE DATABASE</code> also has many optional parameters, such as the disk location where you want to put the database files.</p>
</div>
<div class="paragraph">
<p>When you execute <code>CREATE DATABASE</code> without the optional parameters, SQL Server uses default values for many of these parameters.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a Query Editor window, type but don&#8217;t execute the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">TestData</span><span class="p">;</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</li>
<li>
<p>Use the pointer to select the words <code>CREATE DATABASE</code>, and then press <strong>F1</strong>.</p>
</li>
<li>
<p>In Query Editor, press <strong>F5</strong> to execute the statement and create a database named TestData.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When you create a database, SQL Server makes a copy of the <code>model</code> database, and renames the copy to the database name. This operation should only take several seconds, unless you specify a large initial size of the database as an optional parameter.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The keyword <code>GO</code> separates statements when more than one statement is submitted in a single batch. <code>GO</code> is optional when the batch contains only one statement.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="create-a-table">7.1.2. Create a Table</h4>
<div class="paragraph">
<p>To create a table, you must provide a name for the table, and the names and data types of each column in the table.</p>
</div>
<div class="paragraph">
<p>It is also a good practice to indicate whether null values are allowed in each column.</p>
</div>
<div class="paragraph">
<p>To create a table, you must have the <code>CREATE TABLE</code> permission, and the <code>ALTER SCHEMA</code> permission on the schema that will contain the table. The <a href="https://learn.microsoft.com/en-us/sql/relational-databases/security/authentication-access/database-level-roles?view=sql-server-ver16">db_ddladmin</a> fixed database role has these permissions.</p>
</div>
<div class="paragraph">
<p>Most tables have a primary key, made up of one or more columns of the table. A primary key is always unique. The Database Engine will enforce the restriction that any primary key value can&#8217;t be repeated in the table.</p>
</div>
<div class="paragraph">
<p>For a list of data types and links for a description of each, see <a href="https://learn.microsoft.com/en-us/sql/t-sql/data-types/data-types-transact-sql?view=sql-server-ver16">Data Types (Transact-SQL)</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Database Engine can be installed as case sensitive or non-case sensitive. If the Database Engine is installed as case sensitive, object names must always have the same case. For example, a table named OrderData is a different table from a table named ORDERDATA. If the Database Engine is installed as non-case sensitive, those two table names are considered to be the same table, and that name can only be used one time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="switch-the-query-editor-connection-to-the-testdata-database">7.1.2.1. Switch the Query Editor connection to the TestData database</h5>
<div class="paragraph">
<p>In a Query Editor window, type and execute the following code to change your connection to the TestData database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="n">USE</span> <span class="n">TestData</span><span class="p">;</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="create-the-table">7.1.2.2. Create the table</h5>
<div class="paragraph">
<p>In a Query Editor window, type and execute the following code to create a table named <code>Products</code>.</p>
</div>
<div class="paragraph">
<p>The columns in the table are named <code>ProductID</code>, <code>ProductName</code>, <code>Price</code>, and <code>ProductDescription</code>. The <code>ProductID</code> column is the primary key of the table. <code>int</code>, <code>varchar(25)</code>, <code>money</code>, and <code>varchar(max)</code> are all data types. Only the <code>Price</code> and <code>ProductionDescription</code> columns can have no data when a row is inserted or changed.
This statement contains an optional element (<code>dbo.</code>) called a schema. The schema is the database object that owns the table. If you are an administrator, <code>dbo</code> is the default schema. <code>dbo</code> stands for database owner.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">dbo</span><span class="p">.</span><span class="n">Products</span>
    <span class="p">(</span><span class="n">ProductID</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">ProductName</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">Price</span> <span class="n">money</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">ProductDescription</span> <span class="nb">varchar</span><span class="p">(</span><span class="k">max</span><span class="p">)</span> <span class="k">NULL</span><span class="p">);</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="insert-and-update-data-in-a-table">7.1.3. Insert and update data in a table</h4>
<div class="paragraph">
<p>Now that you have created the <code>Products</code> table, you are ready to insert data into the table by using the INSERT statement. After the data is inserted, you will change the content of a row by using an UPDATE statement. You will use the WHERE clause of the UPDATE statement to restrict the update to a single row. The four statements will enter the following data.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ProductID</th>
<th class="tableblock halign-left valign-top">ProductName</th>
<th class="tableblock halign-left valign-top">Price</th>
<th class="tableblock halign-left valign-top">ProductDescription</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12.48</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Workbench clamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Screwdriver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flat head</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">75</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tire Bar</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tool for changing tires.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bracket</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The basic syntax is: INSERT, table name, column list, VALUES, and then a list of the values to be inserted. The two hyphens in front of a line indicate that the line is a comment and the text will be ignored by the compiler. In this case, the comment describes a permissible variation of the syntax.</p>
</div>
<div class="sect4">
<h5 id="insert-data-into-a-table">7.1.3.1. Insert data into a table</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execute the following statement to insert a row into the <code>Products</code> table that was created in the previous task.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Standard syntax</span>
<span class="k">INSERT</span> <span class="n">dbo</span><span class="p">.</span><span class="n">Products</span> <span class="p">(</span><span class="n">ProductID</span><span class="p">,</span> <span class="n">ProductName</span><span class="p">,</span> <span class="n">Price</span><span class="p">,</span> <span class="n">ProductDescription</span><span class="p">)</span>
    <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'Clamp'</span><span class="p">,</span> <span class="mi">12</span><span class="p">.</span><span class="mi">48</span><span class="p">,</span> <span class="s1">'Workbench clamp'</span><span class="p">)</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the insert succeeds, proceed to the next step.</p>
</div>
<div class="paragraph">
<p>If the insert fails, it may be because the <code>Product</code> table already has a row with that product ID in it. To proceed, delete all the rows in the table and repeat the preceding step. <a href="https://learn.microsoft.com/en-us/sql/t-sql/statements/truncate-table-transact-sql?view=sql-server-ver16">TRUNCATE TABLE</a> deletes all the rows in the table.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the following command to delete all the rows in the table:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">TRUNCATE</span> <span class="k">TABLE</span> <span class="n">TestData</span><span class="p">.</span><span class="n">dbo</span><span class="p">.</span><span class="n">Products</span><span class="p">;</span>
<span class="k">GO</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After you truncate the table, repeat the INSERT command in this step.</p>
</div>
</li>
<li>
<p>The following statement shows how you can change the order in which the parameters are provided by switching the placement of the <code>ProductID</code> and <code>ProductName</code> in both the field list (in parentheses) and in the values list.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Changing the order of the columns</span>
<span class="k">INSERT</span> <span class="n">dbo</span><span class="p">.</span><span class="n">Products</span> <span class="p">(</span><span class="n">ProductName</span><span class="p">,</span> <span class="n">ProductID</span><span class="p">,</span> <span class="n">Price</span><span class="p">,</span> <span class="n">ProductDescription</span><span class="p">)</span>
    <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Screwdriver'</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">3</span><span class="p">.</span><span class="mi">17</span><span class="p">,</span> <span class="s1">'Flat head'</span><span class="p">)</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</li>
<li>
<p>The following statement demonstrates that the names of the columns are optional, as long as the values are listed in the correct order. This syntax is common but isn&#8217;t recommended because it might be harder for others to understand your code. <code>NULL</code> is specified for the <code>Price</code> column because the price for this product isn&#8217;t yet known.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Skipping the column list, but keeping the values in order</span>
<span class="k">INSERT</span> <span class="n">dbo</span><span class="p">.</span><span class="n">Products</span>
    <span class="k">VALUES</span> <span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="s1">'Tire Bar'</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="s1">'Tool for changing tires.'</span><span class="p">)</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</li>
<li>
<p>The schema name is optional as long as you are accessing and changing a table in your default schema. Because the <code>ProductDescription</code> column allows null values and no value is being provided, the ProductDescription column name and value can be dropped from the statement completely.
SQL</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Dropping the optional dbo and dropping the ProductDescription column</span>
<span class="k">INSERT</span> <span class="n">Products</span> <span class="p">(</span><span class="n">ProductID</span><span class="p">,</span> <span class="n">ProductName</span><span class="p">,</span> <span class="n">Price</span><span class="p">)</span>
    <span class="k">VALUES</span> <span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="s1">'3 mm Bracket'</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">52</span><span class="p">)</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="update-the-products-table">7.1.3.2. Update the products table</h5>
<div class="paragraph">
<p>Type and execute the following UPDATE statement to change the <code>ProductName</code> of the second product from <code>Screwdriver</code>, to <code>Flat Head Screwdriver</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">UPDATE</span> <span class="n">dbo</span><span class="p">.</span><span class="n">Products</span>
    <span class="k">SET</span> <span class="n">ProductName</span> <span class="o">=</span> <span class="s1">'Flat Head Screwdriver'</span>
    <span class="k">WHERE</span> <span class="n">ProductID</span> <span class="o">=</span> <span class="mi">50</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="read-data-from-a-table">7.1.4. Read data from a table</h4>
<div class="paragraph">
<p>Use the SELECT statement to read the data in a table. The SELECT statement is one of the most important Transact-SQL statements, and there are many variations in the syntax. For this tutorial, you will work with five simple versions.</p>
</div>
<div class="sect4">
<h5 id="read-the-data-in-a-table">7.1.4.1. Read the data in a table</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Type and execute the following statements to read the data in the <code>Products</code> table.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- The basic syntax for reading data from a single table</span>
<span class="k">SELECT</span> <span class="n">ProductID</span><span class="p">,</span> <span class="n">ProductName</span><span class="p">,</span> <span class="n">Price</span><span class="p">,</span> <span class="n">ProductDescription</span>
    <span class="k">FROM</span> <span class="n">dbo</span><span class="p">.</span><span class="n">Products</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</li>
<li>
<p>You can use an asterisk (<code>*</code>) to select all the columns in the table. The asterisk is for ad hoc queries. In permanent code, provide the column list so that the statement returns the predicted columns, even if a new column is added to the table later.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Returns all columns in the table</span>
<span class="c1">-- Does not use the optional schema, dbo</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">Products</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</li>
<li>
<p>You can omit columns that you don&#8217;t want to return. The columns will be returned in the order that they are listed.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Returns only two of the columns from the table</span>
<span class="k">SELECT</span> <span class="n">ProductName</span><span class="p">,</span> <span class="n">Price</span>
    <span class="k">FROM</span> <span class="n">dbo</span><span class="p">.</span><span class="n">Products</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</li>
<li>
<p>Use a <code>WHERE</code> clause to limit the rows that are returned to the user.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Returns only two of the records in the table</span>
<span class="k">SELECT</span> <span class="n">ProductID</span><span class="p">,</span> <span class="n">ProductName</span><span class="p">,</span> <span class="n">Price</span><span class="p">,</span> <span class="n">ProductDescription</span>
    <span class="k">FROM</span> <span class="n">dbo</span><span class="p">.</span><span class="n">Products</span>
    <span class="k">WHERE</span> <span class="n">ProductID</span> <span class="o">&lt;</span> <span class="mi">60</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</li>
<li>
<p>You can work with the values in the columns as they are returned. The following example performs a mathematical operation on the <code>Price</code> column. Columns that have been changed in this way won&#8217;t have a name unless you provide one by using the <code>AS</code> keyword.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Returns ProductName and the Price including a 7% tax</span>
<span class="c1">-- Provides the name CustomerPays for the calculated column</span>
<span class="k">SELECT</span> <span class="n">ProductName</span><span class="p">,</span> <span class="n">Price</span> <span class="o">*</span> <span class="mi">1</span><span class="p">.</span><span class="mi">07</span> <span class="k">AS</span> <span class="n">CustomerPays</span>
    <span class="k">FROM</span> <span class="n">dbo</span><span class="p">.</span><span class="n">Products</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="useful-functions-in-a-select-statement">7.1.4.2. Useful functions in a SELECT statement</h5>
<div class="paragraph">
<p>For information about some functions that you can use to work with data in SELECT statements, see the following articles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/sql/t-sql/functions/string-functions-transact-sql?view=sql-server-ver16">String Functions (Transact-SQL)</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/sql/t-sql/functions/date-and-time-data-types-and-functions-transact-sql?view=sql-server-ver16">Date and Time Data Types and Functions (Transact-SQL)</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/sql/t-sql/functions/mathematical-functions-transact-sql?view=sql-server-ver16">Mathematical Functions (Transact-SQL)</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/sql/t-sql/functions/text-and-image-functions-textptr-transact-sql?view=sql-server-ver16">Text and Image Functions (Transact-SQL)</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-views-and-stored-procedures">7.1.5. Create views and stored procedures</h4>
<div class="paragraph">
<p>A view is a stored SELECT statement, and a stored procedure is one or more Transact-SQL statements that execute as a batch.</p>
</div>
<div class="paragraph">
<p>Views are queried like tables and don&#8217;t accept parameters. Stored procedures are more complex than views. Stored procedures can have both input and output parameters and can contain statements to control the flow of the code, such as IF and WHILE statements. It is good programming practice to use stored procedures for all repetitive actions in the database.</p>
</div>
<div class="paragraph">
<p>For this example, you will use CREATE VIEW to create a view that selects only two of the columns in the <code>Products</code> table. Then, you will use CREATE PROCEDURE to create a stored procedure that accepts a price parameter and returns only those products that cost less than the specified parameter value.</p>
</div>
<div class="sect4">
<h5 id="create-a-view">7.1.5.1. Create a view</h5>
<div class="paragraph">
<p>Execute the following statement to create a view that executes a select statement, and returns the names and prices of our products to the user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">vw_Names</span>
   <span class="k">AS</span>
   <span class="k">SELECT</span> <span class="n">ProductName</span><span class="p">,</span> <span class="n">Price</span> <span class="k">FROM</span> <span class="n">Products</span><span class="p">;</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="test-the-view">7.1.5.2. Test the view</h5>
<div class="paragraph">
<p>Views are treated just like tables. Use a <code>SELECT</code> statement to access a view.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">vw_Names</span><span class="p">;</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="create-a-stored-procedure">7.1.5.3. Create a stored procedure</h5>
<div class="paragraph">
<p>The following statement creates a stored procedure name <code>pr_Names</code>, accepts an input parameter named <code>@VarPrice</code> of data type <code>money</code>. The stored procedure prints the statement <code>Products less than</code> concatenated with the input parameter that is changed from the <code>money</code> data type into a <code>varchar(10)</code> character data type. Then, the procedure executes a <code>SELECT</code> statement on the view, passing the input parameter as part of the <code>WHERE</code> clause. This returns all products that cost less than the input parameter value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">pr_Names</span> <span class="o">@</span><span class="n">VarPrice</span> <span class="n">money</span>
   <span class="k">AS</span>
   <span class="k">BEGIN</span>
      <span class="c1">-- The print statement returns text to the user</span>
      <span class="n">PRINT</span> <span class="s1">'Products less than '</span> <span class="o">+</span> <span class="k">CAST</span><span class="p">(</span><span class="o">@</span><span class="n">VarPrice</span> <span class="k">AS</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
      <span class="c1">-- A second statement starts here</span>
      <span class="k">SELECT</span> <span class="n">ProductName</span><span class="p">,</span> <span class="n">Price</span> <span class="k">FROM</span> <span class="n">vw_Names</span>
            <span class="k">WHERE</span> <span class="n">Price</span> <span class="o">&lt;</span> <span class="o">@</span><span class="n">VarPrice</span><span class="p">;</span>
   <span class="k">END</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="test-the-stored-procedure">7.1.5.4. Test the stored procedure</h5>
<div class="paragraph">
<p>To test the stored procedure, type and execute the following statement. The procedure should return the names of the two products entered into the <code>Products</code> table in Lesson 1 with a price that is less than <code>10.00</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">EXECUTE</span> <span class="n">pr_Names</span> <span class="mi">10</span><span class="p">.</span><span class="mi">00</span><span class="p">;</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lesson-2-configure-permissions-on-database-objects">7.2. Lesson 2: Configure permissions on database objects</h3>
<div class="paragraph">
<p>Granting a user access to a database involves three steps.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, you create a login. The login lets the user connect to the SQL Server Database Engine.</p>
</li>
<li>
<p>Then you configure the login as a user in the specified database.</p>
</li>
<li>
<p>And finally, you grant that user permission to database objects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This lesson shows you these three steps, and shows you how to create a view and a stored procedure as the object.</p>
</div>
<div class="sect3">
<h4 id="create-a-login">7.2.1. Create a login</h4>
<div class="paragraph">
<p>To access the Database Engine, users require a login. The login can represent the user&#8217;s identity as a Windows account or as a member of a Windows group, or the login can be a SQL Server login that exists only in SQL Server. Whenever possible you should use Windows Authentication.</p>
</div>
<div class="sect4">
<h5 id="create-a-new-windows-account">7.2.1.1. Create a new Windows account</h5>
<div class="paragraph">
<p>By default, administrators on your computer have full access to SQL Server. For this lesson, we want to have a less privileged user; therefore, you will create a new local Windows Authentication account on your computer.</p>
</div>
<div class="paragraph">
<p>To do this, you must be an administrator on your computer. Then you will grant that new user access to SQL Server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select <strong>Start</strong>, select <strong>Run</strong>, in the <strong>Open</strong> box, type <code>%SystemRoot%\system32\compmgmt.msc /s</code> and then select <strong>OK</strong> to open the Computer Management program.</p>
</li>
<li>
<p>Under <strong>System Tools</strong>, expand <strong>Local Users and Groups</strong>, right-click <strong>Users</strong>, and then select <strong>New User</strong>.</p>
</li>
<li>
<p>In the <strong>User</strong> name box type <strong>Mary</strong>.</p>
</li>
<li>
<p>In the <strong>Password</strong> and <strong>Confirm password</strong> box, type a strong password, and then select <strong>Create</strong> to create a new local Windows user.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="create-a-sql-login-using-windows-authentication-with-t-sql">7.2.1.2. Create a SQL login  using Windows Authentication with T-SQL</h5>
<div class="paragraph">
<p>In a Query Editor window of SQL Server Management Studio, type and execute the following code replacing <code>computer_name</code> with the name of your computer. <code>FROM WINDOWS</code> indicates that Windows will authenticate the user. The optional <code>DEFAULT_DATABASE</code> argument connects <code>Mary</code> to the <code>TestData</code> database, unless her connection string indicates another database. This statement introduces the semicolon as an optional termination for a Transact-SQL statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="n">LOGIN</span> <span class="p">[</span><span class="n">computer_name</span><span class="err">\</span><span class="n">Mary</span><span class="p">]</span>
    <span class="k">FROM</span> <span class="n">WINDOWS</span>
    <span class="k">WITH</span> <span class="n">DEFAULT_DATABASE</span> <span class="o">=</span> <span class="p">[</span><span class="n">TestData</span><span class="p">];</span>
<span class="k">GO</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This authorizes a user name <code>Mary</code>, authenticated by your computer, to access this instance of SQL Server. If there is more than one instance of SQL Server on the computer, you must create the login on each instance that Mary must access.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because <code>Mary</code> is not a domain account, this user name can only be authenticated on this computer.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="create-a-login-using-sql-server-authentication-with-t-sql">7.2.1.3. Create a login using SQL Server Authentication with T-SQL</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Creates the user "shcooper" for SQL Server using the security credential "RestrictedFaculty"</span>
<span class="c1">-- The user login starts with the password "Baz1nga," but that password must be changed after the first login.</span>

<span class="k">CREATE</span> <span class="n">LOGIN</span> <span class="n">shcooper</span>
   <span class="k">WITH</span> <span class="n">PASSWORD</span> <span class="o">=</span> <span class="s1">'Baz1nga'</span> <span class="n">MUST_CHANGE</span><span class="p">,</span>
   <span class="n">CREDENTIAL</span> <span class="o">=</span> <span class="n">RestrictedFaculty</span><span class="p">;</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="grant-access-to-a-database">7.2.2. Grant access to a database</h4>
<div class="paragraph">
<p>Mary now has access to this instance of SQL Server, but doesn&#8217;t have permission to access the databases. She doesn&#8217;t even have access to her default database <code>TestData</code> until you authorize her as a database user.</p>
</div>
<div class="paragraph">
<p>To grant Mary access, switch to the <code>TestData</code> database, and then use the <code>CREATE USER</code> statement to map her login to a user named <code>Mary</code>.</p>
</div>
<div class="sect4">
<h5 id="create-a-user-in-a-database">7.2.2.1. Create a user in a database</h5>
<div class="paragraph">
<p>Type and execute the following statements (replacing <code>computer_name</code> with the name of your computer) to grant <code>Mary</code> access to the <code>TestData</code> database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="n">USE</span> <span class="p">[</span><span class="n">TestData</span><span class="p">];</span>
<span class="k">GO</span>

<span class="k">CREATE</span> <span class="k">USER</span> <span class="p">[</span><span class="n">Mary</span><span class="p">]</span> <span class="k">FOR</span> <span class="n">LOGIN</span> <span class="p">[</span><span class="n">computer_name</span><span class="err">\</span><span class="n">Mary</span><span class="p">];</span>
<span class="k">GO</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, Mary has access to both SQL Server and the <code>TestData</code> database.</p>
</div>
</div>
<div class="sect4">
<h5 id="create-views-and-stored-procedures-2">7.2.2.2. Create views and stored procedures</h5>
<div class="paragraph">
<p>As an administrator, you can execute the SELECT from the <code>Products</code> table and the <code>vw_Names</code> view, and execute the <code>pr_Names</code> procedure; however, Mary can&#8217;t. To grant Mary the necessary permissions, use the <code>GRANT</code> statement.</p>
</div>
<div class="paragraph">
<p><strong>Grant permission to stored procedure</strong></p>
</div>
<div class="paragraph">
<p>Execute the following statement to give Mary the EXECUTE permission for the pr_Names stored procedure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">GRANT</span> <span class="k">EXECUTE</span> <span class="k">ON</span> <span class="n">pr_Names</span> <span class="k">TO</span> <span class="n">Mary</span><span class="p">;</span>
<span class="k">GO</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this scenario, Mary can only access the <code>Products</code> table by using the stored procedure. If you want Mary to be able to execute a SELECT statement against the view, then you must also execute <code>GRANT SELECT ON vw_Names TO Mary</code>. To remove access to database objects, use the REVOKE statement.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the table, the view, and the stored procedure are not owned by the same schema, granting permissions becomes more complex.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="about-grant">7.2.2.3. About GRANT</h5>
<div class="paragraph">
<p>You must have EXECUTE permission to execute a stored procedure. You must have SELECT, INSERT, UPDATE, and DELETE permissions to access and change data. The GRANT statement is also used for other permissions, such as permission to create tables.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lesson-3-delete-database-objects">7.3. Lesson 3: Delete database objects</h3>
<div class="paragraph">
<p>This short lesson removes the objects that you created in Lesson 1 and Lesson 2, and then drops the database.</p>
</div>
<div class="paragraph">
<p>Before you delete objects, make sure you are in the correct database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="n">USE</span> <span class="n">TestData</span><span class="p">;</span>
<span class="k">GO</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="revoke-stored-procedure-permissions">7.3.1. Revoke stored procedure permissions</h4>
<div class="paragraph">
<p>Use the <code>REVOKE</code> statement to remove execute permission for <code>Mary</code> on the stored procedure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">REVOKE</span> <span class="k">EXECUTE</span> <span class="k">ON</span> <span class="n">pr_Names</span> <span class="k">FROM</span> <span class="n">Mary</span><span class="p">;</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="drop-permissions">7.3.2. Drop permissions</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>DROP</code> statement to remove permission for <code>Mary</code> to access the <code>TestData</code> database:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">USER</span> <span class="n">Mary</span><span class="p">;</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>DROP</code> statement to remove permission for <code>Mary</code> to access this instance of SQL Server 2005 (9.x):</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="n">LOGIN</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">computer_name</span><span class="o">&gt;</span><span class="err">\</span><span class="n">Mary</span><span class="p">];</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>DROP</code> statement to remove the store procedure <code>pr_Names</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="n">PROC</span> <span class="n">pr_Names</span><span class="p">;</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>DROP</code> statement to remove the view <code>vw_Names</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">VIEW</span> <span class="n">vw_Names</span><span class="p">;</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="delete-table">7.3.3. Delete table</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>DELETE</code> statement to remove all rows from the <code>Products</code> table:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">Products</span><span class="p">;</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>DROP</code> statement to remove the <code>Products</code> table:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">Products</span><span class="p">;</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="remove-database">7.3.4. Remove database</h4>
<div class="paragraph">
<p>You can&#8217;t remove the <code>TestData</code> database while you are in the database; therefore, first switch context to another database, and then use the <code>DROP</code> statement to remove the <code>TestData</code> database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="n">USE</span> <span class="n">MASTER</span><span class="p">;</span>
<span class="k">GO</span>
<span class="k">DROP</span> <span class="k">DATABASE</span> <span class="n">TestData</span><span class="p">;</span>
<span class="k">GO</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="references">8. References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/sql/linux/sql-server-linux-docker-container-deployment?view=sql-server-ver16&amp;pivots=cs1-bash" class="bare">https://learn.microsoft.com/en-us/sql/linux/sql-server-linux-docker-container-deployment?view=sql-server-ver16&amp;pivots=cs1-bash</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/sql/linux/quickstart-install-connect-docker?view=sql-server-ver16&amp;preserve-view=true&amp;pivots=cs1-bash" class="bare">https://learn.microsoft.com/en-us/sql/linux/quickstart-install-connect-docker?view=sql-server-ver16&amp;preserve-view=true&amp;pivots=cs1-bash</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/sql/relational-databases/databases/databases?view=sql-server-ver16" class="bare">https://learn.microsoft.com/en-us/sql/relational-databases/databases/databases?view=sql-server-ver16</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/sql/relational-databases/databases/contained-databases?view=sql-server-ver16" class="bare">https://learn.microsoft.com/en-us/sql/relational-databases/databases/contained-databases?view=sql-server-ver16</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/sql/sql-server/install/file-locations-for-default-and-named-instances-of-sql-server?view=sql-server-ver16" class="bare">https://learn.microsoft.com/en-us/sql/sql-server/install/file-locations-for-default-and-named-instances-of-sql-server?view=sql-server-ver16</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/sql/relational-databases/security/authentication-access/getting-started-with-database-engine-permissions?view=sql-server-ver16" class="bare">https://learn.microsoft.com/en-us/sql/relational-databases/security/authentication-access/getting-started-with-database-engine-permissions?view=sql-server-ver16</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/sql/relational-databases/security/authentication-access/principals-database-engine?view=sql-server-ver16" class="bare">https://learn.microsoft.com/en-us/sql/relational-databases/security/authentication-access/principals-database-engine?view=sql-server-ver16</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/sql/t-sql/language-elements/sql-server-utilities-statements-go?view=sql-server-ver16" class="bare">https://learn.microsoft.com/en-us/sql/t-sql/language-elements/sql-server-utilities-statements-go?view=sql-server-ver16</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/sql/t-sql/language-elements/transact-sql-syntax-conventions-transact-sql?view=sql-server-ver16" class="bare">https://learn.microsoft.com/en-us/sql/t-sql/language-elements/transact-sql-syntax-conventions-transact-sql?view=sql-server-ver16</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/sql/t-sql/tutorial-writing-transact-sql-statements?view=sql-server-ver16" class="bare">https://learn.microsoft.com/en-us/sql/t-sql/tutorial-writing-transact-sql-statements?view=sql-server-ver16</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/SQL" class="bare">https://en.wikipedia.org/wiki/SQL</a></p>
</li>
</ul>
</div>
</div>
</div>
  </div>

  <ul class="post-navigation">
    <li>
      
      <a href="/2023/03/15/opengpg-gnupg-secureapt/">&laquo; OpenGPG, GnuPG and SecureApt</a>
      
    </li>
    <li>
      
    </li>
  </ul>
</article>

      </div>
    </div>

    <footer class="site-footer">
  <div class="license">
    <span>Article licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></span>
  </div>
  
  <details open>
    <summary>Extral Links</summary>
    <div>
      
      <a href="https://jekyllrb.com/">Jekyll</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://shopify.github.io/">Liquid</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://docs.asciidoctor.org/">Asciidoctor</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="https://github.com/qqbuby/">GitHub</a>
      
      &nbsp;.&nbsp;
      
      
      <a href="/feed.xml">RSS</a>
      
      
    </div>
  </details>
  
</footer>


<!-- https://github.com/bryanbraun/anchorjs -->
<script src="/js/anchor.min.js"></script>
<script>
  anchors.add();
  anchors.remove(".site-title");
</script>




  </body>

</html>
